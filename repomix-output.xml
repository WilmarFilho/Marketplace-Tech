This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.dockerignore
.github/workflows/deploy.yml
.gitignore
app/(main)/admin/moderacao/actions.ts
app/(main)/admin/moderacao/ModerationCard.tsx
app/(main)/admin/moderacao/ModerationContent.tsx
app/(main)/admin/moderacao/ModerationGrid.tsx
app/(main)/admin/moderacao/page.tsx
app/(main)/admin/moderacao/ProductPreviewModal.tsx
app/(main)/anuncio/[id]/actions.ts
app/(main)/anuncio/[id]/not-found.tsx
app/(main)/anuncio/[id]/page.tsx
app/(main)/dashboard/actions.ts
app/(main)/dashboard/anunciar/actions.ts
app/(main)/dashboard/anunciar/page.tsx
app/(main)/dashboard/favoritos/actions.ts
app/(main)/dashboard/favoritos/page.tsx
app/(main)/dashboard/meus-anuncios/actions.ts
app/(main)/dashboard/meus-anuncios/page.tsx
app/(main)/dashboard/page.tsx
app/(main)/explorar/actions.ts
app/(main)/explorar/page.tsx
app/(main)/layout.tsx
app/(main)/page.tsx
app/auth/actions.ts
app/auth/alterar-senha/page.tsx
app/auth/cadastro-realizado/page.tsx
app/auth/cadastro/page.tsx
app/auth/confirmar/route.ts
app/auth/error/page.tsx
app/auth/esqueci-senha/page.tsx
app/auth/login/page.tsx
app/globals.css
app/layout.tsx
components.json
components/cards/anuncio/card-anuncio.module.css
components/cards/anuncio/index.tsx
components/dashboard/ActiveFilters.tsx
components/dashboard/DashboardFilters.tsx
components/dashboard/EditProfileModal.tsx
components/dashboard/FavoritesContent.tsx
components/dashboard/filters.module.css
components/dashboard/LocalFilterBar.tsx
components/dashboard/LocalFilters.tsx
components/dashboard/MessagesModal.tsx
components/dashboard/MeusAnunciosContent.tsx
components/dashboard/ProfileCard.tsx
components/dashboard/ProfilePictureUpload.tsx
components/explorar/ExplorarContent.tsx
components/filterbar/filterbar.module.css
components/filterbar/filterbar.tsx
components/filters/filter.module.css
components/filters/filters.tsx
components/filters/FilterSection.tsx
components/filters/ResultsHeader.tsx
components/forms/form-atualizar-senha.tsx
components/forms/form-cadastro.tsx
components/forms/form-criar-anuncio.tsx
components/forms/form-esqueci-senha.tsx
components/forms/form-login.tsx
components/forms/MultiStepAdForm.tsx
components/forms/steps/StepBasicInfo.tsx
components/forms/steps/StepCategoryTags.tsx
components/forms/steps/StepContactReview.tsx
components/forms/steps/StepPhotos.tsx
components/layout/cabecalho/cabecalho.module.css
components/layout/cabecalho/index.tsx
components/layout/rodape/index.tsx
components/layout/rodape/rodape.module.css
components/modals/modal-editar-anuncio.tsx
components/product/product.module.css
components/product/ProductContact.tsx
components/product/ProductGallery.tsx
components/product/ProductInfo.tsx
components/product/ProductPage.tsx
components/product/ProductSeller.tsx
components/sections/em-alta/index.tsx
components/sections/em-alta/secao-em-alta.module.css
components/sections/hardware/index.tsx
components/sections/hardware/secao-hardware.module.css
components/sections/hero/index.tsx
components/sections/hero/secao-hero.module.css
components/sections/missao/index.tsx
components/sections/missao/secao-missao.module.css
components/sections/por-que/index.tsx
components/sections/por-que/secao-por-que.module.css
components/sections/semelhantes/index.tsx
components/sections/semelhantes/semelhantes.module.css
components/ui/badge.tsx
components/ui/botao-excluir-anuncio.tsx
components/ui/botao-favoritar.tsx
components/ui/botao-sair.tsx
components/ui/button.tsx
components/ui/card.tsx
components/ui/checkbox.tsx
components/ui/dialog.tsx
components/ui/dropdown-menu.tsx
components/ui/input.tsx
components/ui/label.tsx
components/ui/progress.tsx
components/ui/separator.tsx
components/ui/tabs.tsx
docker-compose.yml
Dockerfile
env.local
eslint.config.mjs
lib/hooks/useFilters.ts
lib/hooks/useLocalFilters.ts
lib/hooks/useNewsletter.ts
lib/supabase/browser.ts
lib/supabase/client.ts
lib/supabase/proxy.ts
lib/supabase/server.ts
lib/utils.ts
next.config.ts
package.json
postcss.config.mjs
proxy.ts
public/favicon.svg
public/figma/decor-d.svg
public/figma/hero-bg.webp
public/figma/icon-cpu.svg
public/figma/icon-users-three.svg
public/figma/instagram.svg
public/figma/O.png
public/figma/pc.png
public/figma/por-que-illustration.png
public/figma/wpp.png
public/figma/x.svg
public/figma/youtube.svg
public/logo-nkw.svg
public/logo.svg
src/types/products.ts
src/types/supabase.ts
supabase/.temp/cli-latest
supabase/.temp/gotrue-version
supabase/.temp/pooler-url
supabase/.temp/postgres-version
supabase/.temp/project-ref
supabase/.temp/rest-version
supabase/.temp/storage-migration
supabase/.temp/storage-version
supabase/fix-messages-rls.sql
supabase/messages-policies.sql
supabase/migrations/20260115154425_setup_avatars_storage.sql
supabase/migrations/20260115161106_setup_products_storage.sql
supabase/storage-policies.sql
tailwind.config.ts
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="lib/supabase/browser.ts">
import { createBrowserClient } from "@supabase/ssr";

export function createBrowserSupabaseClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,
  );
}
</file>

<file path="public/figma/instagram.svg">
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M21.3333 4.32373H10.6667C6.98477 4.32373 4 7.3085 4 10.9904V21.6571C4 25.3389 6.98477 28.3237 10.6667 28.3237H21.3333C25.0152 28.3237 28 25.3389 28 21.6571V10.9904C28 7.3085 25.0152 4.32373 21.3333 4.32373ZM25.6667 21.6571C25.6593 24.0472 23.7235 25.9831 21.3333 25.9904H10.6667C8.27647 25.9831 6.34065 24.0472 6.33333 21.6571V10.9904C6.34065 8.6002 8.27647 6.66438 10.6667 6.65706H21.3333C23.7235 6.66438 25.6593 8.6002 25.6667 10.9904V21.6571ZM22.3333 11.3237C23.0697 11.3237 23.6667 10.7268 23.6667 9.9904C23.6667 9.25402 23.0697 8.65706 22.3333 8.65706C21.5969 8.65706 21 9.25402 21 9.9904C21 10.7268 21.5969 11.3237 22.3333 11.3237ZM16 10.3237C12.6863 10.3237 10 13.01 10 16.3237C10 19.6375 12.6863 22.3237 16 22.3237C19.3137 22.3237 22 19.6375 22 16.3237C22.0036 14.7313 21.3725 13.2032 20.2465 12.0772C19.1205 10.9512 17.5924 10.3202 16 10.3237ZM12.3333 16.3237C12.3333 18.3488 13.9749 19.9904 16 19.9904C18.0251 19.9904 19.6667 18.3488 19.6667 16.3237C19.6667 14.2987 18.0251 12.6571 16 12.6571C13.9749 12.6571 12.3333 14.2987 12.3333 16.3237Z" fill="white" fill-opacity="0.55"/>
</svg>
</file>

<file path="public/figma/youtube.svg">
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M28.7907 9.60385C28.6388 9.04038 28.342 8.52652 27.9298 8.1134C27.5176 7.70029 27.0044 7.40233 26.4413 7.24918C24.3533 6.67585 16 6.66651 16 6.66651C16 6.66651 7.648 6.65718 5.55866 7.20518C4.9959 7.36538 4.48376 7.66755 4.07142 8.08269C3.65908 8.49784 3.36038 9.01201 3.204 9.57585C2.65333 11.6638 2.648 15.9945 2.648 15.9945C2.648 15.9945 2.64266 20.3465 3.18933 22.4132C3.496 23.5558 4.396 24.4585 5.54 24.7665C7.64933 25.3398 15.98 25.3492 15.98 25.3492C15.98 25.3492 24.3333 25.3585 26.4213 24.8118C26.9847 24.659 27.4983 24.3617 27.9115 23.9494C28.3247 23.5371 28.6232 23.0242 28.7773 22.4612C29.3293 20.3745 29.3333 16.0452 29.3333 16.0452C29.3333 16.0452 29.36 11.6918 28.7907 9.60385ZM13.328 20.0065L13.3347 12.0065L20.2773 16.0132L13.328 20.0065Z" fill="white" fill-opacity="0.55"/>
</svg>
</file>

<file path=".dockerignore">
node_modules
.next
out
build
.git
</file>

<file path="app/(main)/anuncio/[id]/not-found.tsx">
import Link from "next/link";
import { Button } from "@/components/ui/button";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";

export default function NotFound() {
  return (
    <>
      <Cabecalho />
      <div className="container mx-auto py-16 px-4 text-center">
        <h1 className="text-6xl font-bold text-gray-800 mb-4">404</h1>
        <h2 className="text-2xl font-semibold text-gray-600 mb-4">
          Produto não encontrado
        </h2>
        <p className="text-gray-500 mb-8">
          O produto que você está procurando pode ter sido removido, ter seu nome alterado ou estar temporariamente indisponível.
        </p>
        <div className="flex gap-4 justify-center">
          <Button asChild>
            <Link href="/explorar">
              Ver todos os produtos
            </Link>
          </Button>
          <Button asChild variant="outline">
            <Link href="/">
              Voltar ao início
            </Link>
          </Button>
        </div>
      </div>
      <Rodape />
    </>
  );
}
</file>

<file path="app/auth/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { redirect } from "next/navigation";

export async function signOut() {
  try {
    const supabase = await createClient();
    await supabase.auth.signOut();
    redirect("/auth/login");
  } catch (error) {
    console.error("Error in signOut action:", error);
    throw error;
  }
}

export async function getUserSession() {
  try {
    const supabase = await createClient();
    const { data: { user } } = await supabase.auth.getUser();
    return user;
  } catch (error) {
    console.error("Error in getUserSession:", error);
    throw error;
  }
}

export async function signIn(formData: FormData) {
  try {
    const supabase = await createClient();

    const email = formData.get("email") as string;
    const password = formData.get("password") as string;

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      console.error("signIn supabase error:", error);
      const msg = error.message?.toLowerCase() || "";
      // Tradução de erro para email não confirmado
      if (
        msg.includes("email not confirmed") ||
        msg.includes("email needs to be confirmed")
      ) {
        throw new Error("Seu e-mail ainda não foi confirmado. Por favor, verifique sua caixa de entrada e confirme o cadastro.");
      }
      // Tradução de erro para credenciais inválidas
      if (msg.includes("invalid login credentials")) {
        throw new Error("E-mail ou senha inválidos. Verifique seus dados e tente novamente.");
      }
      throw new Error(error.message || "Erro ao autenticar");
    }

    // Retorna sucesso para o cliente redirecionar
    return { success: true };
  } catch (error) {
    console.error("Error in signIn action:", error);
    if (error instanceof Error) {
      throw new Error(error.message);
    }
    throw error;
  }
}

export async function signUp(formData: FormData) {
  try {
    const supabase = await createClient();

    const email = formData.get("email") as string;
    const password = formData.get("password") as string;
    const repeatPassword = formData.get("repeatPassword") as string;
    const fullName = formData.get("fullName") as string;
    const role = formData.get("role") as string;

    if (password !== repeatPassword) {
      throw new Error("As senhas não coincidem");
    }

    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/auth/confirmar`,
        data: {
          full_name: fullName,
          role,
        },
      },
    });

    if (error) {
      console.error("signUp supabase error:", error);
      throw new Error(error.message || "Erro ao cadastrar");
    }

    redirect("/auth/cadastro-realizado");
  } catch (error) {
    console.error("Error in signUp action:", error);
    throw error;
  }
}

export async function resetPassword(formData: FormData) {
  try {
    const supabase = await createClient();

    const email = formData.get("email") as string;

    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/auth/alterar-senha`,
    });

    if (error) {
      console.error("resetPassword supabase error:", error);
      throw new Error(error.message || "Erro ao resetar senha");
    }

    return { success: true };
  } catch (error) {
    console.error("Error in resetPassword action:", error);
    throw error;
  }
}

export async function updatePassword(formData: FormData) {
  try {
    const supabase = await createClient();

    const password = formData.get("password") as string;

    const { error } = await supabase.auth.updateUser({ password });

    if (error) {
      console.error("updatePassword supabase error:", error);
      throw new Error(error.message || "Erro ao atualizar senha");
    }

    redirect("/");
  } catch (error) {
    console.error("Error in updatePassword action:", error);
    throw error;
  }
}
</file>

<file path="app/auth/cadastro-realizado/page.tsx">
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import Image from "next/image";
import Link from "next/link";

export default function Page() {
  return (
    <div className="flex min-h-screen w-full items-center justify-center px-4 py-10">
      <div className="w-full max-w-md">
        <div className="flex flex-col gap-6">
          <Card>
            <CardHeader className="flex flex-col items-center text-center gap-2">
              <div className="w-full flex justify-center">
                <Image src="/logo.svg" alt="DROPTECH" width={200} height={36} className="h-[36px] w-auto" />
              </div>
              <CardTitle className="text-2xl">Obrigado por se cadastrar!</CardTitle>
              <CardDescription>Verifique seu e-mail para confirmar</CardDescription>
            </CardHeader>
            <CardContent>
              <p className="mx-auto max-w-[34rem] text-sm text-muted-foreground leading-relaxed text-center">
                Você se cadastrou com sucesso. Por favor, verifique seu e-mail para
                confirmar sua conta antes de fazer login.
              </p>

              <div className="mt-6 flex justify-center">
                <Link href="/" className="text-sm text-primary hover:underline">
                  Voltar para a home
                </Link>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="components/dashboard/ActiveFilters.tsx">
'use client';

import { X } from 'lucide-react';
import type { FilterParams } from '../../app/(main)/explorar/actions';

interface ActiveFiltersProps {
  filters: FilterParams;
  clearFilters: () => void;
  toggleTag: (tag: string) => void;
  toggleCategory: (category: string) => void;
  updateFilters: (filters: Partial<FilterParams>) => void;
}

export function ActiveFilters({ 
  filters, 
  clearFilters, 
  toggleTag, 
  toggleCategory, 
  updateFilters 
}: ActiveFiltersProps) {
  
  const hasActiveFilters = () => {
    return (
      filters.search || 
      (filters.tags && filters.tags.length > 0) ||
      (filters.categories && filters.categories.length > 0) ||
      filters.minPrice !== undefined ||
      filters.maxPrice !== undefined ||
      filters.priceRange ||
      filters.city ||
      filters.state ||
      filters.dateFilter
    );
  };

  const formatPriceFilter = () => {
    if (filters.priceRange) return filters.priceRange;
    if (filters.minPrice !== undefined || filters.maxPrice !== undefined) {
      const min = filters.minPrice ? `R$ ${filters.minPrice}` : '';
      const max = filters.maxPrice ? `R$ ${filters.maxPrice}` : '';
      if (min && max) return `${min} - ${max}`;
      if (min) return `Acima de ${min}`;
      if (max) return `Até ${max}`;
    }
    return null;
  };

  const formatDateFilter = () => {
    switch (filters.dateFilter) {
      case 'today': return 'Hoje';
      case 'week': return 'Última semana';
      case 'month': return 'Último mês';
      case '3months': return 'Últimos 3 meses';
      default: return null;
    }
  };

  if (!hasActiveFilters()) return null;

  return (
    <div className="mb-6 bg-white/5 backdrop-blur-sm rounded-lg p-4 border border-white/10">
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-sm font-medium text-white">Filtros ativos:</h3>
        <button
          onClick={clearFilters}
          className="text-xs text-red-400 hover:text-red-300 transition-colors flex items-center gap-1"
        >
          <X className="h-3 w-3" />
          Limpar todos
        </button>
      </div>
      
      <div className="flex flex-wrap gap-2">
        {/* Busca */}
        {filters.search && (
          <div className="flex items-center gap-1 bg-blue-500/20 text-blue-300 px-2 py-1 rounded-md text-xs border border-blue-400/30">
            <span>Busca: &ldquo;{filters.search}&rdquo;</span>
            <button
              onClick={() => updateFilters({ search: '', page: 1 })}
              className="hover:text-blue-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        )}

        {/* Tags */}
        {filters.tags && filters.tags.map(tag => (
          <div key={tag} className="flex items-center gap-1 bg-green-500/20 text-green-300 px-2 py-1 rounded-md text-xs border border-green-400/30">
            <span>#{tag}</span>
            <button
              onClick={() => toggleTag(tag)}
              className="hover:text-green-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        ))}

        {/* Categorias */}
        {filters.categories && filters.categories.map(category => (
          <div key={category} className="flex items-center gap-1 bg-purple-500/20 text-purple-300 px-2 py-1 rounded-md text-xs border border-purple-400/30">
            <span>{category}</span>
            <button
              onClick={() => toggleCategory(category)}
              className="hover:text-purple-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        ))}

        {/* Preço */}
        {formatPriceFilter() && (
          <div className="flex items-center gap-1 bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded-md text-xs border border-yellow-400/30">
            <span>{formatPriceFilter()}</span>
            <button
              onClick={() => updateFilters({ 
                minPrice: undefined, 
                maxPrice: undefined, 
                priceRange: '', 
                page: 1 
              })}
              className="hover:text-yellow-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        )}

        {/* Cidade */}
        {filters.city && (
          <div className="flex items-center gap-1 bg-orange-500/20 text-orange-300 px-2 py-1 rounded-md text-xs border border-orange-400/30">
            <span>Cidade: {filters.city}</span>
            <button
              onClick={() => updateFilters({ city: '', page: 1 })}
              className="hover:text-orange-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        )}

        {/* Estado */}
        {filters.state && (
          <div className="flex items-center gap-1 bg-pink-500/20 text-pink-300 px-2 py-1 rounded-md text-xs border border-pink-400/30">
            <span>Estado: {filters.state}</span>
            <button
              onClick={() => updateFilters({ state: '', page: 1 })}
              className="hover:text-pink-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        )}

        {/* Data */}
        {formatDateFilter() && (
          <div className="flex items-center gap-1 bg-teal-500/20 text-teal-300 px-2 py-1 rounded-md text-xs border border-teal-400/30">
            <span>{formatDateFilter()}</span>
            <button
              onClick={() => updateFilters({ dateFilter: '', page: 1 })}
              className="hover:text-teal-200"
            >
              <X className="h-3 w-3" />
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/DashboardFilters.tsx">
'use client';

import {
  ArrowRight,
  Circle
} from 'lucide-react';
import styles from './filters.module.css';
import { FilterSection } from '../filters/FilterSection';
import { useFilters } from '@/lib/hooks/useFilters';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { usePathname } from 'next/navigation';

export default function DashboardFilters() {
  const pathname = usePathname();
  const { 
    filters, 
    updateFilters, 
    toggleCategory, 
    setPriceRange, 
    setCustomPrice 
  } = useFilters();
  
  const [categories, setCategories] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  
  const isMeusAnuncios = pathname?.includes('/meus-anuncios');

  // Buscar categorias do banco de dados
  useEffect(() => {
    async function fetchCategories() {
      const supabase = createClient();
      const { data: categoriesData } = await supabase
        .from('categories')
        .select('name')
        .order('name');
      
      setCategories(categoriesData?.map(cat => cat.name) || []);
      setIsLoading(false);
    }
    
    fetchCategories();
  }, []);
  
  // Tags de faixas de preço
  const priceTags = [
    'Até R$ 500',
    'R$ 500 - R$ 1.000',
    'R$ 1.000 - R$ 2.500',
    'R$ 2.500 - R$ 5.000',
    'R$ 5.000 - R$ 10.000',
    'Acima de R$ 10.000'
  ];

  // Status options para meus anúncios
  const statusOptions = [
    { value: 'pendente', label: 'Pendente' },
    { value: 'aprovado', label: 'Aprovado' },
    { value: 'rejeitado', label: 'Rejeitado' },
  ];

  const handlePriceTagClick = (tag: string) => {
    if (filters.priceRange === tag) {
      setPriceRange('');
      setCustomPrice(undefined, undefined);
    } else {
      setPriceRange(tag);
      
      // Converter tag para valores min/max
      switch(tag) {
        case 'Até R$ 500':
          setCustomPrice(undefined, 500);
          break;
        case 'R$ 500 - R$ 1.000':
          setCustomPrice(500, 1000);
          break;
        case 'R$ 1.000 - R$ 2.500':
          setCustomPrice(1000, 2500);
          break;
        case 'R$ 2.500 - R$ 5.000':
          setCustomPrice(2500, 5000);
          break;
        case 'R$ 5.000 - R$ 10.000':
          setCustomPrice(5000, 10000);
          break;
        case 'Acima de R$ 10.000':
          setCustomPrice(10000, undefined);
          break;
      }
    }
  };

  const handleCustomPriceChange = (field: 'min' | 'max', value: string) => {
    const numValue = value === '' ? undefined : parseInt(value);
    
    if (field === 'min') {
      setCustomPrice(numValue, filters.maxPrice);
    } else {
      setCustomPrice(filters.minPrice, numValue);
    }
    
    // Limpar seleção de tag quando personalizar
    if (filters.priceRange) {
      setPriceRange('');
    }
  };

  if (isLoading) {
    return (
      <div className={styles.filters}>
        <div className="animate-pulse">
          <div className="h-6 bg-gray-200 rounded mb-4"></div>
          <div className="space-y-2">
            {Array.from({ length: 5 }).map((_, i) => (
              <div key={i} className="h-4 bg-gray-200 rounded"></div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.filters}>
      {/* Status Filter - Only for Meus Anúncios */}
      {isMeusAnuncios && (
        <FilterSection id="status" title="Status">
          <div className={styles.filterTags}>
            {statusOptions.map((option) => {
              const isActive = filters.status === option.value;
              return (
                <button
                  key={option.value}
                  onClick={() => updateFilters({ status: isActive ? '' : option.value })}
                  className={`${styles.filterTag} ${isActive ? styles.active : ''}`}
                >
                  <Circle className={styles.tagIcon} />
                  <span>{option.label}</span>
                  {isActive && <ArrowRight className={styles.tagIcon} />}
                </button>
              );
            })}
          </div>
        </FilterSection>
      )}

      {/* Categories */}
      <FilterSection id="categories" title="Categorias">
        <div className={styles.filterTags}>
          {categories.map((category) => {
            const isActive = filters.categories?.includes(category);
            return (
              <button
                key={category}
                onClick={() => toggleCategory(category)}
                className={`${styles.filterTag} ${isActive ? styles.active : ''}`}
              >
                <Circle className={styles.tagIcon} />
                <span>{category}</span>
                {isActive && <ArrowRight className={styles.tagIcon} />}
              </button>
            );
          })}
        </div>
      </FilterSection>

      {/* Price Range */}
      <FilterSection id="price" title="Preço">
        <div className={styles.filterTags}>
          {priceTags.map((tag) => {
            const isActive = filters.priceRange === tag;
            return (
              <button
                key={tag}
                onClick={() => handlePriceTagClick(tag)}
                className={`${styles.filterTag} ${isActive ? styles.active : ''}`}
              >
                <Circle className={styles.tagIcon} />
                <span>{tag}</span>
                {isActive && <ArrowRight className={styles.tagIcon} />}
              </button>
            );
          })}
        </div>

        {/* Custom Price Range */}
        <div className={styles.customPriceContainer}>
          <div className={styles.priceInputGroup}>
            <div className={styles.priceInputWrapper}>
              <span className={styles.currencySymbol}>R$</span>
              <input
                type="number"
                placeholder="Min"
                value={filters.minPrice || ''}
                onChange={(e) => handleCustomPriceChange('min', e.target.value)}
                className={styles.priceInput}
              />
            </div>
            <span className={styles.priceSeparator}>-</span>
            <div className={styles.priceInputWrapper}>
              <span className={styles.currencySymbol}>R$</span>
              <input
                type="number"
                placeholder="Max"
                value={filters.maxPrice || ''}
                onChange={(e) => handleCustomPriceChange('max', e.target.value)}
                className={styles.priceInput}
              />
            </div>
          </div>
        </div>
      </FilterSection>

      {/* Location */}
      <FilterSection id="location" title="Localização">
        <input
          type="text"
          placeholder="Cidade ou estado"
          value={filters.location || ''}
          onChange={(e) => updateFilters({ location: e.target.value })}
          className={styles.locationInput}
        />
      </FilterSection>
    </div>
  );
}
</file>

<file path="components/dashboard/filters.module.css">
/* Importar estilos do filtro original */
@import '../filters/filter.module.css';

/* Adicionar estilos específicos se necessário */
</file>

<file path="components/dashboard/LocalFilterBar.tsx">
'use client';

import { Search } from 'lucide-react';
import styles from '../filterbar/filterbar.module.css';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

import type { FilterParams } from '../../app/(main)/explorar/actions';

interface LocalFilterBarProps {
  filters: FilterParams;
  searchDebounce: string;
  updateSearch: (value: string) => void;
  toggleTag: (tag: string) => void;
}

export default function LocalFilterBar({ 
  filters, 
  searchDebounce, 
  updateSearch, 
  toggleTag 
}: LocalFilterBarProps) {
  const [availableTags, setAvailableTags] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Buscar tags disponíveis
  useEffect(() => {
    async function fetchTags() {
      const supabase = createClient();
      const { data: tagsData } = await supabase
        .from('tags')
        .select('name')
        .limit(6);
      
      setAvailableTags(tagsData?.map(tag => tag.name) || []);
      setIsLoading(false);
    }
    
    fetchTags();
  }, []);

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateSearch(e.target.value);
  };

  const handleTagClick = (tag: string) => {
    toggleTag(tag);
  };

  if (isLoading) {
    return (
      <div className={styles.container}>
        <div className={styles.tags}>
          {Array.from({ length: 6 }).map((_, i) => (
            <div key={i} className={`${styles.tag} animate-pulse bg-gray-200`}>
              &nbsp;
            </div>
          ))}
        </div>
        <div className={styles.searchWrapper}>
          <div className={`${styles.searchInput} animate-pulse bg-gray-200`}></div>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      {/* Tags */}
      <div className={styles.tags}>
        {availableTags.map((tag, index) => (
          <button 
            key={index} 
            className={`${styles.tag} ${
              filters.tags && filters.tags.includes(tag) ? styles.tagActive : ''
            }`}
            onClick={() => handleTagClick(tag)}
          >
            #{tag}
          </button>
        ))}
      </div>

      {/* Search */}
      <div className={styles.searchWrapper}>
        <input
          type="text"
          placeholder="Notebook Acer 4gb Ram"
          className={styles.searchInput}
          value={searchDebounce}
          onChange={handleSearchChange}
        />
        <button className={styles.searchButton}>
          <Search size={18} />
        </button>
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/ProfilePictureUpload.tsx">
'use client';

import { useState, useRef } from 'react';
import { Camera, Trash2, Upload } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { uploadProfilePicture, deleteProfilePicture } from '../../app/(main)/dashboard/actions';
import { useRouter } from 'next/navigation';
import Image from 'next/image';

interface ProfilePictureUploadProps {
  currentAvatar?: string | null;
  userName?: string;
}

export function ProfilePictureUpload({ currentAvatar, userName }: ProfilePictureUploadProps) {
  const [isUploading, setIsUploading] = useState(false);
  const [isDeleting, setIsDeleting] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [previewUrl, setPreviewUrl] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const router = useRouter();

  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    // Validar arquivo
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
      setError('Tipo de arquivo não suportado. Use JPEG, PNG ou WebP');
      return;
    }

    if (file.size > 5 * 1024 * 1024) {
      setError('Arquivo muito grande. Máximo 5MB');
      return;
    }

    // Mostrar preview
    const reader = new FileReader();
    reader.onload = (e) => {
      setPreviewUrl(e.target?.result as string);
    };
    reader.readAsDataURL(file);

    // Upload automático
    handleUpload(file);
  };

  const handleUpload = async (file: File) => {
    setIsUploading(true);
    setError(null);

    try {
      const formData = new FormData();
      formData.append('file', file);
      
      await uploadProfilePicture(formData);
      
      // Reset preview e input
      setPreviewUrl(null);
      if (fileInputRef.current) {
        fileInputRef.current.value = '';
      }
      
      router.refresh();
      
    } catch (err) {
      console.error('Erro no upload:', err);
      setError(err instanceof Error ? err.message : 'Erro no upload');
      setPreviewUrl(null);
    } finally {
      setIsUploading(false);
    }
  };

  const handleDelete = async () => {
    setIsDeleting(true);
    setError(null);

    try {
      await deleteProfilePicture();
      router.refresh();
    } catch (err) {
      console.error('Erro ao deletar:', err);
      setError(err instanceof Error ? err.message : 'Erro ao deletar foto');
    } finally {
      setIsDeleting(false);
    }
  };

  const triggerFileInput = () => {
    fileInputRef.current?.click();
  };

  const displayImage = previewUrl || currentAvatar;

  return (
    <div className="flex flex-col items-center space-y-4">
      {/* Avatar Display */}
      <div className="relative">
        <div className="w-32 h-32 rounded-full overflow-hidden bg-gray-100 border-4 border-white shadow-lg">
          {displayImage ? (
            <Image
              src={displayImage}
              alt={userName || 'Foto de perfil'}
              width={128}
              height={128}
              className="w-full h-full object-cover"
            />
          ) : (
            <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300">
              <Camera className="w-8 h-8 text-gray-500" />
            </div>
          )}
          
          {/* Loading Overlay */}
          {(isUploading || isDeleting) && (
            <div className="absolute inset-0 bg-black/50 flex items-center justify-center rounded-full">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
            </div>
          )}
        </div>

        {/* Camera Icon Overlay */}
        {!isUploading && !isDeleting && (
          <button
            onClick={triggerFileInput}
            className="absolute bottom-0 right-0 bg-blue-600 hover:bg-blue-700 p-2 rounded-full text-white shadow-lg transition-colors"
            disabled={isUploading || isDeleting}
          >
            <Camera className="w-4 h-4" />
          </button>
        )}
      </div>

      {/* Upload Input */}
      <input
        ref={fileInputRef}
        type="file"
        accept="image/jpeg,image/jpg,image/png,image/webp"
        onChange={handleFileSelect}
        className="hidden"
        disabled={isUploading || isDeleting}
      />

      {/* Action Buttons */}
      <div className="flex gap-2">
        <Button
          variant="outline"
          size="sm"
          onClick={triggerFileInput}
          disabled={isUploading || isDeleting}
        >
          <Upload className="w-4 h-4 mr-2" />
          {currentAvatar ? 'Alterar' : 'Upload'}
        </Button>

        {currentAvatar && (
          <Button
            variant="destructive"
            size="sm"
            onClick={handleDelete}
            disabled={isUploading || isDeleting}
          >
            <Trash2 className="w-4 h-4 mr-2" />
            Remover
          </Button>
        )}
      </div>

      {/* Error Message */}
      {error && (
        <p className="text-red-600 text-sm text-center max-w-xs">
          {error}
        </p>
      )}

      {/* Upload Status */}
      {isUploading && (
        <p className="text-blue-600 text-sm">Fazendo upload...</p>
      )}
      
      {isDeleting && (
        <p className="text-red-600 text-sm">Removendo foto...</p>
      )}
    </div>
  );
}
</file>

<file path="components/filters/ResultsHeader.tsx">
'use client';

import { useFilters } from '@/lib/hooks/useFilters';
import { X } from 'lucide-react';

interface ResultsHeaderProps {
  total: number;
  page: number;
  limit: number;
  isLoading?: boolean;
}

export function ResultsHeader({ total, page, limit, isLoading }: ResultsHeaderProps) {
  const { filters, resetFilters } = useFilters();
  
  // Verificar se há filtros ativos
  const hasActiveFilters = 
    filters.search ||
    (filters.tags && filters.tags.length > 0) ||
    (filters.categories && filters.categories.length > 0) ||
    filters.minPrice ||
    filters.maxPrice ||
    filters.priceRange ||
    filters.location ||
    filters.city ||
    filters.state ||
    filters.dateFilter;

  const startItem = (page - 1) * limit + 1;
  const endItem = Math.min(page * limit, total);

  return (
    <div className="flex justify-between items-center mb-6 text-white">
      <div className="flex items-center gap-4">
        <h3 className="text-lg font-medium">
          {isLoading ? (
            <span className="animate-pulse">Carregando...</span>
          ) : total === 0 ? (
            'Nenhum resultado encontrado'
          ) : (
            <>
              Mostrando {startItem}-{endItem} de {total} produtos
            </>
          )}
        </h3>
        
        {hasActiveFilters && !isLoading && (
          <button
            onClick={resetFilters}
            className="flex items-center gap-2 px-3 py-1.5 text-sm text-gray-300 hover:text-white border border-gray-500 rounded-lg hover:border-gray-400 transition-colors"
          >
            <X className="h-3 w-3" />
            Limpar filtros
          </button>
        )}
      </div>

      {/* Mostrar filtros ativos */}
      {hasActiveFilters && !isLoading && (
        <div className="flex items-center gap-2 text-sm text-gray-400">
          <span>Filtros ativos:</span>
          <div className="flex gap-1">
            {filters.search && (
              <span className="px-2 py-1 bg-blue-500/20 text-blue-300 rounded">
                &quot;{filters.search}&quot;
              </span>
            )}
            {filters.tags && filters.tags.map((tag: string) => (
              <span key={tag} className="px-2 py-1 bg-green-500/20 text-green-300 rounded">
                #{tag}
              </span>
            ))}
            {filters.categories && filters.categories.map((category: string) => (
              <span key={category} className="px-2 py-1 bg-purple-500/20 text-purple-300 rounded">
                {category}
              </span>
            ))}
            {filters.priceRange && (
              <span className="px-2 py-1 bg-yellow-500/20 text-yellow-300 rounded">
                {filters.priceRange}
              </span>
            )}
            {(filters.minPrice || filters.maxPrice) && (
              <span className="px-2 py-1 bg-yellow-500/20 text-yellow-300 rounded">
                R$ {filters.minPrice || '0'} - {filters.maxPrice || '∞'}
              </span>
            )}
            {filters.dateFilter && (
              <span className="px-2 py-1 bg-red-500/20 text-red-300 rounded">
                {filters.dateFilter}
              </span>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="components/forms/form-criar-anuncio.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { createAd } from "@/app/(main)/dashboard/anunciar/actions";

export function FormCriarAnuncio() {
  const [loading, setLoading] = useState(false);
  const [title, setTitle] = useState("");
  const [price, setPrice] = useState("");
  const [category, setCategory] = useState("");
  const [contactPhone, setContactPhone] = useState("");
  const [imageUrl, setImageUrl] = useState("");
  const [description, setDescription] = useState("");

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    const formData = new FormData();
    formData.append("title", title);
    formData.append("price", price);
    formData.append("category", category);
    formData.append("contact_phone", contactPhone);
    formData.append("image_url", imageUrl);
    formData.append("description", description);

    try {
      await createAd(formData);
    } catch (error) {
      console.error(error);
      alert("Erro ao criar anúncio");
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="space-y-2">
        <Label htmlFor="title">Título do Anúncio</Label>
        <Input 
          id="title" 
          name="title" 
          required 
          placeholder="Ex: Placa de Vídeo RTX 3060"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="price">Preço (R$)</Label>
          <Input 
            id="price" 
            name="price" 
            type="number" 
            step="0.01" 
            required 
            placeholder="0,00"
            value={price}
            onChange={(e) => setPrice(e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="category">Categoria</Label>
          <Input 
            id="category" 
            name="category" 
            placeholder="Ex: GPU, Processador..."
            value={category}
            onChange={(e) => setCategory(e.target.value)}
          />
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="contact_phone">WhatsApp para Contato</Label>
        <Input 
          id="contact_phone" 
          name="contact_phone" 
          required 
          placeholder="Ex: 11999999999"
          value={contactPhone}
          onChange={(e) => setContactPhone(e.target.value)}
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="image_url">URL da Imagem (Temporário)</Label>
        <Input 
          id="image_url" 
          name="image_url" 
          placeholder="https://..."
          value={imageUrl}
          onChange={(e) => setImageUrl(e.target.value)}
        />
        <p className="text-xs text-gray-500">Em breve: Upload de arquivos.</p>
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">Descrição</Label>
        <textarea 
          id="description" 
          name="description" 
          className="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          required 
          placeholder="Descreva os detalhes do produto..."
          value={description}
          onChange={(e) => setDescription(e.target.value)}
        />
      </div>

      <Button type="submit" className="w-full" disabled={loading}>
        {loading ? "Publicando..." : "Publicar Anúncio"}
      </Button>
    </form>
  );
}
</file>

<file path="components/modals/modal-editar-anuncio.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Pencil, X } from "lucide-react";
import { updateAd } from "@/app/(main)/dashboard/meus-anuncios/actions";

interface Product {
  id: string;
  title: string;
  price: number;
  description: string;
  category: string;
  contact_phone: string;
  images_urls: string[];
}

interface EditAdModalProps {
  product: Product;
}

export function ModalEditarAnuncio({ product }: EditAdModalProps) {
  const [isOpen, setIsOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  
  const [title, setTitle] = useState(product.title);
  const [price, setPrice] = useState(product.price.toString());
  const [category, setCategory] = useState(product.category || "");
  const [contactPhone, setContactPhone] = useState(product.contact_phone || "");
  const [imageUrl, setImageUrl] = useState(product.images_urls?.[0] || "");
  const [description, setDescription] = useState(product.description || "");

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    const formData = new FormData();
    formData.append("title", title);
    formData.append("price", price);
    formData.append("category", category);
    formData.append("contact_phone", contactPhone);
    formData.append("image_url", imageUrl);
    formData.append("description", description);

    try {
      await updateAd(product.id, formData);
      setIsOpen(false);
    } catch (error) {
      console.error(error);
      alert("Erro ao atualizar anúncio");
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <Button variant="outline" size="sm" onClick={() => setIsOpen(true)} className="w-full mt-2">
        <Pencil className="w-4 h-4 mr-2" />
        Editar
      </Button>

      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="bg-background rounded-lg shadow-lg w-full max-w-lg max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-4 border-b">
          <h2 className="text-lg font-semibold">Editar Anúncio</h2>
          <Button variant="ghost" size="icon" onClick={() => setIsOpen(false)}>
            <X className="w-4 h-4" />
          </Button>
        </div>
        
        <div className="p-4">
          <form onSubmit={handleSubmit} className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="edit-title">Título do Anúncio</Label>
              <Input 
                id="edit-title" 
                required 
                value={title}
                onChange={(e) => setTitle(e.target.value)}
              />
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="edit-price">Preço (R$)</Label>
                <Input 
                  id="edit-price" 
                  type="number" 
                  step="0.01" 
                  required 
                  value={price}
                  onChange={(e) => setPrice(e.target.value)}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="edit-category">Categoria</Label>
                <Input 
                  id="edit-category" 
                  value={category}
                  onChange={(e) => setCategory(e.target.value)}
                />
              </div>
            </div>

            <div className="space-y-2">
              <Label htmlFor="edit-contact_phone">WhatsApp</Label>
              <Input 
                id="edit-contact_phone" 
                required 
                value={contactPhone}
                onChange={(e) => setContactPhone(e.target.value)}
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="edit-image_url">URL da Imagem</Label>
              <Input 
                id="edit-image_url" 
                value={imageUrl}
                onChange={(e) => setImageUrl(e.target.value)}
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="edit-description">Descrição</Label>
              <textarea 
                id="edit-description" 
                className="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                required 
                value={description}
                onChange={(e) => setDescription(e.target.value)}
              />
            </div>

            <div className="flex gap-2 pt-2">
              <Button type="button" variant="outline" className="w-full" onClick={() => setIsOpen(false)}>
                Cancelar
              </Button>
              <Button type="submit" className="w-full" disabled={loading}>
                {loading ? "Salvando..." : "Salvar Alterações"}
              </Button>
            </div>
          </form>
        </div>
      </div>
    </div>
      )}
    </>
  );
}
</file>

<file path="components/ui/badge.tsx">
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  );
}

export { Badge, badgeVariants };
</file>

<file path="components/ui/botao-excluir-anuncio.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { deleteAd } from "@/app/(main)/dashboard/meus-anuncios/actions";
import { Trash2 } from "lucide-react";

interface DeleteAdButtonProps {
  productId: string;
}

export function BotaoExcluirAnuncio({ productId }: DeleteAdButtonProps) {
  const [isDeleting, setIsDeleting] = useState(false);

  const handleDelete = async (e: React.MouseEvent) => {
    e.preventDefault(); // Prevent Link navigation if inside a Link
    e.stopPropagation(); // Prevent bubbling

    if (!confirm("Tem certeza que deseja excluir este anúncio? Esta ação não pode ser desfeita.")) {
      return;
    }

    setIsDeleting(true);
    try {
      await deleteAd(productId);
    } catch (error) {
      console.error(error);
      alert("Erro ao excluir anúncio");
    } finally {
      setIsDeleting(false);
    }
  };

  return (
    <Button 
      variant="destructive" 
      size="sm" 
      onClick={handleDelete} 
      disabled={isDeleting}
      className="w-full mt-2"
    >
      {isDeleting ? (
        "Excluindo..."
      ) : (
        <>
          <Trash2 className="w-4 h-4 mr-2" />
          Excluir
        </>
      )}
    </Button>
  );
}
</file>

<file path="components/ui/botao-favoritar.tsx">
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Heart } from "lucide-react";
import { toggleFavorite } from "@/app/(main)/anuncio/[id]/actions";
import { cn } from "@/lib/utils";

interface FavoriteButtonProps {
  productId: string;
  initialIsFavorite: boolean;
}

export function BotaoFavoritar({ productId, initialIsFavorite }: FavoriteButtonProps) {
  const [isFavorite, setIsFavorite] = useState(initialIsFavorite);
  const [isLoading, setIsLoading] = useState(false);

  const handleToggle = async () => {
    setIsLoading(true);
    // Optimistic update
    const newState = !isFavorite;
    setIsFavorite(newState);

    try {
      await toggleFavorite(productId);
    } catch (error) {
      console.error("Error toggling favorite:", error);
      // Revert on error
      setIsFavorite(!newState);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Button
      variant="outline"
      size="icon"
      onClick={handleToggle}
      disabled={isLoading}
      className={cn(
        "rounded-full transition-colors",
        isFavorite && "bg-red-50 border-red-200 hover:bg-red-100 hover:border-red-300"
      )}
    >
      <Heart
        className={cn(
          "w-5 h-5 transition-colors",
          isFavorite ? "fill-red-500 text-red-500" : "text-gray-500"
        )}
      />
      <span className="sr-only">Favoritar</span>
    </Button>
  );
}
</file>

<file path="components/ui/botao-sair.tsx">
"use client";

import { createClient } from "@/lib/supabase/client";
import { Button } from "@/components/ui/button";
import { useRouter } from "next/navigation";

export function BotaoSair({ className }: { className?: string }) {
  const router = useRouter();

  const logout = async () => {
    const supabase = createClient();
    await supabase.auth.signOut();
    router.push("/auth/login");
  };

  return (
    <Button onClick={logout} className={className}>
      Logout
    </Button>
  );
}
</file>

<file path="components/ui/button.tsx">
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",
        outline:
          "border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2",
        sm: "h-8 rounded-md px-3 text-xs",
        lg: "h-10 rounded-md px-8",
        icon: "h-9 w-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    );
  },
);
Button.displayName = "Button";

export { Button, buttonVariants };
</file>

<file path="components/ui/checkbox.tsx">
"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { Check } from "lucide-react";

import { cn } from "@/lib/utils";

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className,
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
));
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };
</file>

<file path="components/ui/dropdown-menu.tsx">
"use client";

import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";
import { Check, ChevronRight, Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const DropdownMenu = DropdownMenuPrimitive.Root;

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;

const DropdownMenuGroup = DropdownMenuPrimitive.Group;

const DropdownMenuPortal = DropdownMenuPrimitive.Portal;

const DropdownMenuSub = DropdownMenuPrimitive.Sub;

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className,
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
));
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName;

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
      className,
    )}
    {...props}
  />
));
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName;

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md",
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
        className,
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
));
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className,
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
));
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName;

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
));
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
));
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  );
};
DropdownMenuShortcut.displayName = "DropdownMenuShortcut";

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
};
</file>

<file path="components/ui/progress.tsx">
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
</file>

<file path="components/ui/separator.tsx">
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }
</file>

<file path="components/ui/tabs.tsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"
import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="docker-compose.yml">
services:
  app:
    build: .
    container_name: marketplace_app
    restart: always
    ports:
      - "3001:3000" 
    env_file:
      - .env.local
</file>

<file path="Dockerfile">
FROM node:20-alpine AS base

# 1. Instalar dependências apenas quando necessário
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci

# 2. Reconstruir o código-fonte apenas quando necessário
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# 3. Imagem de produção, copie todos os arquivos e execute o next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Define a permissão correta para o cache do Next.js
RUN mkdir .next
RUN chown nextjs:nodejs .next

# Copia o build standalone do step builder
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
</file>

<file path="env.local">
NEXT_PUBLIC_SUPABASE_URL=https://igrjfsyvignueeipglmp.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_WPusbvFKSox5cNcb1R5QEA_hC21Vtzp
</file>

<file path="lib/hooks/useNewsletter.ts">
'use client';

import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export function useNewsletter() {
  const [email, setEmail] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [message, setMessage] = useState('');
  const [isSuccess, setIsSuccess] = useState(false);

  const subscribe = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email) {
      setMessage('Por favor, digite um email válido');
      setIsSuccess(false);
      return;
    }

    // Validar formato do email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      setMessage('Por favor, digite um email válido');
      setIsSuccess(false);
      return;
    }

    setIsLoading(true);
    setMessage('');

    try {
      const supabase = createClient();
      
      // Verificar se o email já está cadastrado
      const { data: existingEmail } = await supabase
        .from('newsletter')
        .select('email')
        .eq('email', email)
        .single();

      if (existingEmail) {
        setMessage('Este email já está cadastrado na nossa newsletter!');
        setIsSuccess(false);
        setIsLoading(false);
        return;
      }

      // Cadastrar o email
      const { error } = await supabase
        .from('newsletter')
        .insert({ email });

      if (error) {
        throw error;
      }

      setMessage('Obrigado! Email cadastrado com sucesso na nossa newsletter!');
      setIsSuccess(true);
      setEmail('');
      
      // Limpar mensagem após 5 segundos
      setTimeout(() => {
        setMessage('');
        setIsSuccess(false);
      }, 5000);

    } catch (error) {
      console.error('Erro ao cadastrar email:', error);
      setMessage('Erro ao cadastrar email. Tente novamente.');
      setIsSuccess(false);
    } finally {
      setIsLoading(false);
    }
  };

  return {
    email,
    setEmail,
    isLoading,
    message,
    isSuccess,
    subscribe
  };
}
</file>

<file path="lib/supabase/client.ts">
import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,
  );
}
</file>

<file path="lib/supabase/proxy.ts">
import { createServerClient } from "@supabase/ssr";
import { NextResponse, type NextRequest } from "next/server";
import { hasEnvVars } from "../utils";

export async function updateSession(request: NextRequest) {
  let supabaseResponse = NextResponse.next({
    request,
  });

  // If the env vars are not set, skip proxy check. You can remove this
  // once you setup the project.
  if (!hasEnvVars) {
    return supabaseResponse;
  }

  // With Fluid compute, don't put this client in a global environment
  // variable. Always create a new one on each request.
  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value),
          );
          supabaseResponse = NextResponse.next({
            request,
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options),
          );
        },
      },
    },
  );

  // Do not run code between createServerClient and
  // supabase.auth.getClaims(). A simple mistake could make it very hard to debug
  // issues with users being randomly logged out.

  // IMPORTANT: If you remove getClaims() and you use server-side rendering
  // with the Supabase client, your users may be randomly logged out.
  const { data } = await supabase.auth.getClaims();
  const user = data?.claims;

  if (
    request.nextUrl.pathname !== "/" &&
    !user &&
    !request.nextUrl.pathname.startsWith("/login") &&
    !request.nextUrl.pathname.startsWith("/auth")
  ) {
    // no user, potentially respond by redirecting the user to the login page
    const url = request.nextUrl.clone();
    url.pathname = "/auth/login";
    return NextResponse.redirect(url);
  }

  // IMPORTANT: You *must* return the supabaseResponse object as it is.
  // If you're creating a new response object with NextResponse.next() make sure to:
  // 1. Pass the request in it, like so:
  //    const myNewResponse = NextResponse.next({ request })
  // 2. Copy over the cookies, like so:
  //    myNewResponse.cookies.setAll(supabaseResponse.cookies.getAll())
  // 3. Change the myNewResponse object to fit your needs, but avoid changing
  //    the cookies!
  // 4. Finally:
  //    return myNewResponse
  // If this is not done, you may be causing the browser and server to go out
  // of sync and terminate the user's session prematurely!

  return supabaseResponse;
}
</file>

<file path="lib/supabase/server.ts">
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

/**
 * Especially important if using Fluid compute: Don't put this client in a
 * global variable. Always create a new client within each function when using
 * it.
 */
export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options),
            );
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have proxy refreshing
            // user sessions.
          }
        },
      },
    },
  );
}
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;
</file>

<file path="public/favicon.svg">
<svg width="34" height="37" viewBox="0 0 34 37" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.4487 0C18.281 0 21.6299 0.776813 24.4955 2.33044C27.3956 3.84954 29.6225 5.99009 31.1761 8.7521C32.7297 11.5141 33.5065 14.6731 33.5065 18.2292C33.5065 21.7508 32.7125 24.8926 31.1243 27.6546C29.5707 30.4166 27.3438 32.5916 24.4437 34.1798C21.5781 35.7334 18.2465 36.5102 14.4487 36.5102H0V0H14.4487ZM13.6719 27.551C16.6411 27.551 18.9715 26.7396 20.6632 25.117C22.355 23.4943 23.2008 21.1984 23.2008 18.2292C23.2008 15.2255 22.355 12.9124 20.6632 11.2897C18.9715 9.63249 16.6411 8.80389 13.6719 8.80389H10.1504V27.551H13.6719Z" fill="#ECF230"/>
</svg>
</file>

<file path="public/figma/decor-d.svg">
<svg width="863" height="835" viewBox="0 0 863 835" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M774.394 198.513C822.296 268.039 850.572 337.145 859.224 405.833C868.905 474.71 858.9 539.164 829.209 599.193C799.938 659.833 752.674 712.633 687.418 757.593C622.161 802.554 555.989 827.91 488.9 833.661C422.842 839.601 359.357 825.781 298.446 792.2C238.566 758.808 184.674 707.35 136.772 637.824L-5.39132e-05 439.311L637.621 0L774.394 198.513ZM205.383 590.553C262.109 672.885 327.039 720.785 400.174 734.253C473.918 747.3 550.127 726.721 628.801 672.516C708.084 617.891 754.859 553.286 769.126 478.701C783.813 404.727 763.004 326.878 706.698 245.155L627.282 129.889L125.967 475.287L205.383 590.553Z" fill="white" fill-opacity="0.51"/>
</svg>
</file>

<file path="public/figma/icon-cpu.svg">
<svg width="78" height="78" viewBox="0 0 78 78" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M46.3125 29.25L31.6875 29.25C31.041 29.25 30.421 29.5068 29.9639 29.9639C29.5068 30.421 29.25 31.041 29.25 31.6875L29.25 46.3125C29.25 46.959 29.5068 47.579 29.9639 48.0361C30.421 48.4932 31.041 48.75 31.6875 48.75L46.3125 48.75C46.959 48.75 47.579 48.4932 48.0361 48.0361C48.4932 47.579 48.75 46.959 48.75 46.3125L48.75 31.6875C48.75 31.041 48.4932 30.421 48.0361 29.9639C47.579 29.5068 46.959 29.25 46.3125 29.25ZM43.875 43.875L34.125 43.875L34.125 34.125L43.875 34.125L43.875 43.875ZM70.6875 43.875L65.8125 43.875L65.8125 34.125L70.6875 34.125C71.334 34.125 71.954 33.8682 72.4111 33.4111C72.8682 32.954 73.125 32.334 73.125 31.6875C73.125 31.041 72.8682 30.421 72.4111 29.9639C71.954 29.5068 71.334 29.25 70.6875 29.25L65.8125 29.25L65.8125 17.0625C65.8125 15.7696 65.2989 14.5296 64.3846 13.6154C63.4704 12.7011 62.2304 12.1875 60.9375 12.1875L48.75 12.1875L48.75 7.3125C48.75 6.66603 48.4932 6.04605 48.0361 5.58893C47.579 5.13181 46.959 4.875 46.3125 4.875C45.666 4.875 45.046 5.13181 44.5889 5.58893C44.1318 6.04605 43.875 6.66603 43.875 7.3125L43.875 12.1875L34.125 12.1875L34.125 7.3125C34.125 6.66603 33.8682 6.04605 33.4111 5.58893C32.954 5.13181 32.334 4.875 31.6875 4.875C31.041 4.875 30.421 5.13181 29.9639 5.58893C29.5068 6.04605 29.25 6.66603 29.25 7.3125L29.25 12.1875L17.0625 12.1875C15.7696 12.1875 14.5296 12.7011 13.6154 13.6154C12.7011 14.5296 12.1875 15.7696 12.1875 17.0625L12.1875 29.25L7.3125 29.25C6.66603 29.25 6.04605 29.5068 5.58893 29.9639C5.13181 30.421 4.875 31.041 4.875 31.6875C4.875 32.334 5.13181 32.954 5.58893 33.4111C6.04605 33.8682 6.66604 34.125 7.3125 34.125L12.1875 34.125L12.1875 43.875L7.3125 43.875C6.66604 43.875 6.04605 44.1318 5.58893 44.5889C5.13181 45.046 4.875 45.666 4.875 46.3125C4.875 46.959 5.13181 47.579 5.58893 48.0361C6.04605 48.4932 6.66604 48.75 7.3125 48.75L12.1875 48.75L12.1875 60.9375C12.1875 62.2304 12.7011 63.4704 13.6154 64.3846C14.5296 65.2989 15.7696 65.8125 17.0625 65.8125L29.25 65.8125L29.25 70.6875C29.25 71.334 29.5068 71.954 29.9639 72.4111C30.421 72.8682 31.041 73.125 31.6875 73.125C32.334 73.125 32.954 72.8682 33.4111 72.4111C33.8682 71.954 34.125 71.334 34.125 70.6875L34.125 65.8125L43.875 65.8125L43.875 70.6875C43.875 71.334 44.1318 71.954 44.5889 72.4111C45.046 72.8682 45.666 73.125 46.3125 73.125C46.959 73.125 47.579 72.8682 48.0361 72.4111C48.4932 71.954 48.75 71.334 48.75 70.6875L48.75 65.8125L60.9375 65.8125C62.2304 65.8125 63.4704 65.2989 64.3846 64.3846C65.2989 63.4704 65.8125 62.2304 65.8125 60.9375L65.8125 48.75L70.6875 48.75C71.334 48.75 71.954 48.4932 72.4111 48.0361C72.8682 47.579 73.125 46.959 73.125 46.3125C73.125 45.666 72.8682 45.046 72.4111 44.5889C71.954 44.1318 71.334 43.875 70.6875 43.875ZM60.9375 60.9375L17.0625 60.9375L17.0625 17.0625L60.9375 17.0625L60.9375 46.2729C60.9375 46.2729 60.9375 46.3003 60.9375 46.3125C60.9375 46.3247 60.9375 46.3399 60.9375 46.3521L60.9375 60.9375Z" fill="#0F0F0F"/>
</svg>
</file>

<file path="public/figma/icon-users-three.svg">
<svg width="81" height="81" viewBox="0 0 81 81" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M77.4563 47.5875C77.1903 47.7869 76.8877 47.932 76.5657 48.0145C76.2437 48.097 75.9086 48.1153 75.5795 48.0683C75.2505 48.0213 74.9339 47.9099 74.6478 47.7405C74.3618 47.5712 74.1119 47.3471 73.9125 47.0812C72.3868 45.0305 70.401 43.3666 68.1148 42.2235C65.8286 41.0804 63.306 40.49 60.75 40.5C60.2522 40.4999 59.7655 40.3531 59.3508 40.0779C58.936 39.8027 58.6116 39.4113 58.4181 38.9527C58.2867 38.6413 58.219 38.3067 58.219 37.9687C58.219 37.6307 58.2867 37.2961 58.4181 36.9847C58.6116 36.5261 58.936 36.1347 59.3508 35.8595C59.7655 35.5843 60.2522 35.4375 60.75 35.4375C62.1703 35.4373 63.562 35.0389 64.7672 34.2874C65.9724 33.536 66.9426 32.4616 67.5678 31.1864C68.193 29.9111 68.448 28.4861 68.3039 27.0731C68.1598 25.6602 67.6223 24.316 66.7525 23.1932C65.8827 22.0705 64.7155 21.2141 63.3835 20.7215C62.0514 20.2288 60.6078 20.1196 59.2168 20.4062C57.8258 20.6928 56.543 21.3638 55.5142 22.343C54.4854 23.3221 53.7518 24.5701 53.3967 25.9453C53.3136 26.2673 53.1679 26.5698 52.9679 26.8355C52.7679 27.1012 52.5175 27.3249 52.231 27.4939C51.9446 27.6628 51.6276 27.7737 51.2983 27.8201C50.969 27.8666 50.6338 27.8477 50.3118 27.7646C49.9897 27.6815 49.6872 27.5358 49.4215 27.3358C49.1558 27.1358 48.9321 26.8854 48.7632 26.5989C48.5942 26.3125 48.4834 25.9955 48.4369 25.6662C48.3905 25.3369 48.4093 25.0017 48.4924 24.6796C48.9852 22.7727 49.9163 21.0071 51.2116 19.5233C52.5068 18.0396 54.1305 16.8786 55.9534 16.1327C57.7763 15.3869 59.7482 15.0768 61.712 15.2271C63.6758 15.3774 65.5775 15.984 67.2657 16.9986C68.9538 18.0132 70.3819 19.4078 71.4362 21.0714C72.4906 22.735 73.1421 24.6218 73.339 26.5815C73.5358 28.5412 73.2726 30.5198 72.5702 32.3599C71.8678 34.2 70.7456 35.8508 69.293 37.1809C72.7349 38.6711 75.727 41.036 77.972 44.0405C78.1714 44.3071 78.3163 44.6105 78.3983 44.9332C78.4804 45.2558 78.4979 45.5915 78.45 45.921C78.4021 46.2505 78.2897 46.5673 78.1191 46.8532C77.9486 47.1392 77.7234 47.3887 77.4563 47.5875ZM60.4083 67.0781C60.5914 67.3662 60.7144 67.6884 60.7698 68.0252C60.8252 68.3621 60.8119 68.7067 60.7307 69.0382C60.6495 69.3698 60.502 69.6816 60.2972 69.9547C60.0924 70.2278 59.8344 70.4567 59.5389 70.6275C59.2433 70.7984 58.9162 70.9076 58.5773 70.9488C58.2384 70.99 57.8947 70.9622 57.5669 70.867C57.239 70.7719 56.9338 70.6115 56.6695 70.3953C56.4053 70.1792 56.1875 69.9118 56.0292 69.6093C54.4347 66.9093 52.1637 64.6717 49.4405 63.1173C46.7172 61.5629 43.6357 60.7453 40.5 60.7453C37.3643 60.7453 34.2828 61.5629 31.5595 63.1173C28.8363 64.6717 26.5653 66.9093 24.9708 69.6093C24.8125 69.9118 24.5947 70.1792 24.3305 70.3953C24.0662 70.6115 23.761 70.7719 23.4331 70.867C23.1053 70.9622 22.7615 70.99 22.4227 70.9488C22.0838 70.9076 21.7567 70.7984 21.4611 70.6275C21.1656 70.4567 20.9076 70.2278 20.7028 69.9547C20.498 69.6816 20.3505 69.3698 20.2693 69.0382C20.1881 68.7067 20.1748 68.3621 20.2302 68.0252C20.2856 67.6884 20.4086 67.3662 20.5917 67.0781C23.0458 62.8616 26.7876 59.5434 31.2673 57.6112C28.7465 55.6812 26.894 53.0099 25.97 49.9726C25.046 46.9353 25.097 43.6849 26.1159 40.6781C27.1348 37.6713 29.0703 35.0594 31.6503 33.2096C34.2304 31.3597 37.3253 30.3648 40.5 30.3648C43.6747 30.3648 46.7696 31.3597 49.3497 33.2096C51.9297 35.0594 53.8652 37.6713 54.8841 40.6781C55.903 43.6849 55.954 46.9353 55.03 49.9726C54.106 53.0099 52.2535 55.6812 49.7327 57.6112C54.2124 59.5434 57.9542 62.8616 60.4083 67.0781ZM40.5 55.6875C42.5025 55.6875 44.4601 55.0936 46.1251 53.9811C47.7902 52.8685 49.0879 51.2872 49.8543 49.4371C50.6206 47.587 50.8211 45.5512 50.4305 43.5872C50.0398 41.6231 49.0755 39.819 47.6595 38.403C46.2434 36.987 44.4393 36.0227 42.4753 35.632C40.5112 35.2413 38.4754 35.4418 36.6253 36.2082C34.7752 36.9745 33.1939 38.2723 32.0814 39.9373C30.9688 41.6024 30.375 43.5599 30.375 45.5625C30.375 48.2478 31.4417 50.8231 33.3405 52.7219C35.2393 54.6207 37.8147 55.6875 40.5 55.6875ZM22.7813 37.9687C22.7813 37.2974 22.5146 36.6535 22.0399 36.1788C21.5652 35.7041 20.9213 35.4375 20.25 35.4375C18.8297 35.4373 17.438 35.0389 16.2328 34.2874C15.0276 33.536 14.0574 32.4616 13.4322 31.1864C12.807 29.9111 12.552 28.4861 12.6961 27.0731C12.8402 25.6602 13.3777 24.316 14.2475 23.1932C15.1173 22.0705 16.2845 21.2141 17.6165 20.7215C18.9486 20.2288 20.3922 20.1196 21.7832 20.4062C23.1742 20.6928 24.457 21.3638 25.4858 22.343C26.5146 23.3221 27.2482 24.5701 27.6033 25.9453C27.7711 26.5956 28.1904 27.1527 28.769 27.4939C29.3475 27.835 30.0379 27.9324 30.6882 27.7646C31.3386 27.5968 31.8956 27.1775 32.2368 26.5989C32.578 26.0204 32.6754 25.33 32.5076 24.6796C32.0148 22.7727 31.0837 21.0071 29.7884 19.5233C28.4932 18.0396 26.8695 16.8786 25.0466 16.1327C23.2237 15.3869 21.2518 15.0768 19.288 15.2271C17.3241 15.3774 15.4225 15.984 13.7343 16.9986C12.0462 18.0132 10.6181 19.4078 9.56376 21.0714C8.50942 22.735 7.8579 24.6218 7.66104 26.5815C7.46419 28.5412 7.72744 30.5198 8.42983 32.3599C9.13223 34.2 10.2544 35.8508 11.707 37.1809C8.26859 38.6725 5.27991 41.0373 3.0375 44.0405C2.63428 44.5776 2.46093 45.2528 2.55557 45.9177C2.65021 46.5826 3.0051 47.1827 3.54217 47.5859C4.07923 47.9891 4.75447 48.1624 5.41935 48.0678C6.08423 47.9732 6.68428 47.6183 7.0875 47.0812C8.61317 45.0305 10.599 43.3666 12.8852 42.2235C15.1714 41.0804 17.694 40.49 20.25 40.5C20.9213 40.5 21.5652 40.2333 22.0399 39.7586C22.5146 39.2839 22.7813 38.64 22.7813 37.9687Z" fill="black"/>
</svg>
</file>

<file path="public/figma/x.svg">
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M26.8438 26.4638L19.0187 14.1663L26.74 5.6725C26.9146 5.47566 27.0046 5.21791 26.9905 4.95515C26.9764 4.69239 26.8592 4.44579 26.6645 4.26882C26.4697 4.09185 26.2131 3.99876 25.9502 4.00974C25.6873 4.02073 25.4393 4.1349 25.26 4.3275L17.905 12.4175L12.8437 4.46375C12.7535 4.32169 12.6288 4.20471 12.4814 4.12365C12.3339 4.04258 12.1683 4.00005 12 4H5.99999C5.82069 3.99991 5.64467 4.04803 5.49035 4.13932C5.33603 4.23062 5.2091 4.36172 5.12284 4.5189C5.03658 4.67609 4.99417 4.85357 5.00004 5.03278C5.00592 5.21198 5.05987 5.3863 5.15624 5.5375L12.9812 17.8338L5.25999 26.3338C5.16983 26.4306 5.09978 26.5444 5.05391 26.6685C5.00805 26.7927 4.98728 26.9247 4.9928 27.0569C4.99832 27.1891 5.03004 27.3189 5.08609 27.4388C5.14215 27.5586 5.22145 27.6662 5.31938 27.7552C5.41731 27.8442 5.53193 27.9129 5.6566 27.9572C5.78127 28.0016 5.91351 28.0208 6.04565 28.0137C6.17779 28.0066 6.3072 27.9733 6.42639 27.9158C6.54558 27.8583 6.65217 27.7777 6.73999 27.6788L14.095 19.5888L19.1562 27.5425C19.2472 27.6834 19.3722 27.7992 19.5196 27.8791C19.6671 27.959 19.8323 28.0006 20 28H26C26.1791 27.9999 26.3549 27.9518 26.509 27.8606C26.6632 27.7693 26.79 27.6384 26.8762 27.4814C26.9624 27.3244 27.0049 27.1472 26.9992 26.9681C26.9935 26.7891 26.9398 26.6149 26.8438 26.4638ZM20.5487 26L7.82124 6H11.4462L24.1788 26H20.5487Z" fill="white" fill-opacity="0.55"/>
</svg>
</file>

<file path="public/logo-nkw.svg">
<svg width="90" height="27" viewBox="0 0 90 27" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M22.4563 2.24707C22.5681 2.24707 22.7258 2.29826 22.9287 2.40003C23.1315 2.50242 23.2329 2.7738 23.2329 3.21418V21.4905C23.2329 22.8363 23.0388 23.7572 22.6516 24.2536C22.262 24.7884 21.661 25.0554 20.8484 25.0554H18.8249C18.4552 25.0554 18.141 25.0283 17.8825 24.9741C17.7538 24.9364 17.624 24.8945 17.4942 24.8482C17.3656 24.8026 17.2455 24.7421 17.1355 24.6681C16.9128 24.5398 16.7087 24.3376 16.5245 24.0612C16.4317 23.9317 16.3303 23.7843 16.2203 23.6196C16.1096 23.4537 15.9988 23.2595 15.8888 23.0374L7.10002 7.49954C7.08146 7.46377 7.06353 7.44156 7.04561 7.43293C7.02705 7.42307 7.01839 7.41813 7.01839 7.41813H6.87987C6.87987 7.41813 6.87987 7.42307 6.87987 7.43293C6.87987 7.44156 6.87987 7.45452 6.87987 7.4724V24.0884C6.87987 24.5127 6.78216 24.7803 6.58798 24.8901C6.39319 25.0006 6.23178 25.0554 6.10316 25.0554H3.63449C3.50586 25.0554 3.33889 25.0006 3.13482 24.8901C2.93198 24.7803 2.83057 24.5127 2.83057 24.0884V5.8145C2.83057 4.46932 3.02474 3.53861 3.41433 3.02175C3.82001 2.5055 4.41986 2.24707 5.21513 2.24707H7.29543C7.47972 2.24707 7.65473 2.25201 7.81984 2.26187C7.98619 2.27051 8.13461 2.28408 8.26509 2.30382C8.56008 2.35809 8.81919 2.46849 9.04181 2.63441C9.2261 2.76455 9.42028 2.97672 9.62311 3.27093C9.71525 3.39921 9.81172 3.54662 9.91252 3.71253C10.0146 3.87907 10.1209 4.06287 10.2316 4.26517L18.9932 19.803C19.0111 19.8591 19.0383 19.8868 19.0747 19.8868H19.2133C19.2133 19.8672 19.2133 19.8572 19.2133 19.8572C19.2133 19.8572 19.2133 19.8487 19.2133 19.8301V3.21418C19.2133 2.7738 19.3104 2.50242 19.5051 2.40003C19.6994 2.29826 19.8613 2.24707 19.9901 2.24707H22.4563Z" fill="white"/>
<path d="M42.3292 15.5448L47.1256 23.8391C47.2357 23.9693 47.2727 24.1815 47.2368 24.4756C47.1985 24.8624 46.9857 25.0554 46.5986 25.0554H43.6056C43.3285 25.0554 43.1338 25.0006 43.0218 24.8901C42.9111 24.7982 42.8097 24.6694 42.7176 24.5029L38.3937 16.9288C38.098 16.3749 37.7933 16.0154 37.4785 15.8507C37.1649 15.6669 36.6659 15.5744 35.9819 15.5744H33.1818V24.0884C33.1818 24.5127 33.0804 24.7803 32.8776 24.8901C32.6746 25.0006 32.517 25.0554 32.405 25.0554H29.8547C29.7441 25.0554 29.5827 25.0006 29.3699 24.8901C29.1572 24.7803 29.0508 24.5127 29.0508 24.0884V3.21418C29.0508 2.7738 29.1572 2.50242 29.3699 2.40003C29.5827 2.29826 29.7441 2.24707 29.8547 2.24707H32.405C32.517 2.24707 32.6746 2.29826 32.8776 2.40003C33.0804 2.50242 33.1818 2.7738 33.1818 3.21418V11.4815H35.732C35.9163 11.4815 36.0821 11.4777 36.2293 11.4691C36.3777 11.4592 36.5075 11.4457 36.62 11.4272C36.8409 11.3896 37.0344 11.3334 37.2014 11.2594C37.3677 11.1675 37.5155 11.0392 37.6441 10.8745C37.7183 10.7826 37.7963 10.6766 37.8792 10.5563C37.9633 10.4366 38.0425 10.3114 38.1167 10.1813L42.302 2.79971C42.3762 2.65353 42.4776 2.52463 42.6062 2.41237C42.7163 2.30259 42.9204 2.24707 43.2172 2.24707H45.9605C46.2931 2.24707 46.5059 2.40436 46.5986 2.71829C46.6345 2.95698 46.6067 3.1784 46.5146 3.38195L41.9408 11.3976C41.6638 11.8601 41.4146 12.2752 41.1938 12.6435C41.101 12.7717 41.0132 12.8963 40.9291 13.016C40.8462 13.1362 40.7591 13.2516 40.667 13.3613C40.944 13.6199 41.221 13.9331 41.4981 14.3014C41.7751 14.6701 42.0521 15.0846 42.3292 15.5448Z" fill="white"/>
<path d="M86.5285 1.94434C86.7511 1.94434 86.9033 1.9906 86.986 2.0825C87.0702 2.17501 87.1209 2.26691 87.1395 2.35881C87.1938 2.54323 87.1747 2.76465 87.0826 3.02246L80.9035 22.1523C80.496 23.1676 80.0885 23.8498 79.6816 24.2001C79.6271 24.2364 79.5665 24.2827 79.501 24.3383C79.4366 24.3925 79.3581 24.4388 79.266 24.4764C78.7119 24.8631 78.0743 25.0561 77.3538 25.0561C76.5969 25.0561 75.908 24.8262 75.2884 24.3654C74.6699 23.9053 74.2594 23.3156 74.0566 22.5964C74.0367 22.541 74.0082 22.4756 73.9724 22.4016C73.9359 22.3276 73.8989 22.2548 73.8611 22.1819L70.0368 9.43694L65.9332 22.1523C65.7304 22.6693 65.5263 23.0936 65.3222 23.4254C65.1194 23.7579 64.9165 24.0163 64.7137 24.2001C64.6395 24.2364 64.5739 24.2827 64.5182 24.3383C64.4638 24.3925 64.3902 24.4388 64.2981 24.4764C63.744 24.8631 63.1065 25.0561 62.386 25.0561C61.6272 25.0561 60.9389 24.8262 60.3205 24.3654C59.7022 23.9053 59.2903 23.3156 59.0862 22.5964C59.0676 22.541 59.0399 22.4756 59.0021 22.4016C58.9656 22.3276 58.9291 22.2548 58.8932 22.1819L53.1545 3.02246C53.0617 2.80043 53.0438 2.57962 53.1001 2.35881C53.118 2.2848 53.1643 2.19784 53.2385 2.0973C53.3127 1.99553 53.46 1.94434 53.6813 1.94434H56.6473C57.0362 1.94434 57.304 2.14665 57.4511 2.55124L62.3019 19.1672C62.3019 19.1857 62.3056 19.1993 62.3143 19.2091C62.3241 19.2191 62.3291 19.2239 62.3291 19.2239L62.4404 19.1943C62.4404 19.1943 62.4404 19.1906 62.4404 19.182C62.4404 19.1722 62.4504 19.1585 62.4701 19.1401L67.7067 2.55124C67.8732 2.14665 68.1409 1.94434 68.5106 1.94434H71.6447C72.014 1.94434 72.2718 2.14665 72.419 2.55124L77.2722 19.1672C77.2722 19.1857 77.2759 19.1993 77.2846 19.2091C77.2944 19.2191 77.2994 19.2239 77.2994 19.2239L77.4108 19.1943C77.4108 19.1943 77.4108 19.1906 77.4108 19.182C77.4108 19.1722 77.4195 19.1585 77.438 19.1401L82.6771 2.55124C82.8434 2.14665 83.1112 1.94434 83.481 1.94434H86.5285Z" fill="white"/>
</svg>
</file>

<file path="public/logo.svg">
<svg width="256" height="37" viewBox="0 0 256 37" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M255.06 0.700001V35.8H252.81V18.8H232.31V35.8H230.06V0.700001H232.31V16.9H252.81V0.700001H255.06Z" fill="white"/>
<path d="M190.183 18.3C190.183 14.8333 190.9 11.75 192.333 9.05C193.8 6.31667 195.8 4.18334 198.333 2.65C200.9 1.11667 203.767 0.350002 206.933 0.350002C210.933 0.350002 214.3 1.28334 217.033 3.15C219.767 5.01667 221.767 7.63334 223.033 11H220.433C219.433 8.33334 217.767 6.23334 215.433 4.7C213.133 3.13334 210.3 2.35 206.933 2.35C204.233 2.35 201.783 3 199.583 4.3C197.383 5.56667 195.65 7.41667 194.383 9.85C193.117 12.25 192.483 15.0667 192.483 18.3C192.483 21.5 193.117 24.3 194.383 26.7C195.65 29.0667 197.383 30.9 199.583 32.2C201.783 33.5 204.233 34.15 206.933 34.15C210.3 34.15 213.133 33.3833 215.433 31.85C217.767 30.2833 219.433 28.1667 220.433 25.5H223.033C221.767 28.8667 219.767 31.4833 217.033 33.35C214.3 35.2167 210.933 36.15 206.933 36.15C203.767 36.15 200.9 35.4 198.333 33.9C195.8 32.3667 193.8 30.25 192.333 27.55C190.9 24.8167 190.183 21.7333 190.183 18.3Z" fill="white"/>
<path d="M169.273 2.6V17.25H183.273V19.15H169.273V33.9H184.773V35.8H167.023V0.700001H184.773V2.6H169.273Z" fill="white"/>
<path d="M161.667 0.700001V2.6H151.667V35.8H149.417V2.6H139.417V0.700001H161.667Z" fill="white"/>
<path d="M137.03 12.3C137.03 14.4333 136.53 16.3833 135.53 18.15C134.563 19.8833 133.08 21.2833 131.08 22.35C129.113 23.3833 126.696 23.9 123.83 23.9H118.98V35.8H109.18V0.549999H123.83C126.663 0.549999 129.063 1.05 131.03 2.05C133.03 3.05 134.53 4.43333 135.53 6.2C136.53 7.96667 137.03 10 137.03 12.3ZM122.88 16.1C125.646 16.1 127.03 14.8333 127.03 12.3C127.03 9.73333 125.646 8.45 122.88 8.45H118.98V16.1H122.88Z" fill="white"/>
<path d="M86.7242 36.15C83.4242 36.15 80.3909 35.3833 77.6242 33.85C74.8576 32.2833 72.6576 30.1333 71.0242 27.4C69.4242 24.6333 68.6242 21.5167 68.6242 18.05C68.6242 14.5833 69.4242 11.4833 71.0242 8.75C72.6576 5.98334 74.8576 3.83334 77.6242 2.3C80.3909 0.766671 83.4242 3.8147e-06 86.7242 3.8147e-06C90.0576 3.8147e-06 93.0909 0.766671 95.8242 2.3C98.5909 3.83334 100.774 5.98334 102.374 8.75C103.974 11.4833 104.774 14.5833 104.774 18.05C104.774 21.5167 103.974 24.6333 102.374 27.4C100.774 30.1333 98.5909 32.2833 95.8242 33.85C93.0576 35.3833 90.0242 36.15 86.7242 36.15ZM86.7242 27.05C89.2242 27.05 91.1909 26.2333 92.6242 24.6C94.0909 22.9667 94.8242 20.7833 94.8242 18.05C94.8242 15.25 94.0909 13.05 92.6242 11.45C91.1909 9.81667 89.2242 9 86.7242 9C84.1909 9 82.2076 9.81667 80.7742 11.45C79.3409 13.05 78.6242 15.25 78.6242 18.05C78.6242 20.8167 79.3409 23.0167 80.7742 24.65C82.2076 26.25 84.1909 27.05 86.7242 27.05Z" fill="white"/>
<path d="M54.6176 35.8L47.6176 22.8H46.5676V35.8H36.7676V0.549999H52.2176C55.0509 0.549999 57.4509 1.05 59.4176 2.05C61.3842 3.01667 62.8676 4.36667 63.8676 6.1C64.8676 7.8 65.3676 9.71667 65.3676 11.85C65.3676 14.25 64.7009 16.3667 63.3676 18.2C62.0676 20 60.1509 21.2833 57.6176 22.05L65.5676 35.8H54.6176ZM46.5676 16.1H51.4176C52.7509 16.1 53.7509 15.7833 54.4176 15.15C55.0842 14.5167 55.4176 13.6 55.4176 12.4C55.4176 11.2667 55.0676 10.3833 54.3676 9.75C53.7009 9.08333 52.7176 8.75 51.4176 8.75H46.5676V16.1Z" fill="white"/>
<path d="M13.95 0.549999C17.65 0.549999 20.8833 1.3 23.65 2.8C26.45 4.26667 28.6 6.33333 30.1 9C31.6 11.6667 32.35 14.7167 32.35 18.15C32.35 21.55 31.5833 24.5833 30.05 27.25C28.55 29.9167 26.4 32.0167 23.6 33.55C20.8333 35.05 17.6167 35.8 13.95 35.8H0V0.549999H13.95ZM13.2 27.15C16.0667 27.15 18.3167 26.3667 19.95 24.8C21.5833 23.2333 22.4 21.0167 22.4 18.15C22.4 15.25 21.5833 13.0167 19.95 11.45C18.3167 9.85 16.0667 9.05 13.2 9.05H9.8V27.15H13.2Z" fill="white"/>
</svg>
</file>

<file path="src/types/products.ts">
export interface Product {
  id: string;
  title: string;
  price: number;
  images_urls: string[];
  status: string;
}

export interface Favorite {
  id: string;
  product: Product | Product[];
}
</file>

<file path="supabase/.temp/cli-latest">
v2.67.1
</file>

<file path="supabase/.temp/gotrue-version">
v2.184.0
</file>

<file path="supabase/.temp/pooler-url">
postgresql://postgres.igrjfsyvignueeipglmp@aws-1-sa-east-1.pooler.supabase.com:5432/postgres
</file>

<file path="supabase/.temp/postgres-version">
17.6.1.063
</file>

<file path="supabase/.temp/project-ref">
igrjfsyvignueeipglmp
</file>

<file path="supabase/.temp/rest-version">
v14.1
</file>

<file path="supabase/.temp/storage-migration">
buckets-objects-grants-postgres
</file>

<file path="supabase/.temp/storage-version">
v1.33.0
</file>

<file path="supabase/fix-messages-rls.sql">
/*
  FIX para problema de RLS na tabela messages
  
  PROBLEMA: As mensagens não conseguem ser marcadas como lidas devido ao 
  Row Level Security (RLS) bloqueando updates mesmo quando o usuário é 
  o dono da mensagem.
  
  SOLUÇÃO: 
  1. Criar uma função PostgreSQL que bypassa o RLS
  2. Recriar as políticas RLS de forma mais permissiva
  3. Garantir que o update funcione corretamente
  
  COMO EXECUTAR:
  1. Abra o Supabase Dashboard
  2. Vá em SQL Editor
  3. Cole e execute este script completo
  4. Teste novamente no aplicativo
*/

-- Fix para RLS na tabela messages
-- Executar este SQL no Supabase SQL Editor

-- 1. Criar função para marcar mensagem como lida
CREATE OR REPLACE FUNCTION mark_message_read(message_id UUID, user_id UUID)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
    result_count INTEGER;
BEGIN
    -- Verificar se o usuário é o vendedor da mensagem
    UPDATE messages 
    SET read = true, updated_at = NOW()
    WHERE id = message_id 
    AND vendor_id = user_id;
    
    GET DIAGNOSTICS result_count = ROW_COUNT;
    
    RETURN result_count > 0;
END;
$$;

-- 2. Desabilitar RLS temporariamente para update das mensagens
ALTER TABLE messages DISABLE ROW LEVEL SECURITY;

-- 3. Recriar as políticas de forma mais permissiva
DROP POLICY IF EXISTS "Vendedores podem ver suas mensagens" ON messages;
DROP POLICY IF EXISTS "Vendedores podem atualizar suas mensagens" ON messages;

-- 4. Reabilitar RLS
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- 5. Criar políticas mais permissivas
CREATE POLICY "Vendedores podem ver suas mensagens"
ON messages FOR SELECT
USING (vendor_id = auth.uid());

CREATE POLICY "Vendedores podem atualizar suas mensagens"
ON messages FOR UPDATE
USING (vendor_id = auth.uid())
WITH CHECK (vendor_id = auth.uid());

CREATE POLICY "Inserir mensagens para qualquer vendedor"
ON messages FOR INSERT
WITH CHECK (true);

-- 6. Grant permissions na função
GRANT EXECUTE ON FUNCTION mark_message_read(UUID, UUID) TO authenticated;
</file>

<file path="supabase/messages-policies.sql">
-- Políticas RLS para a tabela messages
-- Execute estas queries no Supabase SQL Editor se necessário

-- Habilitar RLS na tabela messages (se não estiver habilitado)
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- Política para permitir que vendedores vejam suas próprias mensagens
CREATE POLICY "Vendors can view their own messages" ON messages
FOR SELECT USING (auth.uid()::text = vendor_id);

-- Política para permitir que vendedores atualizem suas próprias mensagens (marcar como lida)
CREATE POLICY "Vendors can update their own messages" ON messages
FOR UPDATE USING (auth.uid()::text = vendor_id)
WITH CHECK (auth.uid()::text = vendor_id);

-- Política para permitir inserção de mensagens (para quando usuários enviam mensagens)
CREATE POLICY "Anyone can insert messages" ON messages
FOR INSERT WITH CHECK (true);

-- Verificar se as políticas foram criadas
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE tablename = 'messages';
</file>

<file path="supabase/migrations/20260115154425_setup_avatars_storage.sql">
-- Criar bucket 'avatars' se não existir
INSERT INTO storage.buckets (id, name, public)
VALUES ('avatars', 'avatars', true)
ON CONFLICT (id) DO NOTHING;

-- Remover políticas existentes para evitar conflitos
DROP POLICY IF EXISTS "Users can upload their own avatars" ON storage.objects;
DROP POLICY IF EXISTS "Users can view their own avatars" ON storage.objects;
DROP POLICY IF EXISTS "Users can update their own avatars" ON storage.objects;
DROP POLICY IF EXISTS "Users can delete their own avatars" ON storage.objects;
DROP POLICY IF EXISTS "Public avatars are viewable by everyone" ON storage.objects;

-- Política para permitir que usuários façam upload de seus próprios avatars
CREATE POLICY "Users can upload their own avatars" ON storage.objects
FOR INSERT WITH CHECK (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários vejam seus próprios avatars
CREATE POLICY "Users can view their own avatars" ON storage.objects
FOR SELECT USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários atualizem seus próprios avatars
CREATE POLICY "Users can update their own avatars" ON storage.objects
FOR UPDATE USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários deletem seus próprios avatars
CREATE POLICY "Users can delete their own avatars" ON storage.objects
FOR DELETE USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que qualquer pessoa veja avatars publicamente (necessário para exibir avatars)
CREATE POLICY "Public avatars are viewable by everyone" ON storage.objects
FOR SELECT USING (bucket_id = 'avatars');
</file>

<file path="supabase/migrations/20260115161106_setup_products_storage.sql">
-- Criar bucket 'products' se não existir
INSERT INTO storage.buckets (id, name, public)
VALUES ('products', 'products', true)
ON CONFLICT (id) DO NOTHING;

-- Remover políticas existentes para evitar conflitos
DROP POLICY IF EXISTS "Users can upload product images" ON storage.objects;
DROP POLICY IF EXISTS "Users can view their product images" ON storage.objects;
DROP POLICY IF EXISTS "Users can update their product images" ON storage.objects;
DROP POLICY IF EXISTS "Users can delete their product images" ON storage.objects;
DROP POLICY IF EXISTS "Public product images are viewable by everyone" ON storage.objects;

-- Política para permitir que usuários façam upload de imagens de seus produtos
CREATE POLICY "Users can upload product images" ON storage.objects
FOR INSERT WITH CHECK (
  bucket_id = 'products' 
  AND auth.uid()::text = (storage.foldername(name))[2]
);

-- Política para permitir que usuários vejam suas próprias imagens de produtos
CREATE POLICY "Users can view their product images" ON storage.objects
FOR SELECT USING (
  bucket_id = 'products' 
  AND auth.uid()::text = (storage.foldername(name))[2]
);

-- Política para permitir que usuários atualizem suas próprias imagens de produtos
CREATE POLICY "Users can update their product images" ON storage.objects
FOR UPDATE USING (
  bucket_id = 'products' 
  AND auth.uid()::text = (storage.foldername(name))[2]
);

-- Política para permitir que usuários deletem suas próprias imagens de produtos
CREATE POLICY "Users can delete their product images" ON storage.objects
FOR DELETE USING (
  bucket_id = 'products' 
  AND auth.uid()::text = (storage.foldername(name))[2]
);

-- Política para permitir que qualquer pessoa veja imagens de produtos (necessário para visualizar)
CREATE POLICY "Public product images are viewable by everyone" ON storage.objects
FOR SELECT USING (bucket_id = 'products');
</file>

<file path="supabase/storage-policies.sql">
-- Criar bucket 'avatars' se não existir
INSERT INTO storage.buckets (id, name, public)
VALUES ('avatars', 'avatars', true)
ON CONFLICT (id) DO NOTHING;

-- Política para permitir que usuários façam upload de seus próprios avatars
CREATE POLICY "Users can upload their own avatars" ON storage.objects
FOR INSERT WITH CHECK (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários vejam seus próprios avatars
CREATE POLICY "Users can view their own avatars" ON storage.objects
FOR SELECT USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários atualizem seus próprios avatars
CREATE POLICY "Users can update their own avatars" ON storage.objects
FOR UPDATE USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que usuários deletem seus próprios avatars
CREATE POLICY "Users can delete their own avatars" ON storage.objects
FOR DELETE USING (
  bucket_id = 'avatars' 
  AND auth.uid()::text = (storage.foldername(name))[1]
);

-- Política para permitir que qualquer usuário autenticado veja avatars (opcional, para visualizar avatars de outros usuários)
CREATE POLICY "Authenticated users can view all avatars" ON storage.objects
FOR SELECT USING (
  bucket_id = 'avatars' 
  AND auth.role() = 'authenticated'
);
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="app/(main)/admin/moderacao/ModerationCard.tsx">
"use client";

import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { House, Check, X, Eye, Trash2 } from "lucide-react";
import type { Tables } from "@/src/types/supabase";
import { useState } from "react";
import { approveProduct, rejectProduct, deleteProduct } from "./actions";
import { useRouter } from "next/navigation";

type Product = Tables<"products"> & {
  tags?: Array<{ name: string; }>;
};

type ProductStatus = 'pendente' | 'aprovado' | 'reprovado' | 'vendido' | 'all';

interface ModerationCardProps {
  product: Product;
  currentStatus: ProductStatus;
  onViewDetails: () => void;
}

export function ModerationCard({ product, currentStatus, onViewDetails }: ModerationCardProps) {
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  const handleApprove = async () => {
    if (isLoading) return;

    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await approveProduct(formData);
      router.refresh();
    } catch (error) {
      console.error('Erro ao aprovar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleReject = async () => {
    if (isLoading) return;

    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await rejectProduct(formData);
      router.refresh();
    } catch (error) {
      console.error('Erro ao rejeitar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleDelete = async () => {
    if (isLoading) return;

    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await deleteProduct(formData);
      router.refresh();
    } catch (error) {
      console.error('Erro ao deletar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const imageSrc = product.images_urls?.[0];

  // Formatar tags (no máximo 2)
  const getTags = () => {
    if (!product.tags || product.tags.length === 0) {
      return ["#Produtos", "#Seminovo"];
    }

    const availableTags = product.tags.map(tag => `#${tag.name}`);

    if (availableTags.length === 1) {
      return [availableTags[0], "#Seminovo"];
    }

    return availableTags.slice(0, 2);
  };

  // Formatar localização
  const formatLocation = () => {
    const parts = [];
    if (product.city) parts.push(product.city);
    if (product.state) parts.push(product.state);

    if (parts.length === 0) return "Localização indisponível";
    if (parts.length === 1) return parts[0];
    return parts.join(" - ");
  };

  const [tag1, tag2] = getTags();

  const backgroundStyle = imageSrc
    ? {
      backgroundImage: `url(${imageSrc})`,
      display: "block",
    }
    : undefined;

  return (
    <div className="group relative">
      {/* Card principal */}
      <div
        style={backgroundStyle}
        className="relative h-[395px] w-full max-w-[478px] overflow-hidden rounded-[20px] bg-cover bg-center p-[10px]"
      >
        {!imageSrc && <div className="absolute inset-0 bg-gradient-to-br from-gray-400 to-gray-600" />}

        <div className="absolute inset-0 bg-black/20" />

        <div className="relative flex h-full flex-col justify-between">
          {/* Top row */}
          <div className="flex w-full items-center justify-between">
            <div className="flex items-center gap-[7px]">
              <span className="inline-flex items-center rounded-full bg-white/90 backdrop-blur-sm px-2.5 py-0.5 text-xs font-medium text-gray-800">
                {tag1}
              </span>
              <span className="inline-flex items-center rounded-full bg-black/50 backdrop-blur-sm px-2.5 py-0.5 text-xs font-medium text-white">
                {tag2}
              </span>
            </div>

            <Badge
              variant={product.status === 'pendente' ? 'secondary' : 'outline'}
              className="bg-white/10 text-white/80 border-black/20 backdrop-blur-sm"
            >
              {product.status === 'pendente' ? 'Pendente' :
                product.status === 'aprovado' ? 'Aprovado' :
                  product.status === 'reprovado' ? 'Reprovado' : 'Vendido'}
            </Badge>
          </div>

          {/* Bottom content */}
          <div className="w-full overflow-hidden rounded-[17px] bg-black/90 backdrop-blur-md border border-black/20">
            <div className="flex items-start justify-between gap-3 px-[22px] pb-3 pt-4">
              <div className="flex flex-col gap-2 w-full">
                <div className="font-medium truncate max-w-full text-white">
                  {product.title}
                </div>
                <div className="flex items-center gap-[6px]">
                  <House className="h-4 w-4 text-white/60" />
                  <span className="text-sm text-white/60 font-medium">
                    {formatLocation()}
                  </span>
                </div>
              </div>
            </div>

            <div className="border-t border-black/20 px-[22px] pb-4 pt-3">
              <div className="font-semibold text-lg text-white mb-3">
                {new Intl.NumberFormat("pt-BR", {
                  style: "currency",
                  currency: "BRL",
                }).format(product.price)}
              </div>

              {/* Botões de ação baseados no status */}
              <div className="flex gap-2">
                <Button
                  size="sm"
                  variant="outline"
                  onClick={onViewDetails}
                  className="flex-1 h-8 text-xs bg-white/10 border-white/20 text-white/80 hover:bg-white/20 hover:text-white backdrop-blur-sm"
                >
                  <Eye className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                  <span className="max-[440px]:hidden">Ver</span>
                </Button>

                {/* Mostrar botões de ação baseados no status */}
                {currentStatus === 'pendente' ? (
                  <>
                    <Button
                      size="sm"
                      onClick={handleApprove}
                      disabled={isLoading}
                      className="flex-1 h-8 text-xs bg-[#ECF230] hover:bg-[#dae029] text-black"
                    >
                      <Check className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                      <span className="max-[440px]:hidden">{isLoading ? '...' : 'Aprovar'}</span>
                    </Button>
                    <Button
                      size="sm"
                      variant="destructive"
                      onClick={handleReject}
                      disabled={isLoading}
                      className="flex-1 h-8 text-xs bg-gray-700 hover:bg-gray-600 text-white"
                    >
                      <X className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                      <span className="max-[440px]:hidden">{isLoading ? '...' : 'Rejeitar'}</span>
                    </Button>
                  </>
                ) : currentStatus === 'aprovado' ? (
                  <>
                    <Button
                      size="sm"
                      variant="destructive"
                      onClick={handleDelete}
                      disabled={isLoading}
                      className="flex-1 h-8 text-xs bg-black/30 hover:bg-black/50 text-white border-white/20 backdrop-blur-sm"
                    >
                      <Trash2 className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                      <span className="max-[440px]:hidden">{isLoading ? '...' : 'Deletar'}</span>
                    </Button>
                    <Button
                      size="sm"
                      variant="destructive"
                      onClick={handleReject}
                      disabled={isLoading}
                      className="flex-1 h-8 text-xs bg-gray-700 hover:bg-gray-600 text-white"
                    >
                      <X className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                      <span className="max-[440px]:hidden">{isLoading ? '...' : 'Rejeitar'}</span>
                    </Button>
                  </>

                ) : currentStatus === 'reprovado' ? (
                  <Button
                    size="sm"
                    onClick={handleApprove}
                    disabled={isLoading}
                    className="flex-1 h-8 text-xs bg-[#ECF230] hover:bg-[#dae029] text-black"
                  >
                    <Check className="h-3 w-3 mr-1 max-[440px]:mr-0" />
                    <span className="max-[440px]:hidden">{isLoading ? '...' : 'Aprovar'}</span>
                  </Button>
                ) : currentStatus === 'vendido' ? (
                  <></>
                ) : (
                  // Status 'all' - mostrar ambos os botões
                  <>
                    
                  </>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
      {/* Informação do vendedor */}
      <div className="mt-2 text-xs text-white/50 text-center max-[800px]:text-left">
        Vendedor ID: {product.seller_id}
      </div>
    </div>
  );
}
</file>

<file path="app/(main)/admin/moderacao/ProductPreviewModal.tsx">
"use client";

import { useState } from "react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Check, X, ChevronLeft, ChevronRight, MapPin, User, Phone, Calendar, Eye, ImageIcon, Trash2 } from "lucide-react";
import type { Tables } from "@/src/types/supabase";
import Image from "next/image";
import { approveProduct, rejectProduct, deleteProduct } from "./actions";
import { useRouter } from "next/navigation";

type Product = Tables<"products"> & {
  tags?: Array<{ name: string; }>;
};

interface ProductPreviewModalProps {
  product: Product;
  onClose: () => void;
}

export function ProductPreviewModal({ product, onClose }: ProductPreviewModalProps) {
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  const images = product.images_urls || [];
  const hasImages = images.length > 0;

  const handleApprove = async () => {
    if (isLoading) return;
    
    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await approveProduct(formData);
      router.refresh();
      onClose();
    } catch (error) {
      console.error('Erro ao aprovar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleReject = async () => {
    if (isLoading) return;
    
    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await rejectProduct(formData);
      router.refresh();
      onClose();
    } catch (error) {
      console.error('Erro ao rejeitar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleDelete = async () => {
    if (isLoading) return;
    
    setIsLoading(true);
    try {
      const formData = new FormData();
      formData.append('productId', product.id);
      await deleteProduct(formData);
      router.refresh();
      onClose();
    } catch (error) {
      console.error('Erro ao deletar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const nextImage = () => {
    setCurrentImageIndex((prev) => (prev + 1) % images.length);
  };

  const prevImage = () => {
    setCurrentImageIndex((prev) => (prev - 1 + images.length) % images.length);
  };

  const formatLocation = () => {
    const parts = [];
    if (product.address) parts.push(product.address);
    if (product.city) parts.push(product.city);
    if (product.state) parts.push(product.state);
    
    return parts.length > 0 ? parts.join(", ") : "Localização não informada";
  };

  const formatDate = (date: string) => {
    return new Intl.DateTimeFormat('pt-BR', {
      day: '2-digit',
      month: '2-digit', 
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }).format(new Date(date));
  };

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 mt-0 max-[1100px]:p-4 max-[930px]:p-6 max-[768px]:p-4 max-[480px]:p-2">
      <div className="bg-black/40 backdrop-blur-xl rounded-2xl w-full max-w-5xl max-h-[85vh] overflow-hidden shadow-2xl border border-white/10 
                      max-[1100px]:max-w-4xl max-[930px]:max-w-3xl max-[930px]:max-h-[85vh] max-[768px]:max-w-2xl max-[768px]:rounded-xl max-[480px]:max-w-full max-[480px]:rounded-lg max-[480px]:max-h-[90vh]">
        {/* Header com design melhorado */}
        <div className="relative bg-black/30 backdrop-blur-md text-white border-b border-white/10">
          <div className="relative p-6 flex items-center justify-between max-[930px]:p-5 max-[768px]:p-4 max-[480px]:p-3">
            <div className="flex items-center gap-4 max-[480px]:gap-3">
              <div className="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center backdrop-blur-sm max-[768px]:w-10 max-[768px]:h-10">
                <Eye className="h-6 w-6 text-white max-[768px]:h-5 max-[768px]:w-5" />
              </div>
              <div>
                <h3 className="text-xl font-bold text-white max-[768px]:text-lg max-[480px]:text-base">Prévia do Anúncio</h3>
                <p className="text-white/60 text-sm max-[480px]:text-xs max-[480px]:hidden">Análise detalhada para moderação</p>
              </div>
            </div>
            <div className="flex items-center gap-3 max-[480px]:gap-2">
              <Badge 
                className={`${
                  product.status === 'pendente' 
                    ? 'bg-orange-600/20 text-orange-300 border-orange-500/30' 
                    : product.status === 'aprovado'
                    ? 'bg-green-600/20 text-green-300 border-green-500/30'
                    : 'bg-red-600/20 text-red-300 border-red-500/30'
                } font-medium backdrop-blur-sm max-[480px]:text-xs`}
              >
                {product.status === 'pendente' ? 'Pendente' : 
                 product.status === 'aprovado' ? 'Aprovado' : 'Rejeitado'}
              </Badge>
              <Button 
                variant="ghost" 
                onClick={onClose} 
                className="h-8 w-8 p-0 text-white hover:bg-white/20 rounded-full max-[480px]:h-7 max-[480px]:w-7"
              >
                <X className="h-5 w-5 max-[480px]:h-4 max-[480px]:w-4" />
              </Button>
            </div>
          </div>
        </div>

        {/* Content com scroll melhorado */}
        <div className="max-h-[calc(85vh-200px)] max-[930px]:max-h-[calc(80vh-180px)] max-[480px]:max-h-[calc(90vh-250px)] overflow-y-auto bg-black/20 backdrop-blur-md">
          <div className="p-8 space-y-8 max-[930px]:p-6 max-[930px]:space-y-6 max-[768px]:p-5 max-[768px]:space-y-5 max-[480px]:p-4 max-[480px]:space-y-4">
            {/* Galeria de Imagens com design moderno */}
            <div className="space-y-6 max-[768px]:space-y-4">
              <div className="flex items-center gap-3 max-[480px]:gap-2">
                <div className="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center backdrop-blur-sm max-[768px]:w-7 max-[768px]:h-7">
                  <ImageIcon className="h-5 w-5 text-white/80 max-[768px]:h-4 max-[768px]:w-4" />
                </div>
                <h4 className="text-xl font-bold text-white max-[768px]:text-lg max-[480px]:text-base">Galeria de Imagens</h4>
              </div>
              
              {hasImages ? (
                <div className="space-y-6 max-[768px]:space-y-4">
                  {/* Imagem Principal com design elegante */}
                  <div className="relative aspect-video bg-black/30 backdrop-blur-md rounded-2xl overflow-hidden shadow-lg border border-white/10 max-[768px]:rounded-xl max-[480px]:rounded-lg">
                    <Image
                      src={images[currentImageIndex]}
                      alt={`${product.title} - Imagem ${currentImageIndex + 1}`}
                      fill
                      className="object-cover transition-all duration-300"
                    />
                    
                    {/* Overlay com gradiente sutil */}
                    <div className="absolute inset-0 bg-black/5"></div>
                    
                    {images.length > 1 && (
                      <>
                        <Button
                          variant="ghost"
                          size="sm"
                          className="absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 hover:bg-white shadow-lg rounded-full h-10 w-10 p-0 max-[480px]:left-2 max-[480px]:h-8 max-[480px]:w-8"
                          onClick={prevImage}
                        >
                          <ChevronLeft className="h-5 w-5 max-[480px]:h-4 max-[480px]:w-4" />
                        </Button>
                        <Button
                          variant="ghost"
                          size="sm"
                          className="absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 backdrop-blur-sm text-gray-800 hover:bg-white shadow-lg rounded-full h-10 w-10 p-0 max-[480px]:right-2 max-[480px]:h-8 max-[480px]:w-8"
                          onClick={nextImage}
                        >
                          <ChevronRight className="h-5 w-5 max-[480px]:h-4 max-[480px]:w-4" />
                        </Button>
                        
                        {/* Contador elegante */}
                        <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur-sm text-white text-sm px-4 py-2 rounded-full font-medium max-[480px]:bottom-2 max-[480px]:text-xs max-[480px]:px-3 max-[480px]:py-1">
                          {currentImageIndex + 1} de {images.length}
                        </div>
                      </>
                    )}
                  </div>

                  {/* Miniaturas com design melhorado */}
                  {images.length > 1 && (
                    <div className="flex gap-3 overflow-x-auto pb-2 max-[768px]:gap-2">
                      {images.map((image, index) => (
                        <button
                          key={index}
                          onClick={() => setCurrentImageIndex(index)}
                          className={`relative w-20 h-20 rounded-xl border-3 transition-all duration-200 flex-shrink-0 overflow-hidden max-[768px]:w-16 max-[768px]:h-16 max-[768px]:rounded-lg max-[480px]:w-14 max-[480px]:h-14 ${
                            index === currentImageIndex 
                              ? 'border-blue-500 shadow-lg scale-105' 
                              : 'border-gray-200 hover:border-gray-300 hover:scale-102'
                          }`}
                        >
                          <Image
                            src={image}
                            alt={`Miniatura ${index + 1}`}
                            fill
                            className="object-cover"
                          />
                          {index === currentImageIndex && (
                            <div className="absolute inset-0 bg-blue-500/20"></div>
                          )}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              ) : (
                <div className="aspect-video bg-black/20 backdrop-blur-md rounded-2xl flex items-center justify-center border-2 border-dashed border-white/20 max-[768px]:rounded-xl max-[480px]:rounded-lg">
                  <div className="text-center">
                    <div className="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm max-[768px]:w-12 max-[768px]:h-12 max-[480px]:w-10 max-[480px]:h-10">
                      <ImageIcon className="h-8 w-8 text-white/60 max-[768px]:h-6 max-[768px]:w-6 max-[480px]:h-5 max-[480px]:w-5" />
                    </div>
                    <p className="text-lg font-medium text-white max-[768px]:text-base max-[480px]:text-sm">Nenhuma imagem disponível</p>
                    <p className="text-sm text-white/70 mt-1 max-[480px]:text-xs">Este anúncio não possui imagens</p>
                  </div>
                </div>
              )}
            </div>

            {/* Informações do Produto com cards elegantes */}
            <div className="space-y-6 max-[768px]:space-y-4">
              <div className="flex items-center gap-3 max-[480px]:gap-2">
                <div className="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center backdrop-blur-sm max-[768px]:w-7 max-[768px]:h-7">
                  <Phone className="h-5 w-5 text-white/80 max-[768px]:h-4 max-[768px]:w-4" />
                </div>
                <h4 className="text-xl font-bold text-white max-[768px]:text-lg max-[480px]:text-base">Informações do Produto</h4>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 max-[768px]:gap-4 max-[1100px]:grid-cols-1">
                {/* Coluna esquerda */}
                <div className="space-y-4 max-[768px]:space-y-3">
                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide max-[480px]:text-xs">Título</h5>
                    <p className="text-lg font-bold text-white max-[768px]:text-base max-[480px]:text-sm">{product.title}</p>
                  </div>
                  
                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide max-[480px]:text-xs">Preço</h5>
                    <p className="text-2xl font-bold text-white max-[768px]:text-xl max-[480px]:text-lg">
                      {new Intl.NumberFormat("pt-BR", {
                        style: "currency",
                        currency: "BRL",
                      }).format(product.price)}
                    </p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide max-[480px]:text-xs">Categoria</h5>
                    <p className="text-white font-medium max-[768px]:text-sm">{product.category || 'Não informada'}</p>
                  </div>

                  {product.tags && product.tags.length > 0 && (
                    <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                      <h5 className="text-sm font-semibold text-white/80 mb-3 uppercase tracking-wide max-[480px]:text-xs">Tags</h5>
                      <div className="flex flex-wrap gap-2">
                        {product.tags.map((tag, index) => (
                          <Badge key={index} className="bg-black/30 text-white border-white/20 font-medium backdrop-blur-sm max-[480px]:text-xs">
                            #{tag.name}
                          </Badge>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                {/* Coluna direita */}
                <div className="space-y-4 max-[768px]:space-y-3">
                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide flex items-center gap-2 max-[480px]:text-xs">
                      <MapPin className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
                      Localização
                    </h5>
                    <p className="text-white font-medium max-[768px]:text-sm">{formatLocation()}</p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide flex items-center gap-2 max-[480px]:text-xs">
                      <Phone className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
                      Contato
                    </h5>
                    <p className="text-white font-medium max-[768px]:text-sm">{product.contact_phone || 'Não informado'}</p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide flex items-center gap-2 max-[480px]:text-xs">
                      <User className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
                      Vendedor
                    </h5>
                    <p className="text-white font-medium max-[768px]:text-sm">ID: {product.seller_id}</p>
                  </div>

                  <div className="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 max-[768px]:p-4 max-[768px]:rounded-lg">
                    <h5 className="text-sm font-semibold text-white/80 mb-2 uppercase tracking-wide flex items-center gap-2 max-[480px]:text-xs">
                      <Calendar className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
                      Data de Criação
                    </h5>
                    <p className="text-white font-medium max-[768px]:text-sm">{product.created_at ? formatDate(product.created_at) : 'Data não disponível'}</p>
                  </div>
                </div>
              </div>
            </div>

            {/* Descrição com design melhorado */}
            <div className="space-y-4 max-[768px]:space-y-3">
              <div className="flex items-center gap-3 max-[480px]:gap-2">
                <div className="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center backdrop-blur-sm max-[768px]:w-7 max-[768px]:h-7">
                  <Eye className="h-5 w-5 text-white/80 max-[768px]:h-4 max-[768px]:w-4" />
                </div>
                <h5 className="text-xl font-bold text-white max-[768px]:text-lg max-[480px]:text-base">Descrição</h5>
              </div>
              <div className="bg-white/10 backdrop-blur-md rounded-xl p-8 border border-white/20 max-[768px]:p-6 max-[768px]:rounded-lg max-[480px]:p-4">
                <p className="text-white whitespace-pre-wrap leading-relaxed text-base max-[768px]:text-sm max-[480px]:text-xs" style={{ wordWrap: 'break-word', overflowWrap: 'break-word', hyphens: 'auto', lineHeight: '1.5' }}>
                  {product.description || (
                    <span className="italic text-white/70">
                      Nenhuma descrição foi fornecida para este produto.
                    </span>
                  )}
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Footer com design moderno */}
        <div className="bg-black/30 backdrop-blur-md border-t border-white/10 p-6 max-[930px]:p-5 max-[768px]:p-4 max-[480px]:p-3">
          <div className="flex flex-col sm:flex-row justify-between items-center gap-4 max-[768px]:gap-3">
            <div className="flex items-center gap-3 max-[480px]:gap-2 max-[480px]:hidden">
              <div className="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center backdrop-blur-sm max-[768px]:w-8 max-[768px]:h-8">
                <Eye className="h-5 w-5 text-white/80 max-[768px]:h-4 max-[768px]:w-4" />
              </div>
              <div>
                <p className="font-semibold text-white max-[768px]:text-sm max-[480px]:hidden">Ações de Moderação</p>
                <p className="text-sm text-white/60 max-[480px]:text-xs max-[480px]:hidden">Escolha uma ação para este anúncio</p>
              </div>
            </div>
            
            <div className="flex gap-3 max-[768px]:gap-2 max-[480px]:flex-col max-[480px]:w-full">
              <Button 
                variant="outline" 
                onClick={onClose}
                className="px-6 py-2 border-white/20 hover:bg-white/10 text-white/80 hover:text-white backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[480px]:w-full"
              >
                Fechar
              </Button>
              
              {/* Botões condicionais baseados no status */}
              {product.status === 'aprovado' && (
                <>
                  <Button
                    onClick={handleReject}
                    disabled={isLoading}
                    className="bg-black/30 hover:bg-black/50 text-white px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 border border-white/20 backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <X className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Rejeitando...' : 'Rejeitar'}
                  </Button>
                  <Button
                    onClick={handleDelete}
                    disabled={isLoading}
                    className="bg-red-600/80 hover:bg-red-700/80 text-white px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 border border-white/20 backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <Trash2 className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Deletando...' : 'Deletar'}
                  </Button>
                </>
              )}
              
              {product.status === 'reprovado' && (
                <>
                  <Button
                    onClick={handleApprove}
                    disabled={isLoading}
                    className="bg-[#ECF230] hover:bg-[#dae029] text-black px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <Check className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Aprovando...' : 'Aprovar'}
                  </Button>
                  <Button
                    onClick={handleDelete}
                    disabled={isLoading}
                    className="bg-red-600/80 hover:bg-red-700/80 text-white px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 border border-white/20 backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <Trash2 className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Deletando...' : 'Deletar'}
                  </Button>
                </>
              )}
              
              {product.status === 'pendente' && (
                <>
                  <Button
                    onClick={handleApprove}
                    disabled={isLoading}
                    className="bg-[#ECF230] hover:bg-[#dae029] text-black px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <Check className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Aprovando...' : 'Aprovar'}
                  </Button>
                  <Button
                    onClick={handleReject}
                    disabled={isLoading}
                    className="bg-black/30 hover:bg-black/50 text-white px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 border border-white/20 backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                  >
                    <X className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                    {isLoading ? 'Rejeitando...' : 'Rejeitar'}
                  </Button>
                </>
              )}
              
              {product.status === 'vendido' && (
                <Button
                  onClick={handleDelete}
                  disabled={isLoading}
                  className="bg-red-600/80 hover:bg-red-700/80 text-white px-6 py-2 shadow-lg transition-all duration-200 min-w-[120px] disabled:opacity-50 border border-white/20 backdrop-blur-sm max-[768px]:px-4 max-[768px]:py-2 max-[768px]:text-sm max-[768px]:min-w-[100px] max-[480px]:w-full max-[480px]:min-w-full"
                >
                  <Trash2 className="h-4 w-4 mr-2 max-[768px]:h-3 max-[768px]:w-3 max-[480px]:mr-1" />
                  {isLoading ? 'Deletando...' : 'Deletar'}
                </Button>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/(main)/dashboard/favoritos/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";

export async function getFavorites() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) return null;

  const { data: favorites } = await supabase
    .from("favorites")
    .select(`
      id,
      product:products (
        id,
        title,
        price,
        images_urls,
        status,
        description,
        category,
        city,
        state,
        seller_id,
        created_at,
        address,
        contact_phone,
        tags:products_tags(
          tag:tags(name)
        )
      )
    `)
    .eq("user_id", user.id);

  return favorites;
}
</file>

<file path="app/auth/confirmar/route.ts">
import { createClient } from "@/lib/supabase/server";
import { type EmailOtpType } from "@supabase/supabase-js";
import { redirect } from "next/navigation";
import { type NextRequest } from "next/server";

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const token_hash = searchParams.get("token_hash");
  const type = searchParams.get("type") as EmailOtpType | null;
  const next = searchParams.get("next") ?? "/";

  if (token_hash && type) {
    const supabase = await createClient();

    const { error } = await supabase.auth.verifyOtp({
      type,
      token_hash,
    });
    if (!error) {
      redirect(next);
    } else {
      redirect(`/auth/error?error=${error?.message}`);
    }
  }

  redirect(`/auth/error?error=No token hash or type`);
}
</file>

<file path="app/auth/error/page.tsx">
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Suspense } from "react";

async function ErrorContent({
  searchParams,
}: {
  searchParams: Promise<{ error: string }>;
}) {
  const params = await searchParams;

  return (
    <>
      {params?.error ? (
        <p className="text-sm text-muted-foreground">
          Código do erro: {params.error}
        </p>
      ) : (
        <p className="text-sm text-muted-foreground">
          Ocorreu um erro não especificado.
        </p>
      )}
    </>
  );
}

export default function Page({
  searchParams,
}: {
  searchParams: Promise<{ error: string }>;
}) {
  return (
    <div className="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
      <div className="w-full max-w-sm">
        <div className="flex flex-col gap-6">
          <Card>
            <CardHeader>
              <CardTitle className="text-2xl">
                Desculpe, algo deu errado.
              </CardTitle>
            </CardHeader>
            <CardContent>
              <Suspense>
                <ErrorContent searchParams={searchParams} />
              </Suspense>
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/EditProfileModal.tsx">
"use client";

import { useState } from "react";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { updateUserProfile } from "../../app/(main)/dashboard/actions";
import { Loader2 } from "lucide-react";

interface EditProfileModalProps {
  isOpen: boolean;
  onClose: () => void;
  currentPhone?: string | null;
  userName: string;
}

export function EditProfileModal({ isOpen, onClose, currentPhone, userName }: EditProfileModalProps) {
  const [phone, setPhone] = useState(currentPhone || '');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    try {
      // Validações
      if (newPassword && newPassword !== confirmPassword) {
        throw new Error('As senhas não coincidem');
      }

      if (newPassword && newPassword.length < 6) {
        throw new Error('A senha deve ter pelo menos 6 caracteres');
      }

      const formData = new FormData();
      formData.append('phone', phone);
      if (newPassword) {
        formData.append('password', newPassword);
      }

      await updateUserProfile(formData);
      
      // Reset form e fechar modal
      setNewPassword('');
      setConfirmPassword('');
      onClose();
    } catch (error: unknown) {
      setError(error instanceof Error ? error.message : 'Erro desconhecido');
    } finally {
      setIsLoading(false);
    }
  };

  const handleClose = () => {
    setNewPassword('');
    setConfirmPassword('');
    setError('');
    setPhone(currentPhone || '');
    onClose();
  };

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Editar Perfil</DialogTitle>
          <DialogDescription>
            Altere suas informações de contato e senha.
          </DialogDescription>
        </DialogHeader>
        
        <form onSubmit={handleSubmit} className="space-y-4 sm:space-y-6">
          <div className="space-y-4">
            {/* Nome (apenas exibição) */}
            <div className="space-y-2">
              <Label>Nome</Label>
              <Input 
                value={userName} 
                disabled 
                className="bg-muted"
              />
              <p className="text-xs text-muted-foreground">
                O nome não pode ser alterado aqui.
              </p>
            </div>

            {/* Telefone */}
            <div className="space-y-2">
              <Label htmlFor="phone">Telefone</Label>
              <Input
                id="phone"
                type="tel"
                placeholder="(11) 99999-9999"
                value={phone}
                onChange={(e) => setPhone(e.target.value)}
              />
            </div>

            {/* Nova Senha */}
            <div className="space-y-2">
              <Label htmlFor="newPassword">Nova Senha</Label>
              <Input
                id="newPassword"
                type="password"
                placeholder="Deixe em branco para não alterar"
                value={newPassword}
                onChange={(e) => setNewPassword(e.target.value)}
              />
            </div>

            {/* Confirmar Senha */}
            {newPassword && (
              <div className="space-y-2">
                <Label htmlFor="confirmPassword">Confirmar Nova Senha</Label>
                <Input
                  id="confirmPassword"
                  type="password"
                  placeholder="Confirme a nova senha"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                />
              </div>
            )}
          </div>

          {error && (
            <div className="text-sm text-red-600 bg-red-50 p-3 rounded-md">
              {error}
            </div>
          )}

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={handleClose}
              disabled={isLoading}
            >
              Cancelar
            </Button>
            <Button type="submit" disabled={isLoading}>
              {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
              Salvar Alterações
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="components/filterbar/filterbar.tsx">
'use client';

import { Search } from 'lucide-react';
import styles from './filterbar.module.css';
import { useFilters } from '@/lib/hooks/useFilters';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export default function FilterBar() {
  const { filters, searchDebounce, updateSearch, toggleTag } = useFilters();
  const [availableTags, setAvailableTags] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Buscar tags disponíveis
  useEffect(() => {
    async function fetchTags() {
      const supabase = createClient();
      const { data: tagsData } = await supabase
        .from('tags')
        .select('name')
        .limit(6);
      
      setAvailableTags(tagsData?.map(tag => tag.name) || []);
      setIsLoading(false);
    }
    
    fetchTags();
  }, []);

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateSearch(e.target.value);
  };

  const handleTagClick = (tag: string) => {
    toggleTag(tag);
  };

  if (isLoading) {
    return (
      <div className={styles.container}>
        <div className={styles.tags}>
          {Array.from({ length: 6 }).map((_, i) => (
            <div key={i} className={`${styles.tag} animate-pulse bg-gray-200`}>
              &nbsp;
            </div>
          ))}
        </div>
        <div className={styles.searchWrapper}>
          <div className={`${styles.searchInput} animate-pulse bg-gray-200`}></div>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      {/* Tags */}
      <div className={styles.tags}>
        {availableTags.map((tag, index) => (
          <button 
            key={index} 
            className={`${styles.tag} ${
              filters.tags && filters.tags.includes(tag) ? styles.tagActive : ''
            }`}
            onClick={() => handleTagClick(tag)}
          >
            #{tag}
          </button>
        ))}
      </div>

      {/* Search */}
      <div className={styles.searchWrapper}>
        <input
          type="text"
          placeholder="Notebook Acer 4gb Ram"
          className={styles.searchInput}
          value={searchDebounce}
          onChange={handleSearchChange}
        />
        <button className={styles.searchButton}>
          <Search size={18} />
        </button>
      </div>
    </div>
  );
}
</file>

<file path="components/filters/FilterSection.tsx">
"use client";

import { useState, ReactNode, useEffect } from 'react';
import { ChevronDown } from 'lucide-react';
import styles from './filter.module.css';
import { cn } from '@/lib/utils';

type FilterSectionProps = {
  title: string;
  id: string;
  defaultOpen?: boolean;
  children: ReactNode;
  className?: string;
};

export function FilterSection({ title, id, defaultOpen = true, children, className }: FilterSectionProps) {
  const [isOpen, setIsOpen] = useState(defaultOpen);

  // On small screens, start collapsed to allow a compact horizontal filter bar
  useEffect(() => {
    if (typeof window !== 'undefined') {
      if (window.innerWidth < 1024) setIsOpen(false);
    }
  }, []);

  return (
    <section className={cn(styles.section, className)}>
      <header className={styles.sectionHeader}>
        <div className={styles.headerLeft}>
          <h3>{title}</h3>
        </div>
        <button
          type="button"
          className={styles.sectionToggle}
          aria-expanded={isOpen}
          aria-controls={id}
          onClick={() => setIsOpen(v => !v)}
        >
          <ChevronDown
            className={isOpen ? styles.sectionToggleIconOpen : styles.sectionToggleIcon}
          />
        </button>
      </header>

      <div
        id={id}
        className={isOpen ? styles.sectionContent : styles.sectionContentCollapsed}
      >
        {children}
      </div>
    </section>
  );
}
</file>

<file path="components/forms/form-atualizar-senha.tsx">
"use client";

import { cn } from "@/lib/utils";
import { updatePassword } from "@/app/auth/actions";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import Image from "next/image";
import { useState } from "react";
import { useFormState } from "react-dom";

export function FormAtualizarSenha({
  className,
  ...props
}: React.ComponentPropsWithoutRef<"div">) {
  const [isPending, setIsPending] = useState(false);
  
  const [state, formAction] = useFormState(async (prevState: { error: string | null }, formData: FormData) => {
    try {
      await updatePassword(formData);
      return { error: null };
    } catch (error) {
      return { error: error instanceof Error ? error.message : "Ocorreu um erro" };
    }
  }, { error: null });

  return (
    <div className={cn("flex flex-col gap-6", className)} {...props}>
      <Card>
        <CardHeader>
          <div className="flex justify-center mb-2">
            <Image
              src="/logo.svg"
              alt="DROPTECH"
              width={200}
              height={29}
              priority
              className="h-[29px] w-auto"
            />
          </div>
          <CardDescription className="text-center">
            Por favor, digite sua nova senha abaixo.
          </CardDescription>
        </CardHeader>
        <CardContent>
          <form action={formAction} onSubmit={() => setIsPending(true)}>
            <div className="flex flex-col gap-6">
              <div className="grid gap-2">
                <Label htmlFor="password">Nova senha</Label>
                <Input
                  id="password"
                  name="password"
                  type="password"
                  placeholder="Nova senha"
                  required
                />
              </div>
              {state.error && <p className="text-sm text-red-500">{state.error}</p>}
              <Button 
                type="submit" 
                className="w-full bg-[#ecf230] text-[#312e2e] hover:bg-[#ecf230]/90" 
                disabled={isPending}
              >
                {isPending ? "Salvando..." : "Salvar nova senha"}
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="components/forms/form-esqueci-senha.tsx">
"use client";

import { cn } from "@/lib/utils";
import { resetPassword } from "@/app/auth/actions";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import Link from "next/link";
import Image from "next/image";
import { useState } from "react";

export function FormEsqueciSenha({
  className,
  ...props
}: React.ComponentPropsWithoutRef<"div">) {
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const handleForgotPassword = async (formData: FormData) => {
    setIsLoading(true);
    setError(null);

    try {
      await resetPassword(formData);
      setSuccess(true);
    } catch (error: unknown) {
      setError(error instanceof Error ? error.message : "Ocorreu um erro");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className={cn("flex flex-col gap-6", className)} {...props}>
      {success ? (
        <Card>
          <CardHeader>
            <div className="flex justify-center mb-2">
              <Image
                src="/logo.svg"
                alt="DROPTECH"
                width={200}
                height={29}
                priority
                className="h-[29px] w-auto"
              />
            </div>
            <CardDescription className="text-center">Instruções de redefinição de senha enviadas</CardDescription>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground">
              Se você se registrou usando seu email e senha, você receberá um email de redefinição de senha.
            </p>
          </CardContent>
        </Card>
      ) : (
        <Card>
          <CardHeader>
            <div className="flex justify-center mb-2">
              <Image
                src="/logo.svg"
                alt="DROPTECH"
                width={200}
                height={29}
                priority
                className="h-[29px] w-auto"
              />
            </div>
            <CardDescription className="text-center">
              Digite seu email e enviaremos um link para redefinir sua senha
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form action={handleForgotPassword}>
              <div className="flex flex-col gap-6">
                <div className="grid gap-2">
                  <Label htmlFor="email">Email</Label>
                  <Input
                    id="email"
                    name="email"
                    type="email"
                    placeholder="m@example.com"
                    required
                  />
                </div>
                {error && <p className="text-sm text-red-500">{error}</p>}
                <Button 
                  type="submit" 
                  className="w-full bg-[#ecf230] text-[#312e2e] hover:bg-[#ecf230]/90" 
                  disabled={isLoading}
                >
                  {isLoading ? "Enviando..." : "Enviar email de redefinição"}
                </Button>
              </div>
              <div className="mt-4 text-center text-sm">
                Já tem uma conta?{" "}
                <Link
                  href="/auth/login"
                  className="underline underline-offset-4"
                >
                  Entrar
                </Link>
              </div>
            </form>
          </CardContent>
        </Card>
      )}
    </div>
  );
}
</file>

<file path="components/forms/steps/StepBasicInfo.tsx">
"use client";

import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import type { AdFormData } from "@/components/forms/MultiStepAdForm";

interface StepBasicInfoProps {
  formData: AdFormData;
  updateFormData: (updates: Partial<AdFormData>) => void;
  errors: Array<{ field: string; message: string }>;
}

export function StepBasicInfo({ formData, updateFormData, errors }: StepBasicInfoProps) {
  const getError = (field: string) => errors.find(e => e.field === field)?.message;

  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>Informações Básicas</CardTitle>
        <CardDescription>
          Vamos começar com as informações principais do seu produto
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-6 max-[480px]:space-y-4 max-[480px]:p-4">
        {/* Título */}
        <div className="space-y-2">
          <Label htmlFor="title">Título do Produto *</Label>
          <Input
            id="title"
            placeholder="Ex: Placa de Vídeo RTX 4060 Ti 16GB"
            value={formData.title}
            onChange={(e) => updateFormData({ title: e.target.value })}
            className={getError('title') ? 'border-red-500' : ''}
          />
          {getError('title') && (
            <p className="text-sm text-red-600">{getError('title')}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Use um título claro e descritivo para atrair mais compradores
          </p>
        </div>

        {/* Preço */}
        <div className="space-y-2">
          <Label htmlFor="price">Preço (R$) *</Label>
          <Input
            id="price"
            type="number"
            step="0.01"
            min="0"
            placeholder="0,00"
            value={formData.price || ''}
            onChange={(e) => updateFormData({ price: parseFloat(e.target.value) || 0 })}
            className={getError('price') ? 'border-red-500' : ''}
          />
          {getError('price') && (
            <p className="text-sm text-red-600">{getError('price')}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Defina um preço justo baseado no valor de mercado
          </p>
        </div>

        {/* Descrição */}
        <div className="space-y-2">
          <Label htmlFor="description">Descrição Detalhada *</Label>
          <textarea
            id="description"
            className={`flex min-h-[120px] w-full rounded-md border bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${
              getError('description') ? 'border-red-500' : 'border-input'
            }`}
            placeholder="Descreva as características, estado de conservação, especificações técnicas, tempo de uso, motivo da venda, etc."
            value={formData.description}
            onChange={(e) => updateFormData({ description: e.target.value })}
          />
          {getError('description') && (
            <p className="text-sm text-red-600">{getError('description')}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Quanto mais detalhes, mais confiança você passa aos compradores
          </p>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="components/forms/steps/StepCategoryTags.tsx">
"use client";

import { useState, useEffect } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { X } from "lucide-react";
import { createClient } from "@/lib/supabase/client";
import type { AdFormData } from "@/components/forms/MultiStepAdForm";

interface Category {
  id: string;
  name: string;
  slug: string;
}

interface Tag {
  id: string;
  name: string;
}

interface StepCategoryTagsProps {
  formData: AdFormData;
  updateFormData: (updates: Partial<AdFormData>) => void;
  errors: Array<{ field: string; message: string }>;
}

export function StepCategoryTags({ formData, updateFormData, errors }: StepCategoryTagsProps) {
  const [categories, setCategories] = useState<Category[]>([]);
  const [tags, setTags] = useState<Tag[]>([]);
  const [filteredTags, setFilteredTags] = useState<Tag[]>([]);
  const [loadingCategories, setLoadingCategories] = useState(true);
  const [loadingTags, setLoadingTags] = useState(true);

  const getError = (field: string) => errors.find(e => e.field === field)?.message;

  // Buscar categorias
  useEffect(() => {
    async function fetchCategories() {
      const supabase = createClient();
      const { data } = await supabase
        .from('categories')
        .select('*')
        .order('name');
      
      setCategories(data || []);
      setLoadingCategories(false);
    }

    fetchCategories();
  }, []);

  // Buscar tags
  useEffect(() => {
    async function fetchTags() {
      const supabase = createClient();
      const { data } = await supabase
        .from('tags')
        .select('*')
        .order('name');
      
      setTags(data || []);
      setFilteredTags(data || []);
      setLoadingTags(false);
    }

    fetchTags();
  }, []);

  // Filtrar tags baseado na categoria selecionada
  useEffect(() => {
    if (formData.category_id) {
      // Por enquanto mostrar todas as tags, mas pode ser filtrado por categoria
      setFilteredTags(tags);
    } else {
      setFilteredTags(tags);
    }
  }, [formData.category_id, tags]);

  const selectCategory = (categoryId: string) => {
    updateFormData({ category_id: categoryId });
  };

  const toggleTag = (tagId: string) => {
    const currentTags = formData.tag_ids || [];
    const newTags = currentTags.includes(tagId)
      ? currentTags.filter(id => id !== tagId)
      : [...currentTags, tagId];
    
    updateFormData({ tag_ids: newTags });
  };

  const removeTag = (tagId: string) => {
    const newTags = (formData.tag_ids || []).filter(id => id !== tagId);
    updateFormData({ tag_ids: newTags });
  };

  const selectedCategory = categories.find(cat => cat.id === formData.category_id);
  const selectedTags = tags.filter(tag => (formData.tag_ids || []).includes(tag.id));

  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>Categoria e Tags</CardTitle>
        <CardDescription>
          Escolha a categoria e adicione tags para facilitar a busca
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-8 max-[480px]:space-y-6 max-[480px]:p-4">
        {/* Categoria */}
        <div className="space-y-4">
          <div>
            <Label>Categoria *</Label>
            {getError('category_id') && (
              <p className="text-sm text-red-600 mt-1">{getError('category_id')}</p>
            )}
          </div>

          {loadingCategories ? (
            <div className="text-sm text-muted-foreground">Carregando categorias...</div>
          ) : (
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
              {categories.map(category => (
                <Button
                  key={category.id}
                  variant={formData.category_id === category.id ? "default" : "outline"}
                  className="h-auto p-4 text-left justify-start"
                  onClick={() => selectCategory(category.id)}
                >
                  {category.name}
                </Button>
              ))}
            </div>
          )}

          {selectedCategory && (
            <div className="flex items-center gap-2 p-3 bg-muted rounded-md">
              <Badge variant="default">{selectedCategory.name}</Badge>
              <span className="text-sm text-muted-foreground">categoria selecionada</span>
            </div>
          )}
        </div>

        {/* Tags */}
        <div className="space-y-4">
          <div>
            <Label>Tags (opcional)</Label>
            <p className="text-sm text-muted-foreground">
              Adicione até 5 tags para descrever melhor seu produto
            </p>
          </div>

          {/* Tags Selecionadas */}
          {selectedTags.length > 0 && (
            <div className="space-y-2">
              <span className="text-sm font-medium">Tags selecionadas:</span>
              <div className="flex flex-wrap gap-2">
                {selectedTags.map(tag => (
                  <Badge
                    key={tag.id}
                    variant="secondary"
                    className="flex items-center gap-1 pr-1"
                  >
                    {tag.name}
                    <Button
                      variant="ghost"
                      size="sm"
                      className="h-4 w-4 p-0 hover:bg-transparent"
                      onClick={() => removeTag(tag.id)}
                    >
                      <X className="h-3 w-3" />
                    </Button>
                  </Badge>
                ))}
              </div>
            </div>
          )}

          {/* Lista de Tags Disponíveis */}
          {loadingTags ? (
            <div className="text-sm text-muted-foreground">Carregando tags...</div>
          ) : (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-2 max-h-48 overflow-y-auto">
              {filteredTags
                .filter(tag => !(formData.tag_ids || []).includes(tag.id))
                .map(tag => (
                  <Button
                    key={tag.id}
                    variant="outline"
                    size="sm"
                    className="text-xs justify-start"
                    onClick={() => toggleTag(tag.id)}
                    disabled={(formData.tag_ids || []).length >= 5}
                  >
                    + {tag.name}
                  </Button>
                ))}
            </div>
          )}

          {(formData.tag_ids || []).length >= 5 && (
            <p className="text-sm text-amber-600">
              Máximo de 5 tags atingido
            </p>
          )}
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="components/sections/missao/index.tsx">
import Link from "next/link";
import { cn } from "@/lib/utils";
import styles from "./secao-missao.module.css";

type Testimonial = {
  name: string;
  text: string;
};

const testimonials: Testimonial[] = [
  {
    name: "Carlos G.",
    text: "\"Em poucos dias comecei a receber mensagens de pessoas que realmente entendem de tecnologia.\"",
  },
  {
    name: "Michelle C.",
    text: "\"Gostei muito da DropTech. Dá pra encontrar produtos tech de forma rápida, organizada e sem propaganda de marketplaces.\"",
  },
  {
    name: "Yasmin R.",
    text: "\"Estou há semanas tentando vender meu iPhone; anunciei aqui sem expectativa e, pra minha surpresa, apareceu alguém e vendi sem dor de cabeça!\"",
  },
];

function Stars() {
  return (
    <div className={styles.stars} aria-label="5 estrelas">
      {Array.from({ length: 5 }).map((_, idx) => (
        <svg
          key={idx}
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="currentColor"
          aria-hidden
        >
          <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
        </svg>
      ))}
    </div>
  );
}

function TestimonialCard({ name, text, className }: { name: string; text: string; className?: string }) {
  const initials = name
    .split(" ")
    .slice(0, 2)
    .map((p) => p[0])
    .join("")
    .toUpperCase();

  return (
    <div className={cn(styles.card, className)}>
      <div className={styles.cardTop}>
        <div className={styles.avatar} aria-hidden>
          {initials}
        </div>
        <div className={styles.cardMeta}>
          <div className={styles.cardName}>{name}</div>
          <Stars />
        </div>
      </div>
      <p className={styles.cardText}>{text}</p>
    </div>
  );
}

export function SecaoMissao() {
  return (
    <section id="sobre" className={cn("w-full scroll-mt-[262px]", styles.section)}>
      <div className={cn("mx-auto w-full max-w-[1800px]", styles.inner)}>
        <div className={styles.grid}>
          <div className={styles.left} aria-hidden>
            <div className={styles.productMock} />
          </div>

          <div id="missao"  className={styles.right}>
            <div className={styles.kicker}>Nossa missão</div>

            <h2 className={styles.title}>
              Conectar tecnologia a oportunidades reais
            </h2>

            <p className={styles.subtitle}>
              Queremos facilitar a compra e venda de tecnologia, aproximando quem vende e procura produtos tech.
            </p>

            <Link href="/explorar" className={styles.cta}>
              Explorar Ofertas
            </Link>

            <div className={styles.floatingCards}>
              <TestimonialCard
                name={testimonials[0].name}
                text={testimonials[0].text}
                className={styles.cardA}
              />
              <TestimonialCard
                name={testimonials[1].name}
                text={testimonials[1].text}
                className={styles.cardB}
              />
              <TestimonialCard
                name={testimonials[2].name}
                text={testimonials[2].text}
                className={styles.cardC}
              />
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="components/sections/semelhantes/index.tsx">
import { createClient } from "@/lib/supabase/server";
import styles from "./semelhantes.module.css";
import { cn } from "@/lib/utils";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio/index";

interface SecaoSemelhantesProps {
  currentProductId?: string;
  category?: string;
}

export async function SecaoSemelhantes({ currentProductId, category }: SecaoSemelhantesProps = {}) {
  const supabase = await createClient();

  let query = supabase
    .from("products")
    .select(`
      *,
      tags:products_tags(
        tag:tags(
          name
        )
      )
    `)
    .eq("status", "aprovado");

  // Se temos um produto atual, excluí-lo dos resultados
  if (currentProductId) {
    query = query.neq("id", currentProductId);
  }

  // Se temos uma categoria, priorizar produtos da mesma categoria
  if (category) {
    const { data: categoryProducts } = await query
      .ilike("category", `%${category}%`)
      .order("created_at", { ascending: false })
      .limit(12);

    if (categoryProducts && categoryProducts.length >= 4) {
      // Transformar os dados
      const transformedProducts = categoryProducts.map(product => ({
        ...product,
        tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
      }));
      
      const items = transformedProducts as ProductRow[];
      const displayItems = items.length < 6 ? [...items, ...items] : items;
      return renderSection(displayItems);
    }
  }

  // Caso contrário, buscar produtos gerais
  const { data: products } = await query
    .order("created_at", { ascending: false })
    .limit(12);

  // Transformar os dados
  const transformedProducts = (products ?? []).map(product => ({
    ...product,
    tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
  }));

  const items = transformedProducts as ProductRow[];
  const displayItems = items.length < 6 ? [...items, ...items, ...items] : items;

  return renderSection(displayItems);
}

function renderSection(displayItems: ProductRow[]) {
  return (
    <section className={cn("w-full scroll-mt-[262px]", styles.section)}>
      <div className="mx-auto flex w-full flex-col items-center gap-[80px] px-4 py-[50px] pb-[60px] md:px-16 lg:px-[199px]">
        <div className="flex w-full max-w-[1040px] flex-col items-center justify-center gap-6 text-center">
          <h2 className={cn("text-white font-medium", styles.title)}>
            Veja outros anúncios semelhantes
          </h2>
        </div>
      </div>

      <div className={styles.tickerWrap}>
        <div className={styles.tickerTrack}>
          <div className={styles.tickerGroup}>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>

          <div className={styles.tickerGroup} aria-hidden>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}-dup`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="components/ui/card.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-xl border bg-card text-card-foreground shadow",
      className,
    )}
    {...props}
  />
));
Card.displayName = "Card";

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6 pt-12", className)}
    {...props}
  />
));
CardHeader.displayName = "CardHeader";

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("font-semibold leading-none tracking-tight", className)}
    {...props}
  />
));
CardTitle.displayName = "CardTitle";

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground text-balance", className)}
    {...props}
  />
));
CardDescription.displayName = "CardDescription";

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-12 pt-8", className)} {...props} />
));
CardContent.displayName = "CardContent";

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
));
CardFooter.displayName = "CardFooter";

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardDescription,
  CardContent,
};
</file>

<file path="components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-[calc(100%-2rem)] max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-4 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:p-6 sm:w-full",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-base font-semibold leading-none tracking-tight sm:text-lg",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-xs text-muted-foreground sm:text-sm", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
</file>

<file path="components/ui/input.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 sm:text-base",
          className,
        )}
        ref={ref}
        {...props}
      />
    );
  },
);
Input.displayName = "Input";

export { Input };
</file>

<file path="components/ui/label.tsx">
"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const labelVariants = cva(
  "text-xs font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 sm:text-sm",
);

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
));
Label.displayName = LabelPrimitive.Root.displayName;

export { Label };
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  {
    ignores: [
      ".next/**",
      "node_modules/**",
      "dist/**",
      "build/**",
      "out/**",
      "coverage/**",
    ],
  },
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;
</file>

<file path="lib/hooks/useFilters.ts">
'use client';

import { useState, useEffect, useCallback } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import type { FilterParams } from '../../app/(main)/explorar/actions';

const DEBOUNCE_DELAY = 500; // 500ms

export function useFilters() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const [isInitialized, setIsInitialized] = useState(false);
  
  // Estado dos filtros - inicializar com valores padrão primeiro
  const [filters, setFilters] = useState<FilterParams>({
    search: '',
    tags: [],
    categories: [],
    minPrice: undefined,
    maxPrice: undefined,
    priceRange: '',
    location: '',
    city: '',
    state: '',
    dateFilter: '',
    sortBy: 'newest',
    status: '',
    page: 1,
    limit: 12
  });

  // Estado para debounce da busca
  const [searchDebounce, setSearchDebounce] = useState('');

  // Inicializar filtros a partir da URL apenas uma vez
  useEffect(() => {
    const filtersFromURL: FilterParams = {
      search: searchParams.get('search') || '',
      tags: searchParams.getAll('tags') || [],
      categories: searchParams.getAll('categories') || [],
      minPrice: searchParams.get('minPrice') ? Number(searchParams.get('minPrice')) : undefined,
      maxPrice: searchParams.get('maxPrice') ? Number(searchParams.get('maxPrice')) : undefined,
      priceRange: searchParams.get('priceRange') || '',
      location: searchParams.get('location') || '',
      city: searchParams.get('city') || '',
      state: searchParams.get('state') || '',
      dateFilter: searchParams.get('dateFilter') || '',
      sortBy: (searchParams.get('sortBy') as FilterParams['sortBy']) || 'newest',
      page: searchParams.get('page') ? Number(searchParams.get('page')) : 1,
      limit: 12
    };
    
    setFilters(filtersFromURL);
    setSearchDebounce(filtersFromURL.search || '');
    setIsInitialized(true);
  }, [searchParams]); // Reagir quando searchParams mudam

  // Atualizar URL quando filtros mudarem (mas não durante a inicialização)
  const updateURL = useCallback((newFilters: FilterParams) => {
    if (!isInitialized) return;
    
    const params = new URLSearchParams();
    
    Object.entries(newFilters).forEach(([key, value]) => {
      if (value !== undefined && value !== null && value !== '') {
        if (Array.isArray(value)) {
          value.forEach(v => params.append(key, String(v)));
        } else {
          params.set(key, String(value));
        }
      }
    });

    const url = params.toString() ? `?${params.toString()}` : '';
    router.push(`/explorar${url}`, { scroll: false });
  }, [router, isInitialized]);

  // Função para atualizar filtros
  const updateFilters = useCallback((newFilters: Partial<FilterParams>) => {
    const updated = { ...filters, ...newFilters };
    setFilters(updated);
    
    // Atualizar URL em um useEffect separado para evitar setState durante render
    if (isInitialized) {
      setTimeout(() => {
        updateURL(updated);
      }, 0);
    }
  }, [filters, isInitialized, updateURL]);

  // Debounce para busca por texto
  useEffect(() => {
    if (!isInitialized) return;
    
    const timer = setTimeout(() => {
      if (searchDebounce !== filters.search) {
        updateFilters({ search: searchDebounce, page: 1 });
      }
    }, DEBOUNCE_DELAY);

    return () => clearTimeout(timer);
  }, [searchDebounce, filters.search, updateFilters, isInitialized]);

  // Função para atualizar busca com debounce
  const updateSearch = useCallback((search: string) => {
    setSearchDebounce(search);
  }, []);

  // Função para resetar filtros
  const resetFilters = useCallback(() => {
    const defaultFilters: FilterParams = {
      search: '',
      tags: [],
      categories: [],
      minPrice: undefined,
      maxPrice: undefined,
      priceRange: '',
      location: '',
      city: '',
      state: '',
      dateFilter: '',
      sortBy: 'newest',
      page: 1,
      limit: 12
    };
    setFilters(defaultFilters);
    setSearchDebounce('');
    updateURL(defaultFilters);
  }, [updateURL]);

  // Função para adicionar/remover tag
  const toggleTag = useCallback((tag: string) => {
    const currentTags = filters.tags || [];
    updateFilters({
      tags: currentTags.includes(tag)
        ? currentTags.filter((t: string) => t !== tag)
        : [...currentTags, tag],
      page: 1
    });
  }, [filters.tags, updateFilters]);

  // Função para adicionar/remover categoria
  const toggleCategory = useCallback((category: string) => {
    const currentCategories = filters.categories || [];
    updateFilters({
      categories: currentCategories.includes(category)
        ? currentCategories.filter((c: string) => c !== category)
        : [...currentCategories, category],
      page: 1
    });
  }, [filters.categories, updateFilters]);

  // Função para definir faixa de preço
  const setPriceRange = useCallback((priceRange: string) => {
    updateFilters({
      priceRange,
      minPrice: undefined, // Limpar preços customizados quando usar faixa
      maxPrice: undefined,
      page: 1
    });
  }, [updateFilters]);

  // Função para definir preços customizados
  const setCustomPrice = useCallback((minPrice?: number, maxPrice?: number) => {
    updateFilters({
      minPrice,
      maxPrice,
      priceRange: '', // Limpar faixa quando usar preços customizados
      page: 1
    });
  }, [updateFilters]);

  return {
    filters,
    searchDebounce,
    updateFilters,
    updateSearch,
    resetFilters,
    toggleTag,
    toggleCategory,
    setPriceRange,
    setCustomPrice
  };
}
</file>

<file path="lib/hooks/useLocalFilters.ts">
'use client';

import { useState, useCallback } from 'react';
import type { FilterParams } from '../../app/(main)/explorar/actions';

export function useLocalFilters() {
  // Estado dos filtros - sem redirecionamento
  const [filters, setFilters] = useState<FilterParams>({
    search: '',
    tags: [],
    categories: [],
    minPrice: undefined,
    maxPrice: undefined,
    priceRange: '',
    location: '',
    city: '',
    state: '',
    dateFilter: '',
    sortBy: 'newest',
    status: '',
    page: 1,
    limit: 12
  });

  // Estado para debounce da busca
  const [searchDebounce, setSearchDebounce] = useState('');

  // Função para atualizar filtros (sem atualizar URL)
  const updateFilters = useCallback((newFilters: Partial<FilterParams>) => {
    setFilters(prev => ({ ...prev, ...newFilters }));
  }, []);

  // Função para atualizar busca com debounce
  const updateSearch = useCallback((value: string) => {
    setSearchDebounce(value);
    // Aplicar a busca imediatamente aos filtros (sem debounce para simplicidade)
    updateFilters({ search: value, page: 1 });
  }, [updateFilters]);

  // Toggle de tag
  const toggleTag = useCallback((tag: string) => {
    const currentTags = filters.tags || [];
    const newTags = currentTags.includes(tag)
      ? currentTags.filter(t => t !== tag)
      : [...currentTags, tag];
    
    updateFilters({ tags: newTags, page: 1 });
  }, [filters.tags, updateFilters]);

  // Toggle de categoria
  const toggleCategory = useCallback((category: string) => {
    const currentCategories = filters.categories || [];
    const newCategories = currentCategories.includes(category)
      ? currentCategories.filter(c => c !== category)
      : [...currentCategories, category];
    
    updateFilters({ categories: newCategories, page: 1 });
  }, [filters.categories, updateFilters]);

  // Definir faixa de preço
  const setPriceRange = useCallback((range: string) => {
    // Converter faixa de preço em valores min/max
    let minPrice: number | undefined;
    let maxPrice: number | undefined;
    
    switch (range) {
      case 'Até R$ 500':
        minPrice = 0;
        maxPrice = 500;
        break;
      case 'R$ 500 - R$ 1.000':
        minPrice = 500;
        maxPrice = 1000;
        break;
      case 'R$ 1.000 - R$ 2.500':
        minPrice = 1000;
        maxPrice = 2500;
        break;
      case 'R$ 2.500 - R$ 5.000':
        minPrice = 2500;
        maxPrice = 5000;
        break;
      case 'R$ 5.000 - R$ 10.000':
        minPrice = 5000;
        maxPrice = 10000;
        break;
      case 'Acima de R$ 10.000':
        minPrice = 10000;
        maxPrice = undefined;
        break;
      default:
        minPrice = undefined;
        maxPrice = undefined;
        break;
    }
    
    updateFilters({ 
      priceRange: range, 
      minPrice, 
      maxPrice, 
      page: 1 
    });
  }, [updateFilters]);

  // Definir preço customizado
  const setCustomPrice = useCallback((min?: number, max?: number) => {
    updateFilters({ minPrice: min, maxPrice: max, page: 1 });
  }, [updateFilters]);

  // Limpar todos os filtros
  const clearFilters = useCallback(() => {
    setFilters({
      search: '',
      tags: [],
      categories: [],
      minPrice: undefined,
      maxPrice: undefined,
      priceRange: '',
      location: '',
      city: '',
      state: '',
      dateFilter: '',
      sortBy: 'newest',
      status: '',
      page: 1,
      limit: 12
    });
    setSearchDebounce('');
  }, []);

  return {
    filters,
    searchDebounce,
    updateFilters,
    updateSearch,
    toggleTag,
    toggleCategory,
    setPriceRange,
    setCustomPrice,
    clearFilters
  };
}
</file>

<file path="lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// This check can be removed, it is just for tutorial purposes
export const hasEnvVars = Boolean(
  process.env.NEXT_PUBLIC_SUPABASE_URL &&
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY,
);
</file>

<file path=".gitignore">
# dependencies
/node_modules

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# env files (can opt-in for committing if needed)
.env*.local
.env

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="app/(main)/admin/moderacao/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation";

type ProductStatus = 'pendente' | 'aprovado' | 'reprovado' | 'vendido' | 'all';

export async function getModerationPageData(status: ProductStatus = 'pendente') {
  const supabase = await createClient();
  
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) redirect("/auth/login");

  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single();

  if (profile?.role !== "admin") {
    redirect("/");
  }

  let query = supabase
    .from("products")
    .select(`
      *,
      profiles!products_seller_id_fkey(id, full_name)
    `)
    .order('created_at', { ascending: false });

  if (status !== 'all') {
    query = query.eq("status", status);
  }

  const { data: products, error } = await query;

  if (error) {
    console.error('Error fetching products:', error);
    return { products: [] };
  }

  return { products: products || [] };
}

export async function approveProduct(formData: FormData) {
  const productId = formData.get("productId") as string;
  const supabase = await createClient();
  
  const { error } = await supabase
    .from("products")
    .update({ status: "aprovado" })
    .eq("id", productId);
    
  if (error) {
    console.error('Error approving product:', error);
    throw new Error('Failed to approve product');
  }
    
  revalidatePath("/admin/moderacao");
  revalidatePath("/explorar");
}

export async function rejectProduct(formData: FormData) {
  const productId = formData.get("productId") as string;
  const supabase = await createClient();
  
  const { error } = await supabase
    .from("products")
    .update({ status: "reprovado" })
    .eq("id", productId);
    
  if (error) {
    console.error('Error rejecting product:', error);
    throw new Error('Failed to reject product');
  }
    
  revalidatePath("/admin/moderacao");
}

export async function deleteProduct(formData: FormData) {
  const productId = formData.get("productId") as string;
  const supabase = await createClient();
  
  const { error } = await supabase
    .from("products")
    .delete()
    .eq("id", productId);
    
  if (error) {
    console.error('Error deleting product:', error);
    throw new Error('Failed to delete product');
  }
    
  revalidatePath("/admin/moderacao");
}
</file>

<file path="app/(main)/admin/moderacao/ModerationContent.tsx">
"use client";

import { Badge } from "@/components/ui/badge";
import { ModerationGrid } from "./ModerationGrid";
import type { Tables } from "@/src/types/supabase";

type Product = Tables<"products"> & {
  tags?: Array<{ name: string; }>;
};

type ProductStatus = 'pendente' | 'aprovado' | 'reprovado' | 'vendido' | 'all';

interface ModerationContentProps {
  products: Product[];
  currentStatus: ProductStatus;
}

export function ModerationContent({ products, currentStatus }: ModerationContentProps) {
 

  const handleStatusChange = (value: string) => {
    const status = value as ProductStatus;
    
    // Forçar refresh da página para evitar problemas de estado
    if (status === 'pendente') {
      window.location.href = '/admin/moderacao';
    } else {
      window.location.href = `/admin/moderacao?status=${status}`;
    }
  };

  const getStatusCount = (status: ProductStatus) => {
    if (status === 'all') return products.length;
    return currentStatus === status ? products.length : 0;
  };

  const getStatusConfig = (status: ProductStatus) => {
    switch (status) {
      case 'pendente':
        return { label: 'Pendentes', color: 'bg-white/10 text-orange-200 border-white/20 backdrop-blur-sm' };
      case 'aprovado':
        return { label: 'Aprovados', color: 'bg-white/10 text-green-200 border-white/20 backdrop-blur-sm' };
      case 'reprovado':
        return { label: 'Reprovados', color: 'bg-white/10 text-red-200 border-white/20 backdrop-blur-sm' };
      case 'vendido':
        return { label: 'Vendidos', color: 'bg-white/10 text-blue-200 border-white/20 backdrop-blur-sm' };
      case 'all':
        return { label: 'Todos', color: 'bg-white/10 text-white/70 border-white/20 backdrop-blur-sm' };
    }
  };

  return (
    <div>
      {/* Filtros */}
      <div className="bg-white/5 rounded-xl shadow-sm border border-white/10 p-4 md:p-6 backdrop-blur-sm">
        <div className="flex flex-col space-y-4">
          <h2 className="text-lg font-semibold text-white">Filtros</h2>
          
          <div className="grid grid-cols-2 md:flex md:flex-wrap gap-2">
            {[
              { value: 'pendente', label: 'Pendentes' },
              { value: 'aprovado', label: 'Aprovados' },
              { value: 'reprovado', label: 'Reprovados' },
              { value: 'vendido', label: 'Vendidos' },
              { value: 'all', label: 'Todos' }
            ].map((item) => (
              <button
                key={item.value}
                onClick={() => handleStatusChange(item.value)}
                className={`px-3 md:px-4 py-2 rounded-lg transition-colors backdrop-blur-sm text-sm md:text-base ${
                  currentStatus === item.value
                    ? 'bg-white/20 text-white border border-white/30'
                    : 'bg-black/20 text-white/70 hover:bg-white/10 border border-white/10 hover:text-white'
                }`}
              >
                <div className="flex items-center gap-1 md:gap-2">
                  <span className="truncate">{item.label}</span>
                  {currentStatus === item.value && (
                    <Badge variant="secondary" className="bg-white/10 text-white/80 border-white/20 text-xs hidden sm:inline-flex">
                      {getStatusCount(item.value as ProductStatus)}
                    </Badge>
                  )}
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Status Badge e Contagem */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-6 md:mt-10">
        <div className="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3">
          <Badge className={getStatusConfig(currentStatus).color}>
            {getStatusConfig(currentStatus).label}
          </Badge>
          <span className="text-white/70 text-sm md:text-base">
            {products.length} {products.length === 1 ? 'anúncio' : 'anúncios'} encontrado{products.length === 1 ? '' : 's'}
          </span>
        </div>
      </div>

      {/* Grid de produtos */}
      <ModerationGrid products={products} currentStatus={currentStatus} />
    </div>
  );
}
</file>

<file path="app/(main)/admin/moderacao/ModerationGrid.tsx">
"use client";

import { useState } from "react";
import { ModerationCard } from "./ModerationCard";
import { ProductPreviewModal } from "./ProductPreviewModal";
import type { Tables } from "@/src/types/supabase";

type Product = Tables<"products"> & {
  tags?: Array<{ name: string; }>;
};

type ProductStatus = 'pendente' | 'aprovado' | 'reprovado' | 'vendido' | 'all';

interface ModerationGridProps {
  products: Product[];
  currentStatus: ProductStatus;
}

export function ModerationGrid({ products, currentStatus }: ModerationGridProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);

  if (products.length === 0) {
    return (
      <div className="bg-white/5 rounded-xl shadow-sm border border-white/10 p-8 md:p-12 backdrop-blur-sm mt-6 md:mt-10">
        <div className="text-center text-white/70">
          <div className="text-4xl md:text-6xl mb-4">
            {currentStatus === 'pendente' && '⏳'}
            {currentStatus === 'aprovado' && '✅'}
            {currentStatus === 'reprovado' && '❌'}
            {currentStatus === 'vendido' && '💰'}
            {currentStatus === 'all' && '📋'}
          </div>
          <h3 className="text-lg md:text-xl font-medium mb-2 text-white">
            Nenhum anúncio encontrado
          </h3>
          <p className="text-sm md:text-base text-white/60">
            {currentStatus === 'pendente' && 'Não há anúncios pendentes de moderação.'}
            {currentStatus === 'aprovado' && 'Não há anúncios aprovados.'}
            {currentStatus === 'reprovado' && 'Não há anúncios reprovados.'}
            {currentStatus === 'vendido' && 'Não há anúncios vendidos.'}
            {currentStatus === 'all' && 'Não há anúncios no sistema.'}
          </p>
        </div>
      </div>
    );
  }

  return (
    <>
      <div className="explore-grid justify-items-center gap-6 mt-6 md:mt-10">
        {products.map((product) => (
          <div key={product.id} className="w-full">
            <ModerationCard 
              product={product}
              currentStatus={currentStatus}
              onViewDetails={() => setSelectedProduct(product)}
            />
          </div>
        ))}
      </div>

      {/* Modal de prévia */}
      {selectedProduct && (
        <ProductPreviewModal
          product={selectedProduct}
          onClose={() => setSelectedProduct(null)}
        />
      )}
    </>
  );
}
</file>

<file path="app/(main)/layout.tsx">
export default function MainLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <>{children}</>
  );
}
</file>

<file path="components/cards/anuncio/card-anuncio.module.css">
.tag {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 100px;
  padding: 8px 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  font-size: 14px;
  line-height: 0.9285714286em;
  color: #ffffff;
}

.tagAlt {
  background: rgba(255, 255, 255, 0.13);
}

.heart {
  width: 38px;
  height: 38px;
  border-radius: 900px;
}

.cardTitle {
  font-size: 20px;
  width: 100%;
  line-height: 1em;
  color: #000000;
}

.locationText {
  font-size: 14px;
  line-height: 0.8571428571em;
  color: rgba(0, 0, 0, 0.64);
}

.price {
  font-size: 26px;
  line-height: 0.7692307692em;
  letter-spacing: 0.04em;
  color: #00875f;
}

.cardRoot {
  height: 395px;
  max-width: 478px;
}

@media (max-width: 1024px) {
  .cardRoot {
    height: 340px;
    max-width: 420px;
  }

  .cardTitle { font-size: 18px; }
  .price { font-size: 22px; }
  .tag { font-size: 13px; }
}

@media (max-width: 768px) {
  .cardRoot {
    height: 300px;
    max-width: 360px;
  }

  .cardTitle { font-size: 16px; }
  .price { font-size: 20px; }
  .locationText { font-size: 13px; }
}

@media (max-width: 480px) {
  .cardRoot {
    height: 260px;
    max-width: 320px;
  }

  .cardTitle { font-size: 14px; }
  .price { font-size: 18px; }
  .tag { padding: 6px 8px; font-size: 12px; }
  .heart { width: 34px; height: 34px; }
}
</file>

<file path="components/dashboard/FavoritesContent.tsx">
'use client';

import { useEffect, useState, useCallback } from "react";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio";
import { ResultsHeader } from "@/components/filters/ResultsHeader";
import { useLocalFilters } from "@/lib/hooks/useLocalFilters";
import { getFavorites } from "../../app/(main)/dashboard/favoritos/actions";
import type { Favorite } from "@/src/types/products";
import LocalFilterBar from "@/components/dashboard/LocalFilterBar";
import LocalFilters from "@/components/dashboard/LocalFilters";
import { ActiveFilters } from "@/components/dashboard/ActiveFilters";
import type { FilterParams } from '../../app/(main)/explorar/actions';

// Interface para o produto completo com campos adicionais
interface ExtendedProduct {
  id: string;
  title: string;
  price: number;
  images_urls: string[] | null;
  status: string;
  address?: string | null;
  category?: string | null;
  city?: string | null;
  contact_phone?: string | null;
  created_at?: string | null;
  description?: string | null;
  seller_id?: string;
  state?: string | null;
  tags?: Array<{ tag: { name: string } }>;
}

// Converter Favorite para ProductRow
function favoriteToProductRow(favorite: Favorite): ProductRow | null {
  const product = Array.isArray(favorite.product) ? favorite.product[0] : favorite.product;
  
  if (!product) return null;
  
  const extendedProduct = product as ExtendedProduct;
  
  return {
    id: extendedProduct.id,
    title: extendedProduct.title,
    price: extendedProduct.price,
    images_urls: extendedProduct.images_urls,
    status: extendedProduct.status,
    address: extendedProduct.address || null,
    category: extendedProduct.category || null,
    city: extendedProduct.city || null,
    contact_phone: extendedProduct.contact_phone || null,
    created_at: extendedProduct.created_at || null,
    description: extendedProduct.description || null,
    seller_id: extendedProduct.seller_id || '',
    state: extendedProduct.state || null,
    isFavorited: true,
    tags: extendedProduct.tags?.map((t: { tag: { name: string } }) => ({ name: t.tag.name })) || []
  } as ProductRow;
}

function FavoritesGrid({ filters }: { filters: FilterParams }) {
  const [allProducts, setAllProducts] = useState<ProductRow[]>([]);
  const [filteredProducts, setFilteredProducts] = useState<ProductRow[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Buscar favoritos
  const fetchFavorites = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    
    try {
      const favorites = await getFavorites();
      
      if (!favorites) {
        setError('Erro de autenticação');
        return;
      }
      
      const products: ProductRow[] = favorites
        .map(favoriteToProductRow)
        .filter((product): product is ProductRow => product !== null);
      
      setAllProducts(products);
      setFilteredProducts(products);
    } catch (err) {
      setError('Erro ao carregar favoritos');
      console.error('Erro ao buscar favoritos:', err);
    } finally {
      setIsLoading(false);
    }
  }, []);

  // Aplicar filtros localmente
  useEffect(() => {
    if (!allProducts.length) return;

    let filtered = [...allProducts];

    // Filtro por categoria
    if (filters.categories && filters.categories.length > 0) {
      filtered = filtered.filter(product => 
        filters.categories?.some((cat: string) => 
          product.category?.toLowerCase() === cat.toLowerCase()
        )
      );
    }

    // Filtro por localização (estado ou cidade)
    if (filters.state) {
      filtered = filtered.filter(product => 
        product.state?.toLowerCase().includes(filters.state?.toLowerCase() || '')
      );
    }
    
    if (filters.city) {
      filtered = filtered.filter(product => 
        product.city?.toLowerCase().includes(filters.city?.toLowerCase() || '')
      );
    }

    // Filtro por localização genérica (se ainda existe)
    if (filters.location) {
      filtered = filtered.filter(product => 
        product.city?.toLowerCase().includes(filters.location?.toLowerCase() || '') ||
        product.state?.toLowerCase().includes(filters.location?.toLowerCase() || '')
      );
    }

    // Filtro por preço
    if (filters.minPrice !== undefined && filters.minPrice > 0) {
      filtered = filtered.filter(product => product.price >= filters.minPrice!);
    }
    
    if (filters.maxPrice !== undefined && filters.maxPrice > 0) {
      filtered = filtered.filter(product => product.price <= filters.maxPrice!);
    }

    // Filtro por busca
    if (filters.search) {
      const searchTerm = filters.search.toLowerCase();
      filtered = filtered.filter(product =>
        product.title.toLowerCase().includes(searchTerm) ||
        product.description?.toLowerCase().includes(searchTerm)
      );
    }

    // Filtro por tags
    if (filters.tags && filters.tags.length > 0) {
      filtered = filtered.filter(product => 
        filters.tags?.some((filterTag: string) => 
          product.tags?.some((productTag: { name: string }) => 
            productTag.name?.toLowerCase() === filterTag.toLowerCase()
          )
        )
      );
    }

    // Filtro por data
    if (filters.dateFilter) {
      const now = new Date();
      let filterDate: Date | null = new Date();
      
      switch (filters.dateFilter) {
        case 'today':
          filterDate.setHours(0, 0, 0, 0);
          break;
        case 'week':
          filterDate.setDate(now.getDate() - 7);
          filterDate.setHours(0, 0, 0, 0);
          break;
        case 'month':
          filterDate.setMonth(now.getMonth() - 1);
          filterDate.setHours(0, 0, 0, 0);
          break;
        case '3months':
          filterDate.setMonth(now.getMonth() - 3);
          filterDate.setHours(0, 0, 0, 0);
          break;
        default:
          // Se o valor não for reconhecido, não filtrar por data
          filterDate = null;
      }
      
      if (filterDate) {
        filtered = filtered.filter(product => {
          const productDate = product.created_at ? new Date(product.created_at) : null;
          return productDate && productDate >= filterDate;
        });
      }
    }

    setFilteredProducts(filtered);
  }, [filters, allProducts]);

  useEffect(() => {
    fetchFavorites();
  }, [fetchFavorites]);

  if (error) {
    return (
      <div>
        <ResultsHeader 
          total={0}
          page={1}
          limit={12}
          isLoading={false}
        />
        <div className="col-span-full text-center py-12 text-red-400">
          {error}
        </div>
      </div>
    );
  }

  return (
    <div>
      <ResultsHeader 
        total={filteredProducts.length}
        page={1}
        limit={filteredProducts.length}
        isLoading={isLoading}
      />

      {isLoading ? (
        <div className="explore-grid justify-items-center gap-6">
          {Array.from({ length: 6 }).map((_, i) => (
            <div key={i} className="h-[395px] w-full max-w-[478px] bg-gray-200 animate-pulse rounded-[20px]"></div>
          ))}
        </div>
      ) : filteredProducts.length === 0 ? (
        <div className="col-span-full text-center py-12 text-gray-500">
          <div className="text-6xl mb-4">❤️</div>
          <h3 className="text-xl font-medium mb-2 text-white">
            {allProducts.length === 0 
              ? "Nenhum favorito encontrado" 
              : "Nenhum favorito corresponde aos filtros"
            }
          </h3>
          <p className="text-gray-400">
            {allProducts.length === 0 
              ? "Explore produtos e adicione seus favoritos para vê-los aqui." 
              : "Tente ajustar seus filtros para encontrar seus favoritos."
            }
          </p>
        </div>
      ) : (
        <div className="explore-grid justify-items-center gap-6">
          {filteredProducts.map((product: ProductRow) => (
            <div key={product.id} className="w-full">
              <CardAnuncio product={product} showFavoriteButton={true} />
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

export default function FavoritesContent() {
  const {
    filters,
    searchDebounce,
    updateFilters,
    updateSearch,
    toggleTag,
    toggleCategory,
    setPriceRange,
    setCustomPrice,
    clearFilters
  } = useLocalFilters();

  return (
    <div className="w-full px-4">
      <div className="mx-auto w-full max-w-[1744px] px-6 py-10 md:px-[40px]">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-white mb-2">Meus Favoritos</h1>
          <p className="text-gray-400">Gerencie seus produtos favoritos</p>
        </div>

        <LocalFilterBar 
          filters={filters}
          searchDebounce={searchDebounce}
          updateSearch={updateSearch}
          toggleTag={toggleTag}
        />

        <ActiveFilters 
          filters={filters}
          clearFilters={clearFilters}
          toggleTag={toggleTag}
          toggleCategory={toggleCategory}
          updateFilters={updateFilters}
        />

        <div className="flex flex-col gap-8 lg:flex-row lg:items-start">
          <div className="w-full lg:w-[380px] shrink-0">
            <LocalFilters 
              filters={filters}
              updateFilters={updateFilters}
              toggleCategory={toggleCategory}
              setPriceRange={setPriceRange}
              setCustomPrice={setCustomPrice}
            />
          </div>

          <div className="min-w-0 flex-1">
            <FavoritesGrid filters={filters} />
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/LocalFilters.tsx">
'use client';

import {
  ArrowRight,
  Circle
} from 'lucide-react';
import styles from '../filters/filter.module.css';
import { FilterSection } from '../filters/FilterSection';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

import type { FilterParams } from '../../app/(main)/explorar/actions';

interface LocalFiltersProps {
  filters: FilterParams;
  updateFilters: (filters: Partial<FilterParams>) => void;
  toggleCategory: (category: string) => void;
  setPriceRange: (range: string) => void;
  setCustomPrice: (min?: number, max?: number) => void;
}

export default function LocalFilters({
  filters,
  updateFilters,
  toggleCategory,
  setPriceRange,
  setCustomPrice
}: LocalFiltersProps) {
  const [categories, setCategories] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Buscar categorias do banco de dados
  useEffect(() => {
    async function fetchCategories() {
      const supabase = createClient();
      const { data: categoriesData } = await supabase
        .from('categories')
        .select('name')
        .order('name');
      
      setCategories(categoriesData?.map(cat => cat.name) || []);
      setIsLoading(false);
    }
    
    fetchCategories();
  }, []);
  
  // Tags de faixas de preço
  const priceTags = [
    'Até R$ 500',
    'R$ 500 - R$ 1.000',
    'R$ 1.000 - R$ 2.500',
    'R$ 2.500 - R$ 5.000',
    'R$ 5.000 - R$ 10.000',
    'Acima de R$ 10.000'
  ];

  const handleMinPriceChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value ? Number(e.target.value) : undefined;
    setCustomPrice(value, filters.maxPrice);
  };

  const handleMaxPriceChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value ? Number(e.target.value) : undefined;
    setCustomPrice(filters.minPrice, value);
  };

  const handleStateChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFilters({ state: e.target.value, page: 1 });
  };

  const handleCityChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFilters({ city: e.target.value, page: 1 });
  };

  const handleDateFilterChange = (dateFilter: string) => {
    const newFilter = filters.dateFilter === dateFilter ? '' : dateFilter;
    updateFilters({ dateFilter: newFilter, page: 1 });
  };

  if (isLoading) {
    return (
      <aside className={styles.container}>
        <h2 className={styles.title}>FILTROS</h2>
        <div className="space-y-4">
          {Array.from({ length: 4 }).map((_, i) => (
            <div key={i} className="animate-pulse">
              <div className="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
              <div className="h-16 bg-gray-200 rounded"></div>
            </div>
          ))}
        </div>
      </aside>
    );
  }

  return (
    <aside className={styles.container}>
      <h2 className={styles.title}>FILTROS</h2>

      {/* Preço */}
      <FilterSection title="Preço do produto" id="filters-price">
        <p className={styles.label}>Escolha um intervalo:</p>

        <div className={styles.priceRange}>
          <input 
            placeholder="Preço Min" 
            type="number"
            value={filters.minPrice || ''}
            onChange={handleMinPriceChange}
          />
          <button type="button" className={styles.arrow}>
            <ArrowRight size={16} />
          </button>
          <input 
            placeholder="Preço Max" 
            type="number"
            value={filters.maxPrice || ''}
            onChange={handleMaxPriceChange}
          />
        </div>

        <p className={styles.label}>Ou uma faixa específica:</p>

        <div className={styles.tags}>
          {priceTags.map((tag, i) => (
            <button 
              key={i} 
              type="button"
              className={filters.priceRange === tag ? styles.tagActive : ''}
              onClick={() => setPriceRange(tag)}
            >
              {tag}
            </button>
          ))}
        </div>
      </FilterSection>

      {/* Localização */}
      <FilterSection title="Localização do produto" id="filters-location">
        <p className={styles.label}>Escolha um estado:</p>
        <input
          className={styles.fullInput}
          placeholder="Goiás, São Paulo ..."
          value={filters.state || ''}
          onChange={handleStateChange}
        />

        <p className={styles.label}>Ou uma cidade específica:</p>
        <input
          className={styles.fullInput}
          placeholder="Goiânia, Trindade ..."
          value={filters.city || ''}
          onChange={handleCityChange}
        />
      </FilterSection>
    </aside>
  );
}
</file>

<file path="components/dashboard/MessagesModal.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { X, Mail, User, Phone, MessageSquare, ExternalLink } from "lucide-react";
import { getVendorMessages, markMessageAsRead } from "@/app/(main)/dashboard/actions";
import Link from "next/link";

interface Message {
  id: string;
  created_at: string | null;
  email: string;
  full_name: string;
  message_content: string;
  phone: string;
  product_id: string | null;
  read: boolean | null;
  vendor_id: string;
  product?: {
    title: string;
    id: string;
  } | null;
}

interface MessagesModalProps {
  isOpen: boolean;
  onClose: () => void;
  userId: string;
}

export function MessagesModal({ isOpen, onClose, userId }: MessagesModalProps) {
  const [messages, setMessages] = useState<Message[]>([]);
  const [loading, setLoading] = useState(true);
  const [markingRead, setMarkingRead] = useState<string | null>(null);

  const fetchMessages = useCallback(async () => {
    try {
      setLoading(true);
      const data = await getVendorMessages(userId);
      setMessages(data);
    } catch (error) {
      console.error('Erro ao buscar mensagens:', error);
    } finally {
      setLoading(false);
    }
  }, [userId]);

  useEffect(() => {
    if (isOpen) {
      fetchMessages();
    }
  }, [isOpen, fetchMessages]);

  const handleMarkAsRead = async (messageId: string) => {
    try {
      setMarkingRead(messageId);
      
      const result = await markMessageAsRead(messageId);
      
      // Atualizar o estado local
      setMessages(prev => prev.map(msg => 
        msg.id === messageId ? { ...msg, read: true } : msg
      ));
      
      // Forçar refresh das mensagens após update
      setTimeout(() => {
        fetchMessages();
      }, 500);
      
    } catch (error) {
      console.error('Erro ao marcar mensagem como lida:', error);
      alert('Erro ao marcar mensagem como lida. Tente novamente.');
    } finally {
      setMarkingRead(null);
    }
  };

  const formatPhone = (phone: string) => {
    const numbers = phone.replace(/\D/g, '');
    if (numbers.length === 11) {
      return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 7)}-${numbers.slice(7)}`;
    } else if (numbers.length === 10) {
      return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 6)}-${numbers.slice(6)}`;
    }
    return phone;
  };

  const unreadCount = messages.filter(msg => !msg.read).length;

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  if (!isOpen) return null;

  return (
    <div 
      className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 max-[600px]:p-2" 
      onClick={handleBackdropClick}
    >
      <div className="bg-black/40 backdrop-blur-xl rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl border border-white/10 max-[600px]:max-w-full max-[600px]:max-h-[95vh] max-[600px]:rounded-lg">
        {/* Header */}
        <div className="bg-black/30 backdrop-blur-md text-white p-6 border-b border-white/10 max-[600px]:p-4">
          <div className="flex items-center justify-between max-[600px]:flex-col max-[600px]:items-start max-[600px]:gap-3">
            <div className="flex items-center gap-3 max-[600px]:gap-2">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm max-[600px]:w-8 max-[600px]:h-8">
                <Mail className="h-5 w-5 max-[600px]:h-4 max-[600px]:w-4" />
              </div>
              <div>
                <h3 className="text-xl font-bold max-[600px]:text-lg">Mensagens Recebidas</h3>
                <p className="text-white/80 text-sm max-[600px]:text-xs">
                  {messages.length} mensagem{messages.length !== 1 ? 's' : ''} total
                  {unreadCount > 0 && ` • ${unreadCount} não lida${unreadCount !== 1 ? 's' : ''}`}
                </p>
              </div>
            </div>
            <Button 
              variant="ghost" 
              onClick={onClose} 
              className="h-8 w-8 p-0 text-white hover:bg-white/20 rounded-full max-[600px]:h-7 max-[600px]:w-7 max-[600px]:self-end max-[600px]:absolute max-[600px]:top-3 max-[600px]:right-3"
            >
              <X className="h-5 w-5 max-[600px]:h-4 max-[600px]:w-4" />
            </Button>
          </div>
        </div>

        {/* Content */}
        <div className="max-h-[calc(90vh-120px)] max-[600px]:max-h-[calc(95vh-140px)] overflow-y-auto bg-black/20 backdrop-blur-md p-6 max-[600px]:p-4">
          {loading ? (
            <div className="text-center py-20">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"></div>
              <p className="text-white/80">Carregando mensagens...</p>
            </div>
          ) : messages.length === 0 ? (
            <div className="text-center py-20 max-[600px]:py-12">
              <div className="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm max-[600px]:w-12 max-[600px]:h-12">
                <MessageSquare className="h-8 w-8 text-white/60 max-[600px]:h-6 max-[600px]:w-6" />
              </div>
              <h4 className="text-lg font-medium text-white mb-2 max-[600px]:text-base">Nenhuma mensagem</h4>
              <p className="text-white/70 max-[600px]:text-sm">Você ainda não recebeu mensagens sobre seus produtos.</p>
            </div>
          ) : (
            <div className="space-y-4 max-[600px]:space-y-3">
              {messages.map((message) => (
                <div 
                  key={message.id} 
                  className={`backdrop-blur-md rounded-xl p-6 transition-all duration-200 border max-[600px]:p-4 max-[600px]:rounded-lg ${
                    !message.read 
                      ? 'border-white/5 bg-white/5 shadow-lg' 
                      : 'border-white/20 bg-white/10 hover:bg-white/15'
                  }`}
                >
                  {/* Header da mensagem */}
                  <div className="flex items-start justify-between mb-4 max-[600px]:mb-3 max-[600px]:flex-col max-[600px]:gap-2">
                    <div className="flex items-center gap-3 max-[600px]:gap-2">
                        <div className="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center max-[600px]:w-8 max-[600px]:h-8">
                          <User className="h-5 w-5 text-white max-[600px]:h-4 max-[600px]:w-4" />
                        </div>
                        <div>
                          <h4 className="font-semibold text-white max-[600px]:text-sm">{message.full_name}</h4>
                          <div className="flex items-center gap-4 text-sm text-white/70 max-[600px]:flex-col max-[600px]:items-start max-[600px]:gap-1 max-[600px]:text-xs">
                            <span className="flex items-center gap-1">
                              <Mail className="h-3 w-3 max-[600px]:h-2 max-[600px]:w-2" />
                              {message.email}
                            </span>
                            <span className="flex items-center gap-1">
                              <Phone className="h-3 w-3 max-[600px]:h-2 max-[600px]:w-2" />
                              {formatPhone(message.phone)}
                            </span>
                          </div>
                        </div>
                      </div>
                      <div className="flex items-center gap-2 max-[600px]:w-full max-[600px]:justify-start">
                        {!message.read && (
                          <Badge variant="default" className="bg-[#ECF230]/80 text-black backdrop-blur-sm border-yellow-400/30 max-[600px]:text-xs">
                            Nova
                          </Badge>
                        )}
                        <div className="flex items-center gap-1 text-xs text-white/60 max-[600px]:text-[10px]">
                      </div>
                    </div>
                  </div>

                  {/* Produto relacionado */}
                  {message.product && (
                    <div className="mb-4 p-3 bg-black/20 backdrop-blur-sm rounded-lg border border-white/10 max-[600px]:mb-3 max-[600px]:p-2">
                      <div className="flex items-center justify-between max-[600px]:flex-col max-[600px]:items-start max-[600px]:gap-2">
                        <div>
                          <p className="text-sm font-medium text-white/80 max-[600px]:text-xs">Produto interessado:</p>
                          <p className="font-semibold text-white max-[600px]:text-sm">{message.product.title}</p>
                        </div>
                        <Link 
                          href={`/anuncio/${message.product.id}`}
                          className="flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors max-[600px]:text-xs max-[600px]:self-end"
                        >
                          Ver anúncio
                          <ExternalLink className="h-3 w-3 max-[600px]:h-2 max-[600px]:w-2" />
                        </Link>
                      </div>
                    </div>
                  )}

                  {/* Conteúdo da mensagem */}
                  <div className="mb-4 max-[600px]:mb-3">
                    <p className="text-sm font-medium text-white/80 mb-2 max-[600px]:text-xs max-[600px]:mb-1">Mensagem:</p>
                    <div className="bg-black/30 backdrop-blur-sm p-4 rounded-lg border border-white/10 max-[600px]:p-3">
                      <p className="text-white whitespace-pre-wrap max-[600px]:text-sm" style={{ wordWrap: 'break-word', overflowWrap: 'break-word', hyphens: 'auto', lineHeight: '1.5' }}>{message.message_content}</p>
                    </div>
                  </div>

                  {/* Ações */}
                  <div className="flex justify-end gap-3 max-[600px]:flex-col max-[600px]:gap-2">
                    {!message.read && (
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => handleMarkAsRead(message.id)}
                        disabled={markingRead === message.id}
                        className="text-yellow-400 border-yellow-400/50 hover:bg-yellow-400/10 backdrop-blur-sm max-[600px]:w-full max-[600px]:text-xs"
                      >
                        {markingRead === message.id ? 'Marcando...' : 'Marcar como lida'}
                      </Button>
                    )}
                    <Button
                      size="sm"
                      asChild
                      className="bg-green-600/80 hover:bg-green-700/80 backdrop-blur-sm max-[600px]:w-full max-[600px]:text-xs"
                    >
                      <Link 
                        href={`https://wa.me/55${message.phone.replace(/\D/g, '')}?text=Olá ${encodeURIComponent(message.full_name)}, recebi sua mensagem sobre ${encodeURIComponent(message.product?.title || 'o produto')}!`}
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                        Responder no WhatsApp
                      </Link>
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/ProfileCard.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { ProfilePictureUpload } from "./ProfilePictureUpload";
import { EditProfileModal } from "./EditProfileModal";
import { MessagesModal } from "./MessagesModal";
import { getUnreadMessagesCount } from "@/app/(main)/dashboard/actions";
import { Edit3, Mail } from "lucide-react";

interface ProfileCardProps {
  user: {
    id: string;
    email?: string;
  };
  profile: {
    full_name?: string | null;
    phone?: string | null;
    avatar_url?: string | null;
    role?: string | null;
  } | null;
  isSeller: boolean;
}

export function ProfileCard({ user, profile, isSeller }: ProfileCardProps) {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [isMessagesModalOpen, setIsMessagesModalOpen] = useState(false);
  const [unreadCount, setUnreadCount] = useState(0);

  const fetchUnreadCount = useCallback(async () => {
    try {
      const count = await getUnreadMessagesCount(user.id);
      setUnreadCount(count);
    } catch (error) {
      console.error('Erro ao buscar mensagens não lidas:', error);
    }
  }, [user.id]);

  useEffect(() => {
    if (isSeller) {
      fetchUnreadCount();
    }
  }, [isSeller, fetchUnreadCount]);

  const handleMessagesModalClose = () => {
    setIsMessagesModalOpen(false);
    // Atualizar contagem quando modal é fechado
    fetchUnreadCount();
  };

  const formatPhone = (phone: string | null | undefined) => {
    if (!phone) return "Não informado";
    
    // Remove tudo que não é número
    const numbers = phone.replace(/\D/g, '');
    
    // Formatar conforme o padrão brasileiro
    if (numbers.length === 11) {
      return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 7)}-${numbers.slice(7)}`;
    } else if (numbers.length === 10) {
      return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 6)}-${numbers.slice(6)}`;
    }
    
    return phone; // Retorna o original se não conseguir formatar
  };

  return (
    <>
      <Card>
        <CardHeader className="flex flex-row items-center justify-between space-y-0">
          <div>
            <CardTitle>Perfil</CardTitle>
            <CardDescription>Suas informações pessoais</CardDescription>
          </div>
          <div className="flex gap-2">
            {isSeller && (
              <Button
                variant={unreadCount > 0 ? "default" : "outline"}
                size="sm"
                onClick={() => setIsMessagesModalOpen(true)}
                className={`h-8 w-8 p-0 relative ${
                  unreadCount > 0 
                    ? 'bg-[#ECF230] hover:bg-[#dae029] text-black' 
                    : ''
                }`}
                title={`Ver mensagens${unreadCount > 0 ? ` (${unreadCount} não lidas)` : ''}`}
              >
                <Mail className="h-4 w-4" />
                {unreadCount > 0 && (
                  <Badge 
                    className="absolute -top-1 -right-1 h-4 w-4 p-0 text-[10px] bg-red-500 hover:bg-red-500 border-white border-2"
                  >
                    {unreadCount > 9 ? '9+' : unreadCount}
                  </Badge>
                )}
                <span className="sr-only">Ver mensagens</span>
              </Button>
            )}
            <Button
              variant="outline"
              size="sm"
              onClick={() => setIsModalOpen(true)}
              className="h-8 w-8 p-0"
            >
              <Edit3 className="h-4 w-4" />
              <span className="sr-only">Editar perfil</span>
            </Button>
          </div>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Profile Picture Section */}
          <div className="flex flex-col items-center">
            <ProfilePictureUpload 
              currentAvatar={profile?.avatar_url} 
              userName={profile?.full_name || user.email || 'Usuário'}
            />
          </div>
          
          <div className="space-y-4">
            <div>
              <p className="text-sm font-medium text-muted-foreground">Nome</p>
              <p className="text-lg font-medium">{profile?.full_name || 'Usuário'}</p>
            </div>
            <div>
              <p className="text-sm font-medium text-muted-foreground">Email</p>
              <p className="text-sm">{user.email || 'Email não disponível'}</p>
            </div>
            <div>
              <p className="text-sm font-medium text-muted-foreground">Telefone</p>
              <p className="text-sm">{formatPhone(profile?.phone)}</p>
            </div>
            <div>
              <p className="text-sm font-medium text-muted-foreground">Tipo de Conta</p>
              <Badge variant={isSeller ? "default" : "secondary"} className="mt-1 capitalize">
                {profile?.role || 'Comprador'}
              </Badge>
            </div>
          </div>
        </CardContent>
      </Card>

      <EditProfileModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        currentPhone={profile?.phone}
        userName={profile?.full_name || 'Usuário'}
      />
      
      <MessagesModal
        isOpen={isMessagesModalOpen}
        onClose={handleMessagesModalClose}
        userId={user.id}
      />
    </>
  );
}
</file>

<file path="components/filterbar/filterbar.module.css">
.container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  width: 100%;
  margin-bottom: 50px;
}

.tags {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.tag {
  padding: 10px 18px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  transition: 0.5s;
}

.tag:hover {
  border-color: #ECF230;
  color: #ECF230;
}

.tagActive {
  background: #ECF230 !important;
  color: #312e2e !important;
  border-color: #ECF230 !important;
}

.searchWrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  border-radius: 999px;
}

.searchInput {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  outline: none;
  color: #ffffff61;
  padding: 14px 26px;
  border-radius: 900px;
  width: 100%;
  font-size: 14px;
}

.searchButton {
  padding: 18px;
  border-radius: 100%;
  background: #ffffff;
  border: none;
  display: grid;
  place-items: center;
  cursor: pointer;
}

.searchButton svg {
  color: #000000;
}

@media (max-width: 960px) {
  .tags {
    display: none;
  }

  .container {
    margin-bottom: 24px;
  }

  .searchInput { padding: 12px 16px; }
}
</file>

<file path="components/forms/form-cadastro.tsx">
"use client";

import { cn } from "@/lib/utils";
import { signUp } from "@/app/auth/actions";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import Link from "next/link";
import Image from "next/image";
import React, { useState } from "react";

export function FormCadastro({
  className,
  ...props
}: React.ComponentPropsWithoutRef<"div">) {
  const [role, setRole] = useState<"comprador" | "vendedor">("comprador");
  const [isPending, setIsPending] = useState(false);
  
  const [state, formAction] = React.useActionState(async (prevState: { error: string | null }, formData: FormData) => {
    try {
      await signUp(formData);
      return { error: null };
    } catch (error) {
      return { error: error instanceof Error ? error.message : "Ocorreu um erro" };
    }
  }, { error: null });

  return (
    <div className={cn("flex flex-col gap-6", className)} {...props}>
      <Card>
        <CardHeader>
          <div className="flex justify-center mb-2">
            <Image
              src="/logo.svg"
              alt="DROPTECH"
              width={200}
              height={29}
              priority
              className="h-[29px] w-auto"
            />
          </div>
          <CardDescription className="text-center">Crie uma nova conta</CardDescription>
        </CardHeader>
        <CardContent>
          <form action={formAction} onSubmit={() => setIsPending(true)}>
            <div className="flex flex-col gap-6">
              <input type="hidden" name="role" value={role} />
              <div className="grid gap-2">
                <Label>Eu quero:</Label>
                <div className="flex gap-2 p-1 bg-muted rounded-lg border">
                  <Button
                    type="button"
                    variant={role === "comprador" ? "default" : "ghost"}
                    className="flex-1"
                    onClick={() => setRole("comprador")}
                  >
                    Comprar
                  </Button>
                  <Button
                    type="button"
                    variant={role === "vendedor" ? "default" : "ghost"}
                    className="flex-1"
                    onClick={() => setRole("vendedor")}
                  >
                    Vender
                  </Button>
                </div>
              </div>
              <div className="grid gap-2">
                <Label htmlFor="email">Nome Completo</Label>
                <Input
                  id="nome"
                  name="fullName"
                  type="text"
                  placeholder="João da Silva Alves"
                  required
                />
              </div>
              <div className="grid gap-2">
                <Label htmlFor="email">Email</Label>
                <Input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="seumelhoremail@hotmail.com"
                  required
                />
              </div>
              <div className="grid gap-2">
                <div className="flex items-center">
                  <Label htmlFor="password">Senha</Label>
                </div>
                <Input
                  id="password"
                  name="password"
                  type="password"
                  required
                />
              </div>
              <div className="grid gap-2">
                <div className="flex items-center">
                  <Label htmlFor="repeat-password">Repita a Senha</Label>
                </div>
                <Input
                  id="repeat-password"
                  name="repeatPassword"
                  type="password"
                  required
                />
              </div>
              {state.error && <p className="text-sm text-red-500">{state.error}</p>}
              <Button 
                type="submit" 
                className="w-full bg-[#ecf230] text-[#312e2e] hover:bg-[#ecf230]/90" 
                disabled={isPending}
              >
                {isPending ? "Criando..." : "Cadastrar"}
              </Button>
            </div>
            <div className="mt-4 text-center text-sm">
              Já tem uma conta?{" "}
              <Link href="/auth/login" className="underline underline-offset-4">
                Entrar
              </Link>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="components/forms/form-login.tsx">
"use client";

import { cn } from "@/lib/utils";
import { signIn } from "@/app/auth/actions";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import Link from "next/link";
import Image from "next/image";
import { useState, useActionState } from "react";
import { useRouter } from "next/navigation";

export function FormLogin({
  className,
  ...props
}: React.ComponentPropsWithoutRef<"div">) {
  const router = useRouter();
  const [isPending, setIsPending] = useState(false);
  const [state, formAction] = useActionState(
    async (prevState: { error: string | null }, formData: FormData) => {
      try {
        const result = await signIn(formData);
        if (result && result.success) {
          // Redireciona no cliente após login
          router.replace("/");
        }
        return { error: null };
      } catch (error: any) {
        return { error: error instanceof Error ? error.message : "Ocorreu um erro" };
      }
    },
    { error: null }
  );

  // Reset isPending quando houver erro
  if (isPending && state.error) {
    setIsPending(false);
  }

  return (
    <div className={cn("flex flex-col gap-6", className)} {...props}>
      <Card>
        <CardHeader>
          <div className="flex justify-center mb-2">
            <Image
              src="/logo.svg"
              alt="DROPTECH"
              width={200}
              height={29}
              priority
              className="h-[29px] w-auto"
            />
          </div>
          <CardDescription className="text-center">
            Digite seu email abaixo para entrar na sua conta
          </CardDescription>
        </CardHeader>
        <CardContent>
          <form action={formAction} onSubmit={() => setIsPending(true)}>
            <div className="flex flex-col gap-6">
              <div className="grid gap-2">
                <Label htmlFor="email">Email</Label>
                <Input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="m@example.com"
                  required
                />
              </div>
              <div className="grid gap-2">
                <div className="flex items-center">
                  <Label htmlFor="password">Senha</Label>
                  <Link
                    href="/auth/esqueci-senha"
                    className="ml-auto inline-block text-sm underline-offset-4 hover:underline hide-below-700"
                  >
                    Esqueceu sua senha?
                  </Link>
                </div>
                <Input
                  id="password"
                  name="password"
                  type="password"
                  required
                />
              </div>
              {state.error && <p className="text-sm text-red-500">{state.error}</p>}
              <Button 
                type="submit" 
                className="w-full bg-[#ecf230] text-[#312e2e] hover:bg-[#ecf230]/90" 
                disabled={isPending}
              >
                {isPending ? "Entrando..." : "Entrar"}
              </Button>
            </div>
            <div className="mt-4 text-center text-sm">
              Não tem uma conta?{" "}
              <Link
                href="/auth/cadastro"
                className="underline underline-offset-4"
              >
                Cadastre-se
              </Link>
            </div>
            <div className="mt-2 text-center text-sm show-below-700">
              <Link
                href="/auth/esqueci-senha"
                className="inline-block text-sm underline-offset-4 hover:underline"
              >
                Esqueceu sua senha?
              </Link>
            </div>
            <div className="mt-2 text-center text-sm">
              <Link
                href="/"
                className="text-muted-foreground hover:text-primary underline-offset-4 hover:underline"
              >
                Voltar para a home
              </Link>
            </div>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="components/forms/MultiStepAdForm.tsx">
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { StepBasicInfo } from "@/components/forms/steps/StepBasicInfo";
import { StepCategoryTags } from "@/components/forms/steps/StepCategoryTags";
import { StepPhotos } from "@/components/forms/steps/StepPhotos";
import { StepContactReview } from "@/components/forms/steps/StepContactReview";
import { createAdWithDetails, updateAdWithDetails } from "@/app/(main)/dashboard/anunciar/actions";
import { createBrowserSupabaseClient } from "@/lib/supabase/browser";

export interface AdFormData {
  title: string;
  price: number;
  description: string;
  contact_phone: string;
  address: string;
  city: string;
  state: string;
  category_id: string;
  tag_ids: string[];
  images: File[];
  imageUrls: string[];
}

interface FormError {
  field: string;
  message: string;
}

interface ExistingProduct {
  id: string;
  title?: string;
  price?: number;
  description?: string;
  contact_phone?: string;
  address?: string;
  city?: string;
  state?: string;
  products_categories?: Array<{
    category: {
      id: string;
    };
  }>;
  products_tags?: Array<{
    tag: {
      id: string;
    };
  }>;
  images_urls?: string[];
}

interface MultiStepAdFormProps {
  existingProduct?: ExistingProduct;
  isEditing?: boolean;
}

export function MultiStepAdForm({ existingProduct, isEditing = false }: MultiStepAdFormProps) {
  const [currentStep, setCurrentStep] = useState(0);
  
  // Inicializar formData com dados existentes se estiver editando
  const [formData, setFormData] = useState<AdFormData>(() => {
    if (isEditing && existingProduct) {
      return {
        title: existingProduct.title || "",
        price: existingProduct.price || 0,
        description: existingProduct.description || "",
        contact_phone: existingProduct.contact_phone || "",
        address: existingProduct.address || "",
        city: existingProduct.city || "",
        state: existingProduct.state || "",
        category_id: existingProduct.products_categories?.[0]?.category?.id || "",
        tag_ids: existingProduct.products_tags?.map((pt: { tag: { id: string } }) => pt.tag.id) || [],
        images: [],
        imageUrls: existingProduct.images_urls || []
      };
    }
    return {
      title: "",
      price: 0,
      description: "",
      contact_phone: "",
      address: "",
      city: "",
      state: "",
      category_id: "",
      tag_ids: [],
      images: [],
      imageUrls: []
    };
  });
  const [errors, setErrors] = useState<FormError[]>([]);
  const [isLoading, setIsLoading] = useState(false);

  const steps = [
    { title: "Informações Básicas", component: StepBasicInfo },
    { title: "Categoria e Tags", component: StepCategoryTags },
    { title: "Fotos", component: StepPhotos },
    { title: "Contato e Revisão", component: StepContactReview }
  ];

  const progress = ((currentStep + 1) / steps.length) * 100;

  const validateStep = (step: number): FormError[] => {
    const stepErrors: FormError[] = [];

    switch (step) {
      case 0: // Informações Básicas
        if (!formData.title.trim()) {
          stepErrors.push({ field: "title", message: "Título é obrigatório" });
        }
        if (formData.price <= 0) {
          stepErrors.push({ field: "price", message: "Preço deve ser maior que zero" });
        }
        if (!formData.description.trim()) {
          stepErrors.push({ field: "description", message: "Descrição é obrigatória" });
        }
        break;

      case 1: // Categoria e Tags
        if (!formData.category_id) {
          stepErrors.push({ field: "category_id", message: "Categoria é obrigatória" });
        }
        break;

      case 2: // Fotos
        const totalImages = formData.images.length + formData.imageUrls.length;
        if (totalImages < 3) {
          stepErrors.push({ field: "images", message: "Mínimo de 3 fotos é obrigatório" });
        }
        break;

      case 3: // Contato e Revisão
        if (!formData.contact_phone.trim()) {
          stepErrors.push({ field: "contact_phone", message: "Telefone de contato é obrigatório" });
        }
        if (!formData.address.trim()) {
          stepErrors.push({ field: "address", message: "Endereço é obrigatório" });
        }
        if (!formData.city.trim()) {
          stepErrors.push({ field: "city", message: "Cidade é obrigatória" });
        }
        if (!formData.state.trim()) {
          stepErrors.push({ field: "state", message: "Estado é obrigatório" });
        }
        break;
    }

    return stepErrors;
  };

  const nextStep = () => {
    const stepErrors = validateStep(currentStep);
    setErrors(stepErrors);

    if (stepErrors.length === 0 && currentStep < steps.length - 1) {
      setCurrentStep(currentStep + 1);
    }
  };

  const prevStep = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  const updateFormData = (updates: Partial<AdFormData>) => {
    setFormData(prev => ({ ...prev, ...updates }));
  };

  const handleSubmit = async () => {
    const stepErrors = validateStep(currentStep);
    setErrors(stepErrors);

    if (stepErrors.length > 0) return;

    setIsLoading(true);
    try {
      let imageUrls = formData.imageUrls || [];
      // Se houver arquivos novos para upload
      if (formData.images && formData.images.length > 0) {
        const supabase = createBrowserSupabaseClient();
        const user = (await supabase.auth.getUser()).data.user;
        if (!user) throw new Error("Usuário não autenticado");
        imageUrls = [];
        for (let i = 0; i < formData.images.length; i++) {
          const file = formData.images[i];
          const fileExt = file.name.split('.').pop();
          const fileName = `${Date.now()}-${i}.${fileExt}`;
          const filePath = `products/${user.id}/${fileName}`;
          const { error: uploadError } = await supabase.storage
            .from('products')
            .upload(filePath, file, {
              cacheControl: '3600',
              upsert: false
            });
          if (uploadError) {
            throw new Error(`Erro no upload da imagem ${i + 1}: ${uploadError.message}`);
          }
          const { data: urlData } = supabase.storage
            .from('products')
            .getPublicUrl(filePath);
          imageUrls.push(urlData.publicUrl);
        }
      }
      if (isEditing && existingProduct) {
        await updateAdWithDetails(existingProduct.id, { ...formData, imageUrls, images: [] });
      } else {
        await createAdWithDetails({ ...formData, imageUrls, images: [] });
      }
    } catch (error) {
      console.error(`Erro ao ${isEditing ? 'atualizar' : 'criar'} anúncio:`, error);
      setErrors([{ field: "general", message: `Erro ao ${isEditing ? 'atualizar' : 'criar'} anúncio. Tente novamente.` }]);
    } finally {
      setIsLoading(false);
    }
  };

  const CurrentStepComponent = steps[currentStep].component;

  const slideVariants = {
    enter: (direction: number) => ({
      x: direction > 0 ? 300 : -300,
      opacity: 0
    }),
    center: {
      zIndex: 1,
      x: 0,
      opacity: 1
    },
    exit: (direction: number) => ({
      zIndex: 0,
      x: direction < 0 ? 300 : -300,
      opacity: 0
    })
  };

  return (
    <div className="w-full max-w-4xl mx-auto space-y-8 max-[1024px]:space-y-6 max-[768px]:space-y-5 max-[480px]:space-y-4">
      {/* Progress Bar */}
      <div className="space-y-4 max-[768px]:space-y-3 max-[480px]:space-y-3">
        <div className="flex justify-between text-sm text-muted-foreground max-[1024px]:text-xs max-[800px]:text-sm max-[600px]:gap-2 max-[480px]:grid max-[480px]:grid-cols-2 max-[480px]:gap-x-4 max-[480px]:gap-y-2">
          {steps.map((step, index) => (
            <span 
              key={index}
              className={`font-medium text-center flex-1 leading-tight max-[800px]:whitespace-normal max-[800px]:break-words max-[480px]:text-xs ${
                index <= currentStep ? 'text-primary' : ''
              }`}
            >
              {step.title}
            </span>
          ))}
        </div>
        <Progress value={progress} className="h-2 max-[480px]:h-1.5" />
      </div>

      {/* Step Content with Animation */}
      <div className="relative overflow-hidden max-[480px]:overflow-visible">
        <AnimatePresence mode="wait" custom={currentStep}>
          <motion.div
            key={currentStep}
            custom={currentStep}
            variants={slideVariants}
            initial="enter"
            animate="center"
            exit="exit"
            transition={{
              x: { type: "spring", stiffness: 300, damping: 30 },
              opacity: { duration: 0.2 }
            }}
            className="w-full"
          >
            <CurrentStepComponent
              formData={formData}
              updateFormData={updateFormData}
              errors={errors.filter(e => e.field !== 'general')}
            />
          </motion.div>
        </AnimatePresence>
      </div>

      {/* General Error */}
      {errors.some(e => e.field === 'general') && (
        <div className="text-sm text-red-600 bg-red-50 p-3 rounded-md max-[768px]:text-xs max-[768px]:p-2 max-[480px]:text-[10px]">
          {errors.find(e => e.field === 'general')?.message}
        </div>
      )}

      {/* Navigation Buttons */}
      <div className="flex justify-between max-[480px]:flex-col max-[480px]:gap-3">
        <Button
          type="button"
          variant="outline"
          onClick={prevStep}
          disabled={currentStep === 0}
          className="flex items-center gap-2 max-[768px]:text-sm max-[768px]:px-4 max-[480px]:w-full max-[480px]:justify-center"
        >
          <ChevronLeft className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
          Voltar
        </Button>

        {currentStep < steps.length - 1 ? (
          <Button
            type="button"
            onClick={nextStep}
            className="flex items-center gap-2 max-[768px]:text-sm max-[768px]:px-4 max-[480px]:w-full max-[480px]:justify-center"
          >
            Próximo
            <ChevronRight className="h-4 w-4 max-[768px]:h-3 max-[768px]:w-3" />
          </Button>
        ) : (
          <Button
            type="button"
            onClick={handleSubmit}
            disabled={isLoading}
            className="flex items-center gap-2 max-[768px]:text-sm max-[768px]:px-4 max-[480px]:w-full max-[480px]:justify-center"
          >
            {isLoading 
              ? (isEditing ? "Atualizando..." : "Publicando...")
              : (isEditing ? "Atualizar Anúncio" : "Publicar Anúncio")
            }
          </Button>
        )}
      </div>
    </div>
  );
}
</file>

<file path="components/forms/steps/StepContactReview.tsx">
"use client";

import { useState, useEffect } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import { Separator } from "@/components/ui/separator";
import { Phone, Eye, Tag, Package, FileImage, MapPin } from "lucide-react";
import Image from "next/image";
import { createClient } from "@/lib/supabase/client";
import type { AdFormData } from "@/components/forms/MultiStepAdForm";

interface StepContactReviewProps {
  formData: AdFormData;
  updateFormData: (updates: Partial<AdFormData>) => void;
  errors: Array<{ field: string; message: string }>;
}

export function StepContactReview({ formData, updateFormData, errors }: StepContactReviewProps) {
  const [categoryName, setCategoryName] = useState<string>("");
  const [tagNames, setTagNames] = useState<string[]>([]);

  const getError = (field: string) => errors.find(e => e.field === field)?.message;

  // Buscar nomes da categoria e tags
  useEffect(() => {
    async function fetchNames() {
      const supabase = createClient();

      // Buscar categoria
      if (formData.category_id) {
        const { data: category } = await supabase
          .from('categories')
          .select('name')
          .eq('id', formData.category_id)
          .maybeSingle();
        setCategoryName(category?.name || "");
      }

      // Buscar tags
      if (formData.tag_ids && formData.tag_ids.length > 0) {
        const { data: tags } = await supabase
          .from('tags')
          .select('name')
          .in('id', formData.tag_ids);
        setTagNames(tags?.map(t => t.name) || []);
      }
    }

    fetchNames();
  }, [formData.category_id, formData.tag_ids]);

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(price);
  };

  const formatPhone = (phone: string) => {
    const numbers = phone.replace(/\D/g, '');
    if (numbers.length === 11) {
      return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 7)}-${numbers.slice(7)}`;
    }
    return phone;
  };

  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>Contato, Localização e Revisão Final</CardTitle>
        <CardDescription>
          Adicione informações de contato e localização, depois revise tudo antes de publicar
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-8 max-[480px]:space-y-6 max-[480px]:p-4">
        {/* Contato */}
        <div className="space-y-4">
          <div className="flex items-center gap-2">
            <Phone className="h-5 w-5 text-primary" />
            <Label htmlFor="contact_phone">WhatsApp para Contato *</Label>
          </div>
          
          <Input
            id="contact_phone"
            placeholder="(11) 99999-9999"
            value={formData.contact_phone}
            onChange={(e) => updateFormData({ contact_phone: e.target.value })}
            className={getError('contact_phone') ? 'border-red-500' : ''}
          />
          {getError('contact_phone') && (
            <p className="text-sm text-red-600">{getError('contact_phone')}</p>
          )}
          <p className="text-xs text-muted-foreground">
            Os interessados entrarão em contato diretamente com você
          </p>
        </div>

        {/* Endereço */}
        <div className="space-y-4">
          <div className="flex items-center gap-2">
            <MapPin className="h-5 w-5 text-primary" />
            <Label>Localização do Produto *</Label>
          </div>

          <div className="space-y-3">
            <div className="space-y-2">
              <Label htmlFor="address">Endereço</Label>
              <Input
                id="address"
                placeholder="Rua, número, bairro"
                value={formData.address}
                onChange={(e) => updateFormData({ address: e.target.value })}
                className={getError('address') ? 'border-red-500' : ''}
              />
              {getError('address') && (
                <p className="text-sm text-red-600">{getError('address')}</p>
              )}
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="city">Cidade</Label>
                <Input
                  id="city"
                  placeholder="Ex: São Paulo"
                  value={formData.city}
                  onChange={(e) => updateFormData({ city: e.target.value })}
                  className={getError('city') ? 'border-red-500' : ''}
                />
                {getError('city') && (
                  <p className="text-sm text-red-600">{getError('city')}</p>
                )}
              </div>

              <div className="space-y-2">
                <Label htmlFor="state">Estado</Label>
                <Input
                  id="state"
                  placeholder="Ex: SP"
                  value={formData.state}
                  onChange={(e) => updateFormData({ state: e.target.value })}
                  className={getError('state') ? 'border-red-500' : ''}
                />
                {getError('state') && (
                  <p className="text-sm text-red-600">{getError('state')}</p>
                )}
              </div>
            </div>
          </div>

          <p className="text-xs text-muted-foreground">
            Essas informações ajudam compradores próximos a encontrar seu produto
          </p>
        </div>

        <Separator />

        {/* Preview do Anúncio */}
        <div className="space-y-6">
          <div className="flex items-center gap-2">
            <Eye className="h-5 w-5 text-primary" />
            <Label className="text-base font-semibold">Prévia do seu anúncio</Label>
          </div>

          {/* Card de Preview */}
          <div className="border rounded-lg overflow-hidden bg-card">
            {/* Primeira Imagem */}
            {formData.images && formData.images.length > 0 && (
              <div className="aspect-video relative">
                <Image
                  src={formData.imageUrls?.[0] || URL.createObjectURL(formData.images[0])}
                  alt="Foto principal"
                  fill
                  className="object-cover"
                />
                <div className="absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
                  +{formData.images.length - 1} fotos
                </div>
              </div>
            )}

            <div className="p-6 space-y-4">
              {/* Título e Preço */}
              <div className="space-y-2">
                <h3 className="text-xl font-bold">{formData.title || "Título do produto"}</h3>
                <p className="text-2xl font-bold text-primary">
                  {formData.price > 0 ? formatPrice(formData.price) : "R$ 0,00"}
                </p>
              </div>

              {/* Categoria e Tags */}
              <div className="space-y-3">
                {categoryName && (
                  <div className="flex items-center gap-2">
                    <Package className="h-4 w-4 text-muted-foreground" />
                    <Badge variant="outline">{categoryName}</Badge>
                  </div>
                )}

                {tagNames.length > 0 && (
                  <div className="flex items-start gap-2">
                    <Tag className="h-4 w-4 text-muted-foreground mt-0.5" />
                    <div className="flex flex-wrap gap-1">
                      {tagNames.map((tagName, index) => (
                        <Badge key={index} variant="secondary" className="text-xs">
                          {tagName}
                        </Badge>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {/* Descrição */}
              <div className="space-y-2">
                <p className="text-sm text-muted-foreground font-medium">Descrição:</p>
                <p className="text-sm leading-relaxed">
                  {formData.description || "Descrição do produto..."}
                </p>
              </div>

              {/* Contato e Localização */}
              <div className="space-y-2">
                {formData.contact_phone && (
                  <div className="flex items-center gap-2 text-sm">
                    <Phone className="h-4 w-4 text-primary" />
                    <span>WhatsApp: {formatPhone(formData.contact_phone)}</span>
                  </div>
                )}
                
                {(formData.city || formData.state) && (
                  <div className="flex items-center gap-2 text-sm">
                    <MapPin className="h-4 w-4 text-primary" />
                    <span>
                      {[formData.city, formData.state].filter(Boolean).join(", ") || "Localização não informada"}
                    </span>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Resumo das Fotos */}
          {formData.images && formData.images.length > 0 && (
            <div className="space-y-3">
              <div className="flex items-center gap-2">
                <FileImage className="h-4 w-4 text-primary" />
                <span className="text-sm font-medium">
                  {formData.images.length} fotos adicionadas
                </span>
              </div>
              <div className="grid grid-cols-6 md:grid-cols-8 gap-2">
                {formData.images.slice(0, 8).map((file, index) => (
                  <div key={index} className="aspect-square rounded border overflow-hidden bg-gray-50">
                    <Image
                      src={formData.imageUrls?.[index] || URL.createObjectURL(file)}
                      alt={`Foto ${index + 1}`}
                      width={60}
                      height={60}
                      className="w-full h-full object-cover"
                    />
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Informações importantes */}
          <div className="bg-muted p-4 rounded-lg space-y-2">
            <p className="text-sm font-medium">ℹ️ Informações importantes:</p>
            <ul className="text-xs text-muted-foreground space-y-1">
              <li>• Seu anúncio será enviado para moderação antes da publicação</li>
              <li>• Mantenha seu WhatsApp atualizado para receber contatos</li>
              <li>• A localização ajuda compradores próximos a encontrar seu produto</li>
            </ul>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="components/forms/steps/StepPhotos.tsx">
"use client";

import { useState, useCallback } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { Button } from "@/components/ui/button";
import { Upload, X, Image as ImageIcon } from "lucide-react";
import Image from "next/image";
import type { AdFormData } from "@/components/forms/MultiStepAdForm";

interface StepPhotosProps {
  formData: AdFormData;
  updateFormData: (updates: Partial<AdFormData>) => void;
  errors: Array<{ field: string; message: string }>;
}

export function StepPhotos({ formData, updateFormData, errors }: StepPhotosProps) {
  const [dragActive, setDragActive] = useState(false);
  const [draggedIndex, setDraggedIndex] = useState<number | null>(null);
  const [dragOverIndex, setDragOverIndex] = useState<number | null>(null);

  const getError = (field: string) => errors.find(e => e.field === field)?.message;

  const handleFiles = useCallback(async (files: FileList | null) => {
    if (!files || files.length === 0) return;

    const validFiles: File[] = [];
    const maxFiles = 8;
    const maxSize = 10 * 1024 * 1024; // 10MB
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      
      // Validações
      if (!allowedTypes.includes(file.type)) {
        alert(`Arquivo ${file.name}: Tipo não suportado. Use JPEG, PNG ou WebP.`);
        continue;
      }
      
      if (file.size > maxSize) {
        alert(`Arquivo ${file.name}: Muito grande. Máximo 10MB.`);
        continue;
      }

      validFiles.push(file);
    }

    const currentImages = formData.images || [];
    const currentUrls = formData.imageUrls || [];
    const totalCurrentImages = currentUrls.length;
    const newImages = [...currentImages];
    const newImageUrls = [...currentUrls];

    for (const file of validFiles) {
      if (newImageUrls.length >= maxFiles) {
        alert(`Máximo de ${maxFiles} fotos permitidas`);
        break;
      }

      newImages.push(file);
      
      // Criar URL de preview
      const previewUrl = URL.createObjectURL(file);
      newImageUrls.push(previewUrl);
    }

    updateFormData({
      images: newImages,
      imageUrls: newImageUrls
    });
  }, [formData, updateFormData]);

  const removeImage = (index: number) => {
    const newImages = [...(formData.images || [])];
    const newImageUrls = [...(formData.imageUrls || [])];

    // Se for uma URL blob, revogar para liberar memória
    if (newImageUrls[index] && newImageUrls[index].startsWith('blob:')) {
      URL.revokeObjectURL(newImageUrls[index]);
    }

    // Remover da posição correspondente em ambas as arrays
    if (index < newImageUrls.length) {
      newImageUrls.splice(index, 1);
    }
    if (index < newImages.length) {
      newImages.splice(index, 1);
    }

    updateFormData({
      images: newImages,
      imageUrls: newImageUrls
    });
  };

  const reorderImages = (fromIndex: number, toIndex: number) => {
    const newImages = [...(formData.images || [])];
    const newImageUrls = [...(formData.imageUrls || [])];

    // Mover URLs
    if (fromIndex < newImageUrls.length && toIndex < newImageUrls.length) {
      const [movedUrl] = newImageUrls.splice(fromIndex, 1);
      newImageUrls.splice(toIndex, 0, movedUrl);
    }
    
    // Mover arquivos (se existirem)
    if (fromIndex < newImages.length && toIndex < newImages.length) {
      const [movedImage] = newImages.splice(fromIndex, 1);
      newImages.splice(toIndex, 0, movedImage);
    }

    updateFormData({
      images: newImages,
      imageUrls: newImageUrls
    });
  };

  const handleImageDragStart = (e: React.DragEvent, index: number) => {
    e.dataTransfer.effectAllowed = 'move';
    setDraggedIndex(index);
  };

  const handleImageDragOver = (e: React.DragEvent, index: number) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    setDragOverIndex(index);
  };

  const handleImageDragLeave = () => {
    setDragOverIndex(null);
  };

  const handleImageDrop = (e: React.DragEvent, dropIndex: number) => {
    e.preventDefault();
    
    if (draggedIndex !== null && draggedIndex !== dropIndex) {
      reorderImages(draggedIndex, dropIndex);
    }
    
    setDraggedIndex(null);
    setDragOverIndex(null);
  };

  const handleImageDragEnd = () => {
    setDraggedIndex(null);
    setDragOverIndex(null);
  };

  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);

    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      handleFiles(e.dataTransfer.files);
    }
  }, [handleFiles]);

  const handleDrag = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    if (e.type === "dragenter" || e.type === "dragover") {
      setDragActive(true);
    } else if (e.type === "dragleave") {
      setDragActive(false);
    }
  }, []);

  const onButtonClick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.multiple = true;
    input.accept = 'image/jpeg,image/jpg,image/png,image/webp';
    input.onchange = (e: Event) => {
      const target = e.target as HTMLInputElement;
      handleFiles(target.files);
    };
    input.click();
  };

  const images = formData.images || [];
  const imageUrls = formData.imageUrls || [];
  const minRequired = 3;
  
  // Combinar imagens existentes (URLs) e novas imagens (Files) para visualização
  const allImages = imageUrls.map((url, index) => ({
    type: 'url',
    src: url,
    name: `Imagem ${index + 1}`,
    file: images[index] || null
  }));
  
  // Total de imagens para validação
  const totalImages = allImages.length;

  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>Fotos do Produto</CardTitle>
        <CardDescription>
          Adicione pelo menos {minRequired} fotos de boa qualidade. A primeira será a foto principal.
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-6 max-[480px]:space-y-4 max-[480px]:p-4">
        {/* Upload Area */}
        <div
          className={`relative border-2 border-dashed rounded-lg p-8 text-center transition-colors ${
            dragActive 
              ? 'border-primary bg-primary/5' 
              : getError('images') 
                ? 'border-red-300' 
                : 'border-gray-300 hover:border-gray-400'
          }`}
          onDragEnter={handleDrag}
          onDragLeave={handleDrag}
          onDragOver={handleDrag}
          onDrop={handleDrop}
        >
          <div className="space-y-4">
            <div className="flex justify-center">
              <Upload className={`h-12 w-12 ${dragActive ? 'text-primary' : 'text-gray-400'}`} />
            </div>
            <div>
              <p className="text-lg font-medium">
                {dragActive ? 'Solte as imagens aqui' : 'Arraste suas fotos aqui'}
              </p>
              <p className="text-sm text-muted-foreground mt-2">
                ou
              </p>
              <Button 
                type="button" 
                variant="outline" 
                className="mt-3"
                onClick={onButtonClick}
              >
                <ImageIcon className="h-4 w-4 mr-2" />
                Escolher Arquivos
              </Button>
            </div>
            <div className="text-xs text-muted-foreground space-y-1">
              <p>Formatos aceitos: JPEG, PNG, WebP</p>
              <p>Tamanho máximo: 10MB por foto</p>
              <p>Máximo: 8 fotos</p>
            </div>
          </div>
        </div>

        {/* Error Message */}
        {getError('images') && (
          <p className="text-sm text-red-600">{getError('images')}</p>
        )}

        {/* Progress Indicator */}
        <div className="flex items-center justify-between text-sm">
          <span className={totalImages >= minRequired ? 'text-green-600' : 'text-muted-foreground'}>
            {totalImages} de {minRequired} fotos obrigatórias
          </span>
          <span className="text-muted-foreground">
            {totalImages}/8 fotos
          </span>
        </div>

        {/* Image Preview Grid */}
        {totalImages > 0 && (
          <div className="space-y-4">
            <Label>Prévia das Fotos</Label>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {allImages.map((image, index) => (
                <div 
                  key={index} 
                  className={`relative group cursor-move ${
                    draggedIndex === index ? 'opacity-50 scale-95' : ''
                  } ${
                    dragOverIndex === index ? 'ring-2 ring-primary ring-offset-2' : ''
                  }`}
                  draggable
                  onDragStart={(e) => handleImageDragStart(e, index)}
                  onDragOver={(e) => handleImageDragOver(e, index)}
                  onDragLeave={handleImageDragLeave}
                  onDrop={(e) => handleImageDrop(e, index)}
                  onDragEnd={handleImageDragEnd}
                >
                  <div className="aspect-square rounded-lg border-2 border-gray-200 overflow-hidden bg-gray-50">
                    <Image
                      src={image.src}
                      alt={`Preview ${index + 1}`}
                      className="w-full h-full object-cover"
                      width={200}
                      height={200}
                    />
                  </div>
                  
                  {/* Primary Badge */}
                  {index === 0 && (
                    <div className="absolute top-2 left-2 bg-primary text-primary-foreground text-xs px-2 py-1 rounded z-10">
                      Principal
                    </div>
                  )}

                  {/* Drag Handle Indicator */}
                  <div className="absolute top-2 left-1/2 transform -translate-x-1/2 bg-black/50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity z-10">
                    ⋮⋮
                  </div>

                  {/* Remove Button */}
                  <Button
                    variant="destructive"
                    size="sm"
                    className="absolute top-2 right-2 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity z-10"
                    onClick={() => removeImage(index)}
                  >
                    <X className="h-3 w-3" />
                  </Button>

                  {/* File Info */}
                  <div className="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity">
                    {image.name}
                  </div>
                </div>
              ))}
            </div>
            
            {totalImages > 0 && (
              <p className="text-xs text-muted-foreground">
                🐆 Dica: Arraste as fotos para reordenar. A primeira foto será a principal.
              </p>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="components/sections/por-que/index.tsx">
import Image from "next/image";
import Link from "next/link";
import styles from "./secao-por-que.module.css";
import { cn } from "@/lib/utils";

export function SecaoPorQue() {
  return (
    <section className={cn("relative w-full overflow-hidden", styles.section)}>
      {/* Decorative D */}
      <Image
        src="/figma/decor-d.svg"
        alt=""
        width={1007}
        height={976}
        className="pointer-events-none absolute right-[-100px] top-20 w-[180px] opacity-50 md:right-[-140px] md:top-[26px] md:bottom-auto md:w-[1007px]"
        aria-hidden
      />

      <div className="mx-auto flex w-full max-w-[1800px] flex-col gap-[48px] px-4 py-12 pb-6 sm:px-6 md:gap-[80px] md:px-[44px] md:py-[100px] md:pb-[120px]">
        {/* Header */}
        <div className="flex w-full max-w-[1093px] flex-col justify-center gap-[13px]">
          <div className="w-fit">
            <div className={styles.kicker}>sem burocracia</div>
          </div>

          <h2 className={cn("text-white font-medium", styles.title)}>
            Por que anunciar ou comprar na DropTech?
          </h2>

          <p className={cn("text-white font-normal", styles.subtitle)}>
            Um marketplace feito para quem vive de tecnologia. Mais visibilidade
            para quem anuncia, mais confiança para quem compra.
          </p>
        </div>

        {/* Content */}
        <div className="relative flex w-full items-stretch gap-[57px]">
          <div
            className={cn(
              "relative flex w-full flex-col gap-10 px-4 pb-6 pt-8 sm:px-6 md:px-6 md:pt-10",
              styles.greenPanel
            )}
          >
            {/* Illustration */}
            <Image
              src="/figma/por-que-illustration.png"
              alt=""
              width={1225}
              height={891}
              className={cn(
                "pointer-events-none absolute right-0 bottom-0 w-[220px] md:right-0 md:top-[-260px] md:bottom-auto md:w-[1040px] max-w-none",
                styles.illustration
              )}
              aria-hidden
            />

            <div className={cn("relative flex flex-col items-center gap-8 md:flex-row md:gap-[72px]", styles.content)}>
              {/* Glass cards */}
              <div className={cn("flex flex-col items-center justify-center p-10", styles.glassCard)}>
                <Image src="/figma/icon-users-three.svg" alt="" width={81} height={81} aria-hidden />
                <div className="mt-6 whitespace-pre-line">
                  <div className={styles.glassTitle}>{"Público\nqualificado"}</div>
                </div>
              </div>

              <div className={cn("flex flex-col items-center justify-center p-10", styles.glassCard)}>
                <Image src="/figma/icon-cpu.svg" alt="" width={78} height={78} aria-hidden />
                <div className="mt-6 whitespace-pre-line">
                  <div className={styles.glassTitle}>{"Nada genérico\nSó tecnologia"}</div>
                </div>
              </div>
            </div>

            <Link
              href="/explorar"
              className={cn(
                "inline-flex items-center justify-center font-medium hover:brightness-95 transition",
                "w-full md:w-[817px]",
                styles.cta
              )}
            >
              Explorar Ofertas
            </Link>
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="components/sections/por-que/secao-por-que.module.css">
.section {
  background-color: #0f0f0f;
  background-image:
    linear-gradient(180deg, rgba(15, 15, 15, 1) 0%, rgba(15, 15, 15, 0) 100%),
    linear-gradient(180deg, rgba(15, 15, 15, 0) 0%, rgba(15, 15, 15, 1) 100%),
    radial-gradient(circle at 80% 9%, rgba(0, 0, 0, 0) 0%, rgba(236, 242, 48, 1) 100%);
}

.illustration {
  /* Ajustes finos de tamanho/posição podem ser feitos aqui */
}

.content {

}

.kicker {
  background: rgba(236, 242, 48, 0.06);
  border: 1px solid rgba(236, 242, 48, 0.08);
  border-radius: 41px;
  padding: 8px 54px;
  font-size: 22px;
  line-height: 1.5em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.61);
}

.title {
  font-size: 73px;
  line-height: 1.095890411em;
  text-wrap: balance;
}

.subtitle {
  font-size: 30px;
  line-height: 1.2333333333em;
  text-wrap: balance;
}

.greenPanel {
  border-radius: 20px;
  background: linear-gradient(90deg, rgba(0, 255, 178, 1) 0%, rgba(0, 153, 107, 1) 100%);
}

.glassCard {
  width: 298.17px;
  height: 298.17px;
  border-radius: 22px;
  background: rgba(255, 255, 255, 0.4);
  border: 1px solid rgba(255, 255, 255, 0.45);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
}

.glassTitle {
  font-family: var(--font-bebas-neue, var(--font-poppins)), sans-serif;
  font-weight: 400;
  font-size: 37px;
  line-height: 1em;
  color: #0f0f0f;
  text-align: center;
}

.cta {
  width: 817px;
  height: 88px;
  border-radius: 20px;
  background: #ecf230;
  color: #312e2e;
  font-size: 27px;
  line-height: 0.7037037037em;
}

@media (max-width: 1524px) {
  .kicker {
    font-size: 20px;
    padding: 6px 40px;
  }

  .title { font-size: 40px; }
  .subtitle { font-size: 22px; }

  .glassCard { width: 260px; height: 260px; }
  .glassTitle { font-size: 30px; }

  .cta { width: 100%; height: 72px; font-size: 24px; }

  .illustration {
    width: 800px;
    bottom: 0;
    right: 0;
    top: auto;
  }
}

@media (max-width: 1224px) {
  .kicker {
    font-size: 18px;
    padding: 6px 40px;
  }

  .title { font-size: 32px; }
  .subtitle { font-size: 20px; }

  .glassCard { width: 260px; height: 260px; }
  .glassTitle { font-size: 30px; }

  .cta { width: 100%; height: 72px; font-size: 24px; }

  .illustration {
    display: none;
  }
}

@media (max-width: 768px) {
  .kicker {
    font-size: 16px;
    padding: 6px 28px;
    margin-left: auto;
    margin-right: auto;
  }

  .title { font-size: 36px;  }
  .subtitle { font-size: 20px;  }

  .illustration {
    display: block;
    width: 480px;
    right: 0;
    bottom: 0;
  }

  .content {
    display: none;
  }

  .greenPanel {
    min-height: 420px;
  }

}

@media (max-width: 480px) {
  .kicker {
    font-size: 14px;
    padding: 6px 18px;
  }

  .title { font-size: 24px; }
  .subtitle { font-size: 16px; }

  .glassCard { width: 180px; height: 180px; border-radius: 16px; }
  .glassTitle { font-size: 20px; }

  .cta { height: 56px; font-size: 18px; }

  .illustration {
    width: 480px;
    right: 0;
    bottom: 0;
  }

  .content {
    display: none;
  }

  .greenPanel {
    min-height: 420px;
  }
}
</file>

<file path="components/sections/semelhantes/semelhantes.module.css">
.section {
  background-color: #0f0f0f;
  background-image:
    linear-gradient(180deg, rgba(15, 15, 15, 1) 0%, rgba(15, 15, 15, 0) 68%),
    linear-gradient(180deg, rgba(15, 15, 15, 0) 0%, rgba(15, 15, 15, 1) 100%),
    radial-gradient(circle at 41% 12%, rgba(0, 0, 0, 0) 0%, rgba(0, 255, 178, 0.6) 100%);
}

.kicker {
  background: rgba(236, 242, 48, 0.06);
  border: 1px solid rgba(236, 242, 48, 0.08);
  border-radius: 41px;
  padding: 8px 54px;
  font-size: 22px;
  line-height: 1.5em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.61);
}

.title {
  font-size: 56px;
  line-height: 1.0714285714em;
  text-wrap: balance;
}

.subtitle {
  font-size: 30px;
  text-wrap: balance;
  line-height: 1.1em;
}

.tickerWrap {
  width: 100vw;
  position: relative;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  overflow: hidden;
  padding: 0 16px 60px 16px;
}

.tickerTrack {
  display: flex;
  align-items: center;
  width: max-content;
  animation: droptech-marquee var(--marquee-duration, 80s) linear infinite;
  will-change: transform;
  gap: 40px;
}

.tickerGroup {
  display: flex;
  align-items: center;
  gap: 40px;
}

.tickerItem {
  flex: 0 0 auto;
  width: min(478px, 92vw);
}

@keyframes droptech-marquee {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(-50%, 0, 0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .tickerTrack {
    animation: none;
  }
}

@media (max-width: 1524px) {

  .section {
    padding-bottom: 5em;
  }
  
  .kicker {
    font-size: 20px;
    padding: 6px 40px;
  }

  .title { font-size: 40px; }
  .subtitle { font-size: 22px; }

  .tickerTrack { gap: 26px; }
  .tickerGroup { gap: 26px; }

  .tickerItem { width: min(360px, 92vw); }
}

@media (max-width: 1224px) {

  .kicker {
    font-size: 18px;
    padding: 6px 40px;
  }

  .title { font-size: 32px; }
  .subtitle { font-size: 20px; }

  .tickerItem { width: min(320px, 92vw); }
}

@media (max-width: 768px) {
  .kicker {
    font-size: 16px;
    padding: 6px 28px;
  }

  .title { font-size: 28px; }
  .subtitle { font-size: 18px; }

  .tickerWrap {
    padding-bottom: 20px;
  }
}

@media (max-width: 480px) {
  .kicker {
    font-size: 12px;
    padding: 4px 14px;
  }
  
  .title { font-size: 20px; }
  .subtitle { font-size: 14px; }
}
</file>

<file path="proxy.ts">
import { createServerClient } from "@supabase/ssr";
import { NextResponse, type NextRequest } from "next/server";
import { Database } from "@/src/types/supabase";

export async function proxy(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          response = NextResponse.next({
            request,
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            response.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  // Refresh session if expired - required for Server Components
  const {
    data: { user },
  } = await supabase.auth.getUser();

  const path = request.nextUrl.pathname;

  // Protect /dashboard/** routes
  if (path.startsWith("/dashboard")) {
    if (!user) {
      return NextResponse.redirect(new URL("/auth/login", request.url));
    }
  }

  // Protect /admin/** routes
  if (path.startsWith("/admin")) {
    if (!user) {
      return NextResponse.redirect(new URL("/auth/login", request.url));
    }

    // Check for admin role
    const { data: profile } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", user.id)
      .single();

    if (profile?.role !== "admin") {
      // Redirect to home if not admin
      return NextResponse.redirect(new URL("/", request.url));
    }
  }

  return response;
}

export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * Feel free to modify this pattern to include more paths.
     */
    "/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)",
  ],
};
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";
import tailwindcssAnimate from "tailwindcss-animate";

export default ({
  darkMode: ["class"],
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        chart: {
          "1": "hsl(var(--chart-1))",
          "2": "hsl(var(--chart-2))",
          "3": "hsl(var(--chart-3))",
          "4": "hsl(var(--chart-4))",
          "5": "hsl(var(--chart-5))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      fontFamily: {
        sans: ["var(--font-poppins)", "sans-serif"],
      },
    },
  },
  plugins: [tailwindcssAnimate],
}) satisfies Config;
</file>

<file path="app/(main)/dashboard/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { redirect } from "next/navigation";
import { revalidatePath } from "next/cache";

export async function getDashboardData() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    redirect("/auth/login");
  }

  const { data: profile } = await supabase
    .from("profiles")
    .select("*")
    .eq("id", user.id)
    .maybeSingle();

  return { user, profile };
}

export async function uploadProfilePicture(formData: FormData) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("Usuário não autenticado");
  }

  const file = formData.get('file') as File;
  if (!file) {
    throw new Error("Nenhum arquivo selecionado");
  }

  // Validar tipo de arquivo
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
  if (!allowedTypes.includes(file.type)) {
    throw new Error("Tipo de arquivo não suportado. Use JPEG, PNG ou WebP");
  }

  // Validar tamanho (máximo 5MB)
  if (file.size > 5 * 1024 * 1024) {
    throw new Error("Arquivo muito grande. Máximo 5MB");
  }

  try {
    // Deletar foto anterior se existir
    const { data: profile } = await supabase
      .from("profiles")
      .select("avatar_url")
      .eq("id", user.id)
      .maybeSingle();

    if (profile?.avatar_url) {
      // Extrair nome do arquivo da URL
      const oldFileName = profile.avatar_url.split('/').pop();
      if (oldFileName) {
        await supabase.storage
          .from('avatars')
          .remove([`${user.id}/${oldFileName}`]);
      }
    }

    // Upload nova foto
    const fileExt = file.name.split('.').pop();
    const fileName = `${Date.now()}.${fileExt}`;
    const filePath = `${user.id}/${fileName}`;

    const { error: uploadError } = await supabase.storage
      .from('avatars')
      .upload(filePath, file, {
        cacheControl: '3600',
        upsert: false
      });

    if (uploadError) {
      throw new Error(`Erro no upload: ${uploadError.message}`);
    }

    // Obter URL pública
    const { data: urlData } = supabase.storage
      .from('avatars')
      .getPublicUrl(filePath);

    // Atualizar perfil com nova URL
    const { error: updateError } = await supabase
      .from("profiles")
      .update({ avatar_url: urlData.publicUrl })
      .eq("id", user.id);

    if (updateError) {
      throw new Error(`Erro ao atualizar perfil: ${updateError.message}`);
    }

    revalidatePath("/dashboard");
    
    return { success: true, avatar_url: urlData.publicUrl };
    
  } catch (error) {
    console.error('Erro no upload:', error);
    throw error;
  }
}

export async function deleteProfilePicture() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("Usuário não autenticado");
  }

  try {
    // Buscar URL atual
    const { data: profile } = await supabase
      .from("profiles")
      .select("avatar_url")
      .eq("id", user.id)
      .maybeSingle();

    if (profile?.avatar_url) {
      // Extrair nome do arquivo da URL
      const fileName = profile.avatar_url.split('/').pop();
      if (fileName) {
        // Deletar arquivo do storage
        await supabase.storage
          .from('avatars')
          .remove([`${user.id}/${fileName}`]);
      }
    }

    // Atualizar perfil removendo a URL
    const { error: updateError } = await supabase
      .from("profiles")
      .update({ avatar_url: null })
      .eq("id", user.id);

    if (updateError) {
      throw new Error(`Erro ao remover foto: ${updateError.message}`);
    }

    revalidatePath("/dashboard");
    
    return { success: true };
    
  } catch (error) {
    console.error('Erro ao deletar foto:', error);
    throw error;
  }
}

export async function updateUserProfile(formData: FormData) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("Usuário não autenticado");
  }

  const phone = formData.get('phone') as string;
  const password = formData.get('password') as string;

  try {
    // Atualizar telefone no perfil
    if (phone !== undefined) {
      const { error: profileError } = await supabase
        .from("profiles")
        .update({ phone: phone || null })
        .eq("id", user.id);

      if (profileError) {
        throw new Error(`Erro ao atualizar telefone: ${profileError.message}`);
      }
    }

    // Atualizar senha se fornecida
    if (password && password.trim() !== '') {
      const { error: passwordError } = await supabase.auth.updateUser({
        password: password
      });

      if (passwordError) {
        throw new Error(`Erro ao atualizar senha: ${passwordError.message}`);
      }
    }

    revalidatePath("/dashboard");
    
    return { success: true };
    
  } catch (error) {
    console.error('Erro ao atualizar perfil:', error);
    throw error;
  }
}

export async function getUnreadMessagesCount(vendorId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user || user.id !== vendorId) {
    return 0;
  }

  const { count } = await supabase
    .from("messages")
    .select("*", { count: "exact", head: true })
    .eq("vendor_id", vendorId)
    .eq("read", false);

  return count || 0;
}

export async function getVendorMessages(vendorId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user || user.id !== vendorId) {
    throw new Error("Não autorizado");
  }

  const { data: messages, error } = await supabase
    .from("messages")
    .select(`
      *,
      product:products (
        id,
        title
      )
    `)
    .eq("vendor_id", vendorId)
    .order("created_at", { ascending: false });

  if (error) {
    throw new Error("Erro ao buscar mensagens");
  }

  return messages || [];
}

export async function testMessagesAccess(userId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("Usuário não autenticado");
  }

  // Testar seleção
  const { data: selectData, error: selectError } = await supabase
    .from("messages")
    .select("*")
    .eq("vendor_id", userId)
    .limit(1);

  if (selectData && selectData.length > 0) {
    const messageId = selectData[0].id;
    
    // Testar UPDATE com RLS check
    const { data: updateData, error: updateError } = await supabase
      .from("messages")
      .update({ read: true })
      .eq("id", messageId)
      .eq("vendor_id", userId)
      .select();

    // Verificar se o update funcionou
    const { data: verifyData, error: verifyError } = await supabase
      .from("messages")
      .select("read")
      .eq("id", messageId)
      .single();
  }

  return { selectData, selectError };
}

export async function markMessageAsReadDirect(messageId: string) {
  try {
    const supabase = await createClient();
    const { data: userData, error: userError } = await supabase.auth.getUser();
    
    if (userError || !userData.user) {
      throw new Error('Usuário não autenticado');
    }
    
    const userId = userData.user.id;

    // 1. Tentar usar a nova função RPC
    try {
      const { data: rpcData, error: rpcError } = await supabase
        .rpc('mark_message_read', { 
          message_id: messageId, 
          user_id: userId 
        });
        
      if (!rpcError && rpcData === true) {
        revalidatePath("/dashboard");
        return { success: true, method: 'rpc', updated: true };
      }
      
      if (!rpcError && rpcData === false) {
        throw new Error('Mensagem não encontrada ou você não tem permissão');
      }
    } catch (rpcErr) {
    }

    // 2. Fallback: tentar update direto com auth bypass
    
    const { data: updateData, error: updateError } = await supabase
      .from('messages')
      .update({ 
        read: true, 
        updated_at: new Date().toISOString() 
      })
      .eq('id', messageId)
      .eq('vendor_id', userId)
      .select();

    if (updateError) {
      throw updateError;
    }

    if (updateData && updateData.length > 0) {
      revalidatePath("/dashboard");
      return { success: true, method: 'direct', updated: true };
    }

    // 3. Se chegou aqui, não conseguiu fazer o update
    throw new Error('Não foi possível marcar a mensagem como lida. Verifique as permissões RLS no banco de dados.');
    
  } catch (error) {
    console.error('Erro em todas as tentativas:', error);
    throw error;
  }
}

export async function markMessageAsRead(messageId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("Usuário não autenticado");
  }

  // Primeiro, vamos buscar a mensagem para verificar o estado atual
  const { data: currentMessage, error: fetchError } = await supabase
    .from("messages")
    .select("*")
    .eq("id", messageId)
    .single();

  if (fetchError) {
    console.error('Erro ao buscar mensagem:', fetchError);
    throw new Error(`Erro ao buscar mensagem: ${fetchError.message}`);
  }

  if (!currentMessage) {
    throw new Error("Mensagem não encontrada");
  }

  // Verificar se a mensagem pertence ao usuário
  if (currentMessage.vendor_id !== user.id) {
    throw new Error("Não autorizado");
  }

  // Se já está marcada como lida, não precisa atualizar
  if (currentMessage.read === true) {
    return { success: true, alreadyRead: true, data: currentMessage };
  }

  // Tentar atualizar com diferentes abordagens

  // Primeira tentativa - update normal
  const { data: updateData, error: updateError } = await supabase
    .from("messages")
    .update({ read: true })
    .eq("id", messageId)
    .eq("vendor_id", user.id) // Adicionar verificação dupla de segurança
    .select();

  if (updateError) {
    console.error('Erro no update normal:', updateError);
    
    // Segunda tentativa - usando RPC se disponível ou update mais simples
    try {
      const { data: simpleUpdate, error: simpleError } = await supabase
        .from("messages")
        .update({ read: true })
        .match({ id: messageId, vendor_id: user.id })
        .select();

      if (simpleError) {
        console.error('Erro no update simples também:', simpleError);
        throw new Error(`Erro ao atualizar mensagem: ${updateError.message} / ${simpleError.message}`);
      }

      revalidatePath("/dashboard");
      return { success: true, data: simpleUpdate };
      
    } catch (fallbackError) {
      console.error('Todos os métodos de update falharam:', fallbackError);
      throw new Error(`Falha completa no update: ${updateError.message}`);
    }
  }

  // Verificar se realmente foi atualizado
  const { data: verificationData } = await supabase
    .from("messages")
    .select("read")
    .eq("id", messageId)
    .single();

  revalidatePath("/dashboard");
  return { success: true, data: updateData, verification: verificationData };
}
</file>

<file path="app/(main)/dashboard/anunciar/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { redirect } from "next/navigation";
import type { AdFormData } from "@/components/forms/MultiStepAdForm";

export async function createAd(formData: FormData) {
  try {
    const title = formData.get("title") as string;
    const price = parseFloat(formData.get("price") as string);
    const description = formData.get("description") as string;
    const category = formData.get("category") as string;
    const contact_phone = formData.get("contact_phone") as string;
    const image_url = formData.get("image_url") as string;

    const supabase = await createClient();
    const { data: { user } } = await supabase.auth.getUser();

    if (!user) {
      console.error("createAd: unauthenticated user");
      throw new Error("Unauthorized");
    }

    const { error } = await supabase.from("products").insert({
      title,
      price,
      description,
      category,
      contact_phone,
      seller_id: user.id,
      images_urls: image_url ? [image_url] : [],
      status: "pendente",
    });

    if (error) {
      console.error("createAd error:", error);
      throw new Error("Failed to create ad");
    }
  } catch (error) {
    console.error("createAd error:", error);
    throw error;
  }
}

// Criação de anúncio com objeto tipado (AdFormData)
export async function createAdWithDetails(formData: {
  title: string;
  price: number;
  description: string;
  contact_phone: string;
  address: string;
  city: string;
  state: string;
  category_id: string;
  tag_ids: string[];
  imageUrls: string[];
}) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error("Usuário não autenticado");
  try {
    // 1. Criar o produto
    const { data: product, error: productError } = await supabase
      .from("products")
      .insert({
        title: formData.title,
        price: formData.price,
        description: formData.description,
        contact_phone: formData.contact_phone,
        address: formData.address,
        city: formData.city,
        state: formData.state,
        seller_id: user.id,
        images_urls: formData.imageUrls,
        status: "pendente",
      })
      .select()
      .single();
    if (productError) {
      throw new Error(`Erro ao criar produto: ${productError.message}`);
    }
    // 2. Associar categoria (se fornecida)
    if (formData.category_id && product) {
      const { error: categoryError } = await supabase
        .from("products_categories")
        .insert({
          product_id: product.id,
          category_id: formData.category_id
        });
      if (categoryError) {
        console.error("Erro ao associar categoria:", categoryError);
      }
    }
    // 3. Associar tags (se fornecidas)
    if (formData.tag_ids && formData.tag_ids.length > 0 && product) {
      const tagInserts = formData.tag_ids.map(tagId => ({
        product_id: product.id,
        tag_id: tagId
      }));
      const { error: tagsError } = await supabase
        .from("products_tags")
        .insert(tagInserts);
      if (tagsError) {
        console.error("Erro ao associar tags:", tagsError);
      }
    }
    return { success: true };
  } catch (error) {
    console.error("Erro ao criar anúncio:", error);
    throw error;
  }
}

export async function updateAdWithDetails(productId: string, formData: AdFormData) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) throw new Error("Usuário não autenticado");

  try {
    // Para edição: combinar URLs existentes com novas imagens
    const existingUrls = formData.imageUrls?.filter(url => 
      url && (url.startsWith('http://') || url.startsWith('https://'))
    ) || [];
    
    // Upload de novas imagens (Files reais) - Pular se não há arquivos novos
    const newImageUrls: string[] = [];
    
    if (formData.images && formData.images.length > 0) {
      // Filtrar apenas Files reais e que não sejam URLs
      const realNewFiles = formData.images.filter(file => {
        // Verificar se é um File real e não um objeto URL
        return file instanceof File && 
               file.size > 0 && 
               file.lastModified > 0 &&
               typeof file.name === 'string' &&
               !file.name.startsWith('http');
      });

      // Se realmente há arquivos novos para upload
      if (realNewFiles.length > 0) {
        // Por enquanto, vamos simplesmente pular o upload de novas imagens na edição
        // e permitir apenas a edição dos outros dados
      }
    }

    // Combinar URLs existentes com novas
    const allImageUrls = [...existingUrls, ...newImageUrls];

    // Atualizar o produto
    const { data: product, error: productError } = await supabase
      .from("products")
      .update({
        title: formData.title,
        description: formData.description,
        price: formData.price,
        contact_phone: formData.contact_phone,
        address: formData.address,
        city: formData.city,
        state: formData.state,
        images_urls: allImageUrls
      })
      .eq('id', productId)
      .eq('seller_id', user.id)
      .select()
      .single();

    if (productError) {
      console.error("Erro ao atualizar produto:", productError);
      throw new Error(`Erro ao atualizar produto: ${productError.message}`);
    }

    // Atualizar categoria (remover antigas e inserir nova)
    if (formData.category_id && product) {
      // Remover associação anterior
      const { error: deleteError } = await supabase
        .from("products_categories")
        .delete()
        .eq('product_id', product.id);

      if (deleteError) {
        console.error("Erro ao remover categoria antiga:", deleteError);
      }

      // Inserir nova associação
      const { error: categoryError } = await supabase
        .from("products_categories")
        .insert({
          product_id: product.id,
          category_id: formData.category_id
        });

      if (categoryError) {
        console.error("Erro ao atualizar categoria:", categoryError);
      }
    }

    // 5. Atualizar tags (remover antigas e inserir novas)
    if (product) {
      // Remover associações anteriores
      await supabase
        .from("products_tags")
        .delete()
        .eq('product_id', product.id);

      // Inserir novas associações (se fornecidas)
      if (formData.tag_ids && formData.tag_ids.length > 0) {
        const tagInserts = formData.tag_ids.map(tagId => ({
          product_id: product.id,
          tag_id: tagId
        }));

        const { error: tagsError } = await supabase
          .from("products_tags")
          .insert(tagInserts);

        if (tagsError) {
          console.error("Erro ao atualizar tags:", tagsError);
        }
      }
    }

  } catch (error) {
    console.error("Erro ao atualizar anúncio:", error);
    throw error;
  }

  // Redirect fora do try/catch
  redirect("/dashboard/meus-anuncios");
}
</file>

<file path="app/(main)/dashboard/meus-anuncios/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { revalidatePath } from "next/cache";

export async function getMeusAnuncios() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) return null;

  const { data: products } = await supabase
    .from("products")
    .select(`
      *,
      tags:products_tags(
        tag:tags(name)
      )
    `)
    .eq("seller_id", user.id)
    .order("created_at", { ascending: false });

  // Transformar a estrutura de tags e garantir que todos os campos necessários estão presentes
  return products?.map(product => ({
    ...product,
    tags: product.tags?.map((t: any) => ({ name: t.tag.name })) || [],
    // Garantir que campos de localização existem para filtragem
    city: product.city || '',
    state: product.state || '',
    category: product.category || '',
    description: product.description || ''
  })) || [];
}

export async function deleteAd(productId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) throw new Error("Unauthorized");

  const { error } = await supabase
    .from("products")
    .delete()
    .eq("id", productId)
    .eq("seller_id", user.id);

  if (error) {
    console.error("Error deleting product:", error);
    throw new Error("Failed to delete product");
  }

  revalidatePath("/dashboard/meus-anuncios");
}

export async function updateAd(productId: string, formData: FormData) {
  const title = formData.get("title") as string;
  const price = parseFloat(formData.get("price") as string);
  const description = formData.get("description") as string;
  const category = formData.get("category") as string;
  const contact_phone = formData.get("contact_phone") as string;
  const image_url = formData.get("image_url") as string;

  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) throw new Error("Unauthorized");

  const { error } = await supabase
    .from("products")
    .update({
      title,
      price,
      description,
      category,
      contact_phone,
      images_urls: image_url ? [image_url] : [],
      status: "pendente",
    })
    .eq("id", productId)
    .eq("seller_id", user.id);

  if (error) {
    console.error("Error updating product:", error);
    throw new Error("Failed to update product");
  }

  revalidatePath("/dashboard/meus-anuncios");
}

export async function getMyAds() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) return [];

  const { data: products } = await supabase
    .from("products")
    .select("*")
    .eq("seller_id", user.id)
    .order("created_at", { ascending: false });

  return products || [];
}
</file>

<file path="app/(main)/explorar/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";

export interface FilterParams {
  search?: string;
  tags?: string[];
  categories?: string[];
  minPrice?: number;
  maxPrice?: number;
  priceRange?: string;
  location?: string;
  city?: string;
  state?: string;
  dateFilter?: string;
  sortBy?: 'newest' | 'oldest' | 'price_asc' | 'price_desc';
  status?: string;
  page?: number;
  limit?: number;
}

export interface PaginatedResponse<T> {
  data: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasMore: boolean;
  };
}

export async function getProducts(filters: FilterParams = {}): Promise<PaginatedResponse<any>> {
  const supabase = await createClient();
  
  const page = filters.page || 1;
  const limit = filters.limit || 12;
  const offset = (page - 1) * limit;
  
  let query = supabase
    .from("products")
    .select(`
      *,
      seller:profiles!seller_id (
        full_name,
        avatar_url
      ),
      tags:products_tags(
        tag:tags(
          name
        )
      )
    `, { count: 'exact' })
    .eq("status", "aprovado");

  // Filtro por busca (título)
  if (filters.search) {
    query = query.ilike("title", `%${filters.search}%`);
  }

  // Filtro por tags - primeiro buscar os IDs das tags
  if (filters.tags && filters.tags.length > 0) {
    const { data: tagIds } = await supabase
      .from('tags')
      .select('id')
      .in('name', filters.tags);
      
    if (tagIds && tagIds.length > 0) {
      const { data: productIds } = await supabase
        .from('products_tags')
        .select('product_id')
        .in('tag_id', tagIds.map(tag => tag.id));
        
      if (productIds && productIds.length > 0) {
        query = query.in('id', productIds.map(p => p.product_id));
      } else {
        // Se não encontrou produtos com as tags, retornar vazio
        return {
          data: [],
          pagination: {
            page,
            limit,
            total: 0,
            totalPages: 0,
            hasMore: false
          }
        };
      }
    }
  }

  // Filtro por categorias - primeiro buscar os IDs das categorias
  if (filters.categories && filters.categories.length > 0) {
    const { data: categoryIds } = await supabase
      .from('categories')
      .select('id')
      .in('name', filters.categories);
      
    if (categoryIds && categoryIds.length > 0) {
      const { data: productIds } = await supabase
        .from('products_categories')
        .select('product_id')
        .in('category_id', categoryIds.map(cat => cat.id));
        
      if (productIds && productIds.length > 0) {
        query = query.in('id', productIds.map(p => p.product_id));
      } else {
        // Se não encontrou produtos com as categorias, retornar vazio
        return {
          data: [],
          pagination: {
            page,
            limit,
            total: 0,
            totalPages: 0,
            hasMore: false
          }
        };
      }
    }
  }

  // Filtros de preço
  if (filters.priceRange) {
    const ranges: Record<string, { min?: number; max?: number }> = {
      'Até R$ 500': { max: 500 },
      'R$ 500 - R$ 1.000': { min: 500, max: 1000 },
      'R$ 1.000 - R$ 2.500': { min: 1000, max: 2500 },
      'R$ 2.500 - R$ 5.000': { min: 2500, max: 5000 },
      'R$ 5.000 - R$ 10.000': { min: 5000, max: 10000 },
      'Acima de R$ 10.000': { min: 10000 }
    };
    
    const range = ranges[filters.priceRange];
    if (range) {
      if (range.min) query = query.gte("price", range.min);
      if (range.max) query = query.lte("price", range.max);
    }
  } else {
    // Filtros de preço customizados
    if (filters.minPrice) {
      query = query.gte("price", filters.minPrice);
    }
    if (filters.maxPrice) {
      query = query.lte("price", filters.maxPrice);
    }
  }

  // Filtros de localização
  if (filters.location) {
    query = query.or(`city.ilike.%${filters.location}%,state.ilike.%${filters.location}%`);
  }
  if (filters.city) {
    query = query.ilike("city", `%${filters.city}%`);
  }
  if (filters.state) {
    query = query.ilike("state", `%${filters.state}%`);
  }

  // Filtro por data
  if (filters.dateFilter) {
    const now = new Date();
    let dateThreshold: Date;
    
    switch (filters.dateFilter) {
      case 'Última Semana':
        dateThreshold = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        break;
      case 'Último Mês':
        dateThreshold = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        break;
      case 'Último Trimestre':
        dateThreshold = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
        break;
      default:
        dateThreshold = new Date(0);
    }
    
    query = query.gte("created_at", dateThreshold.toISOString());
  }

  // Ordenação
  switch (filters.sortBy) {
    case 'oldest':
      query = query.order("created_at", { ascending: true });
      break;
    case 'price_asc':
      query = query.order("price", { ascending: true });
      break;
    case 'price_desc':
      query = query.order("price", { ascending: false });
      break;
    case 'newest':
    default:
      query = query.order("created_at", { ascending: false });
      break;
  }

  // Paginação
  query = query.range(offset, offset + limit - 1);

  const { data: products, count, error } = await query;
  
  if (error) {
    console.error('Erro ao buscar produtos:', error);
    return {
      data: [],
      pagination: {
        page,
        limit,
        total: 0,
        totalPages: 0,
        hasMore: false
      }
    };
  }

  // Transformar os dados para o formato esperado
  const transformedProducts = products?.map(product => ({
    ...product,
    tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
  })) || [];

  const total = count || 0;
  const totalPages = Math.ceil(total / limit);

  return {
    data: transformedProducts,
    pagination: {
      page,
      limit,
      total,
      totalPages,
      hasMore: page < totalPages
    }
  };
}

export async function getCategories() {
  const supabase = await createClient();
  
  const { data: categories } = await supabase
    .from("categories")
    .select("*")
    .order("name");

  return categories;
}
</file>

<file path="app/auth/alterar-senha/page.tsx">
import { FormAtualizarSenha } from "@/components/forms/form-atualizar-senha";

export default function Page() {
  return (
    <div className="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
      <div className="w-full max-w-md">
        <FormAtualizarSenha />
      </div>
    </div>
  );
}
</file>

<file path="app/auth/cadastro/page.tsx">
import { FormCadastro } from "@/components/forms/form-cadastro";

export default function CadastroPage() {
  return (
    <div className="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
      <div className="w-full max-w-md">
        <FormCadastro />
      </div>
    </div>
  );
}
</file>

<file path="app/auth/esqueci-senha/page.tsx">
import { FormEsqueciSenha } from "@/components/forms/form-esqueci-senha";

export default function Page() {
  return (
    <div className="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
      <div className="w-full max-w-md">
        <FormEsqueciSenha />
      </div>
    </div>
  );
}
</file>

<file path="app/auth/login/page.tsx">
import { FormLogin } from "@/components/forms/form-login";

export default function Page() {
  return (
    <div className="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
      <div className="w-full max-w-md">
        <FormLogin />
      </div>
    </div>
  );
}
</file>

<file path="components/dashboard/MeusAnunciosContent.tsx">
'use client';

import { useEffect, useState, useCallback } from "react";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio";
import { ResultsHeader } from "@/components/filters/ResultsHeader";
import { useLocalFilters } from "@/lib/hooks/useLocalFilters";
import { getMeusAnuncios } from "../../app/(main)/dashboard/meus-anuncios/actions";
import LocalFilterBar from "@/components/dashboard/LocalFilterBar";
import LocalFilters from "@/components/dashboard/LocalFilters";
import { ActiveFilters } from "@/components/dashboard/ActiveFilters";
import Link from "next/link";
import { Plus } from "lucide-react";import type { FilterParams } from '../../app/(main)/explorar/actions';
function MeusAnunciosGrid({ filters }: { filters: FilterParams }) {
  const [allProducts, setAllProducts] = useState<ProductRow[]>([]);
  const [filteredProducts, setFilteredProducts] = useState<ProductRow[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Buscar meus anúncios
  const fetchMeusAnuncios = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    
    try {
      const products = await getMeusAnuncios();
      
      if (!products) {
        setError('Erro de autenticação');
        return;
      }
      
      setAllProducts(products);
      setFilteredProducts(products);
    } catch (err) {
      setError('Erro ao carregar anúncios');
      console.error('Erro ao buscar anúncios:', err);
    } finally {
      setIsLoading(false);
    }
  }, []);

  // Aplicar filtros localmente
  useEffect(() => {
    if (!allProducts.length) return;
    
    let filtered = [...allProducts];

    // Filtro por categoria
    if (filters.categories && filters.categories.length > 0) {
      filtered = filtered.filter(product => 
        filters.categories?.some((cat: string) => 
          product.category?.toLowerCase() === cat.toLowerCase()
        )
      );
    }

    // Filtro por localização (estado ou cidade)
    if (filters.state) {
      filtered = filtered.filter(product => 
        product.state?.toLowerCase().includes(filters.state?.toLowerCase() || '')
      );
    }
    
    if (filters.city) {
      filtered = filtered.filter(product => 
        product.city?.toLowerCase().includes(filters.city?.toLowerCase() || '')
      );
    }

    // Filtro por localização genérica (se ainda existe)
    if (filters.location) {
      filtered = filtered.filter(product => 
        product.city?.toLowerCase().includes(filters.location?.toLowerCase() || '') ||
        product.state?.toLowerCase().includes(filters.location?.toLowerCase() || '')
      );
    }

    // Filtro por preço
    if (filters.minPrice !== undefined && filters.minPrice > 0) {
      filtered = filtered.filter(product => product.price >= filters.minPrice!);
    }
    
    if (filters.maxPrice !== undefined && filters.maxPrice > 0) {
      filtered = filtered.filter(product => product.price <= filters.maxPrice!);
    }

    // Filtro por busca
    if (filters.search) {
      const searchTerm = filters.search.toLowerCase();
      filtered = filtered.filter(product =>
        product.title.toLowerCase().includes(searchTerm) ||
        product.description?.toLowerCase().includes(searchTerm)
      );
    }

    // Filtro por tags
    if (filters.tags && filters.tags.length > 0) {
      filtered = filtered.filter(product => 
        filters.tags?.some((filterTag: string) => 
          product.tags?.some((productTag: { name?: string }) => 
            productTag.name?.toLowerCase() === filterTag.toLowerCase()
          )
        )
      );
    }

    // Filtro por data
    if (filters.dateFilter) {
      // Aplicar filtro de data se fornecido
      const now = new Date();
      let filterDate: Date | null = new Date();
      
      switch (filters.dateFilter) {
        case 'today':
          filterDate.setHours(0, 0, 0, 0);
          break;
        case 'week':
          filterDate.setDate(now.getDate() - 7);
          filterDate.setHours(0, 0, 0, 0);
          break;
        case 'month':
          filterDate.setMonth(now.getMonth() - 1);
          filterDate.setHours(0, 0, 0, 0);
          break;
        case '3months':
          filterDate.setMonth(now.getMonth() - 3);
          filterDate.setHours(0, 0, 0, 0);
          break;
        default:
          // Se o valor não for reconhecido, não filtrar por data
          filterDate = null;
      }
      
      if (filterDate) {
        // Filtrar produtos pela data
        const beforeFilter = filtered.length;
        filtered = filtered.filter(product => {
          const productDate = product.created_at ? new Date(product.created_at) : null;
          const isValid = productDate && productDate >= filterDate;
          return isValid;
        });
        
      }
    }

    setFilteredProducts(filtered);
  }, [filters, allProducts]);

  useEffect(() => {
    fetchMeusAnuncios();
  }, [fetchMeusAnuncios]);

  if (error) {
    return (
      <div>
        <ResultsHeader 
          total={0}
          page={1}
          limit={12}
          isLoading={false}
        />
        <div className="col-span-full text-center py-12 text-red-400">
          {error}
        </div>
      </div>
    );
  }

  return (
    <div>
      <ResultsHeader 
        total={filteredProducts.length}
        page={1}
        limit={filteredProducts.length}
        isLoading={isLoading}
      />

      {isLoading ? (
        <div className="explore-grid justify-items-center gap-6">
          {Array.from({ length: 6 }).map((_, i) => (
            <div key={i} className="h-[395px] w-full max-w-[478px] bg-gray-200 animate-pulse rounded-[20px]"></div>
          ))}
        </div>
      ) : filteredProducts.length === 0 ? (
        <div className="col-span-full text-center py-12 text-gray-500">
          <div className="text-6xl mb-4">📦</div>
          <h3 className="text-xl font-medium mb-2 text-white">
            {allProducts.length === 0 
              ? "Nenhum anúncio encontrado" 
              : "Nenhum anúncio corresponde aos filtros"
            }
          </h3>
          <p className="text-gray-400 mb-6">
            {allProducts.length === 0 
              ? "Crie seu primeiro anúncio para começar a vender." 
              : "Tente ajustar seus filtros para encontrar seus anúncios."
            }
          </p>
          {allProducts.length === 0 && (
            <Link 
              href="/dashboard/anunciar"
              className="inline-flex items-center gap-2 bg-[#ecf230] hover:bg-[#ecf230]/90 text-black font-medium px-6 py-3 rounded-lg transition-colors"
            >
              <Plus className="h-5 w-5" />
              Criar Anúncio
            </Link>
          )}
        </div>
      ) : (
        <div className="explore-grid justify-items-center gap-6">
          {filteredProducts.map((product: ProductRow) => (
            <div key={product.id} className="w-full">
              <CardAnuncio product={product} showFavoriteButton={false} />
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

export default function MeusAnunciosContent() {
  const {
    filters,
    searchDebounce,
    updateFilters,
    updateSearch,
    toggleTag,
    toggleCategory,
    setPriceRange,
    setCustomPrice,
    clearFilters
  } = useLocalFilters();

  return (
    <div className="w-full px-4">
      <div className="mx-auto w-full max-w-[1744px] px-6 py-10 md:px-[40px]">
        <div className="mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between lg:flex-row lg:items-center lg:justify-between max-[599px]:flex-col max-[599px]:items-start max-[599px]:gap-4">
          <div>
            <h1 className="text-3xl font-bold text-white mb-2">Meus Anúncios</h1>
            <p className="text-gray-400">Gerencie seus produtos anunciados</p>
          </div>
          <Link 
            href="/dashboard/anunciar"
            className="inline-flex items-center gap-2 bg-[#ecf230] hover:bg-[#ecf230]/90 text-black font-medium px-6 py-3 rounded-lg transition-colors self-start sm:self-auto lg:self-auto max-[599px]:self-start max-[599px]:mt-2"
          >
            <Plus className="h-5 w-5" />
            Novo Anúncio
          </Link>
        </div>

      <LocalFilterBar 
        filters={filters}
        searchDebounce={searchDebounce}
        updateSearch={updateSearch}
        toggleTag={toggleTag}
      />

      <ActiveFilters 
        filters={filters}
        clearFilters={clearFilters}
        toggleTag={toggleTag}
        toggleCategory={toggleCategory}
        updateFilters={updateFilters}
      />

      <div className="flex flex-col gap-8 lg:flex-row lg:items-start">
        <div className="w-full lg:w-[380px] shrink-0">
          <LocalFilters 
            filters={filters}
            updateFilters={updateFilters}
            toggleCategory={toggleCategory}
            setPriceRange={setPriceRange}
            setCustomPrice={setCustomPrice}
          />
        </div>

        <div className="min-w-0 flex-1">
          <MeusAnunciosGrid filters={filters} />
        </div>
      </div>
      </div>
    </div>
  );
}
</file>

<file path="components/explorar/ExplorarContent.tsx">
'use client';

import { useEffect, useState, useCallback, useRef } from "react";
import { getProducts, type PaginatedResponse } from "../../app/(main)/explorar/actions";
import Filters from "@/components/filters/filters";
import FilterBar from "@/components/filterbar/filterbar";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio";
import { ResultsHeader } from "@/components/filters/ResultsHeader";
import { useFilters } from "@/lib/hooks/useFilters";

function ProductGrid() {
  const { filters } = useFilters();
  const [allProducts, setAllProducts] = useState<ProductRow[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [pagination, setPagination] = useState({
    page: 1,
    limit: 12,
    total: 0,
    totalPages: 0,
    hasMore: false
  });
  const [lastFilters, setLastFilters] = useState<typeof filters | null>(null);
  
  const observer = useRef<IntersectionObserver | null>(null);

  // Verificar se os filtros mudaram (excluindo page)
  const filtersChanged = useCallback(() => {
    if (!lastFilters) return true;
    
    const { page: _, ...currentFiltersWithoutPage } = filters;
    const { page: __, ...lastFiltersWithoutPage } = lastFilters;
    
    return JSON.stringify(currentFiltersWithoutPage) !== JSON.stringify(lastFiltersWithoutPage);
  }, [filters, lastFilters]);

  // Buscar produtos (primeira página ou quando filtros mudarem)
  const fetchProducts = useCallback(async (resetProducts = false) => {
    if (resetProducts) {
      setIsLoading(true);
      setAllProducts([]);
    }
    setError(null);
    
    try {
      const currentPage = resetProducts ? 1 : pagination.page + 1;
      const data = await getProducts({ ...filters, page: currentPage });
      
      if (resetProducts) {
        setAllProducts(data.data);
      } else {
        setAllProducts(prev => [...prev, ...data.data]);
      }
      
      setPagination({
        page: currentPage,
        limit: data.pagination.limit,
        total: data.pagination.total,
        totalPages: data.pagination.totalPages,
        hasMore: data.pagination.hasMore
      });
      
      setLastFilters(filters);
    } catch (err) {
      setError('Erro ao carregar produtos');
      console.error('Erro ao buscar produtos:', err);
    } finally {
      setIsLoading(false);
      setIsLoadingMore(false);
    }
  }, [filters]);

  // Carregar mais produtos
  const loadMore = useCallback(async () => {
    if (isLoadingMore || !pagination.hasMore) return;
    
    setIsLoadingMore(true);
    setError(null);
    
    try {
      const currentPage = pagination.page + 1;
      const data = await getProducts({ ...filters, page: currentPage });
      
      setAllProducts(prev => [...prev, ...data.data]);
      
      setPagination({
        page: currentPage,
        limit: data.pagination.limit,
        total: data.pagination.total,
        totalPages: data.pagination.totalPages,
        hasMore: data.pagination.hasMore
      });
    } catch (err) {
      setError('Erro ao carregar mais produtos');
      console.error('Erro ao buscar mais produtos:', err);
    } finally {
      setIsLoadingMore(false);
    }
  }, [isLoadingMore, pagination.hasMore, pagination.page, filters]);

  // Intersection Observer para scroll infinito
  const lastProductElementRef = useCallback((node: HTMLDivElement) => {
    if (isLoadingMore) return;
    if (observer.current) observer.current.disconnect();
    observer.current = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting && pagination.hasMore) {
        loadMore();
      }
    });
    if (node) observer.current.observe(node);
  }, [isLoadingMore, pagination.hasMore, loadMore]);

  // Buscar produtos quando filtros mudarem
  useEffect(() => {
    if (filtersChanged()) {
      fetchProducts(true);
    }
  }, [filters]);

  if (error && allProducts.length === 0) {
    return (
      <div>
        <ResultsHeader 
          total={0}
          page={pagination.page}
          limit={pagination.limit}
          isLoading={false}
        />
        <div className="col-span-full text-center py-12 text-red-400">
          {error}
        </div>
      </div>
    );
  }

  return (
    <div>
      <ResultsHeader 
        total={pagination.total}
        page={pagination.page}
        limit={pagination.limit}
        isLoading={isLoading}
      />

      {isLoading && allProducts.length === 0 ? (
        <div className="explore-grid justify-items-center gap-6">
          {Array.from({ length: 6 }).map((_, i) => (
            <div key={i} className="h-[395px] w-full max-w-[478px] bg-gray-200 animate-pulse rounded-[20px]"></div>
          ))}
        </div>
      ) : allProducts.length === 0 ? (
        <div className="col-span-full text-center py-12 text-gray-500">
          <div className="text-6xl mb-4">📦</div>
          <h3 className="text-xl font-medium mb-2 text-white">Nenhum produto encontrado</h3>
          <p className="text-gray-400">
            Tente ajustar seus filtros para encontrar mais produtos.
          </p>
        </div>
      ) : (
        <>
          <div className="explore-grid justify-items-center gap-6">
            {allProducts.map((product: ProductRow, index: number) => (
              <div
                key={`${product.id}-${index}`}
                ref={index === allProducts.length - 1 ? lastProductElementRef : null}
                className="w-full"
              >
                <CardAnuncio product={product} showFavoriteButton={true} />
              </div>
            ))}
          </div>
          
          {/* Loading indicator para scroll infinito */}
          {isLoadingMore && (
              <div className="mt-8 flex justify-center">
              <div className="explore-grid justify-items-center gap-6">
                {Array.from({ length: 3 }).map((_, i) => (
                  <div key={i} className="h-[395px] w-full max-w-[478px] bg-gray-200 animate-pulse rounded-[20px]"></div>
                ))}
              </div>
            </div>
          )}
        </>
      )}
    </div>
  );
}

export default function ExplorarContent() {
  return (
    <div className="w-full px-4">
      <div className="mx-auto w-full max-w-[1744px] px-6 py-10 md:px-[40px]">
      <FilterBar />

      <div className="flex flex-col gap-8 lg:flex-row lg:items-start">
        <div className="w-full lg:w-[380px] shrink-0">
          <Filters />
        </div>

        <div className="min-w-0 flex-1">
          <ProductGrid />
        </div>
      </div>
      </div>
    </div>
  );
}
</file>

<file path="components/filters/filter.module.css">
.container {
  width: 100%;
  max-width: 380px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 10px;
  padding: 24px;
  color: #fff;
  display: flex;
  flex-direction: column;
  gap: 22px;
}

.title {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 24px;
}

.section {
  margin-bottom: 28px;
}

.sectionHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #d6ff00;
  font-size: 18px;
  font-weight: 400;
  margin-bottom: 12px;
}

.sectionToggle {
  background: transparent;
  border: none;
  color: inherit;
  padding: 6px;
  border-radius: 10px;
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: background 0.2s ease;
}

.sectionToggle:hover {
  background: rgba(255, 255, 255, 0.06);
}

.sectionToggleIcon {
  transition: transform 0.2s ease;
}

.sectionToggleIconOpen {
  transition: transform 0.2s ease;
  transform: rotate(180deg);
}

.sectionContent {
  overflow: hidden;
  max-height: 1000px;
  opacity: 1;
  transition: max-height 0.25s ease, opacity 0.2s ease;
}

.sectionContentCollapsed {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  pointer-events: none;
  transition: max-height 0.25s ease, opacity 0.2s ease;
}

.label {
  font-size: 14px;
  color: #bcbcbc;
  margin: 10px 0;
}

.priceRange {
  display: flex;
  align-items: center;
  gap: 10px;
}

.priceRange input {
  flex: 1;
  width: 40%;
  height: 42px;
  border-radius: 10px;
  background: #2b2b2b;
  border: none;
  padding: 0 12px;
  color: #fff;
  outline: none;
}

.arrow {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  color: #2b2b2b;
  background: #fff;
  display: grid;
  place-items: center;
  cursor: pointer;
}

.fullInput {
  width: 100%;
  height: 42px;
  border-radius: 10px;
  background: #2b2b2b;
  border: none;
  padding: 0 12px;
  color: #fff;
  margin-bottom: 8px;
  outline: none;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.hideOnSmall { display: block; }

.tags button {
  padding: 10px 18px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-size: 12px;
  cursor: pointer;
  transition: 0.5s;
  outline: none;
}

.tags button:hover {
  border-color: #d6ff00;
  color: #d6ff00;
}

.tagActive {
  background: #d6ff00 !important;
  color: #000 !important;
  border-color: #d6ff00 !important;
}

.radioGroup {
  display: flex;
  flex-direction: column;
  gap: 14px;
  padding-right: 8px;
}

.radio {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 15px;
  color: #d0d0d0;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.radio:hover {
  background: rgba(255, 255, 255, 0.06);
}

.radioActive {
  background: rgba(214, 255, 0, 0.1) !important;
  color: #d6ff00 !important;
}

.circleActive {
  fill: #d6ff00;
}

.radio input {
  accent-color: #d6ff00;
  transform: scale(1.2);
}

/* Horizontal compact filters for small screens */
@media (max-width: 1024px) {
  .container {
    max-width: none;
    width: 100%;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 8px;
    overflow-x: auto;
    padding: 12px;
    background: rgba(255,255,255,0.04);
  }

  .title { display: none; }

  .section {
    margin: 0;
    min-width: 180px;
    flex: 0 0 auto;
    background: transparent;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .sectionHeader {
    justify-content: flex-start;
    gap: 8px;
    font-size: 14px;
    padding: 6px 10px;
    height: 36px;
    box-sizing: border-box;
  }

  .sectionHeader h3 { margin: 0; font-size: 14px; }

  .sectionContent {
    transition: max-height 0.25s ease, opacity 0.2s ease;
    width: 80%;
    margin-top: 6px;
  }

  .hideOnSmall { display: none !important; }

  .tags, .label { display: none !important; }

  .priceRange { flex-direction: column; gap: 6px; }

  .priceRange input { height: 46px; padding: 8px 12px; width: 100%;}


  .arrow {
    display: none;
  }


  .newsletterForm { justify-content: center; }


}
</file>

<file path="components/filters/filters.tsx">
'use client';

import {
  ArrowRight,
  Circle
} from 'lucide-react';
import styles from './filter.module.css';
import { FilterSection } from './FilterSection';
import { useFilters } from '@/lib/hooks/useFilters';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export default function Filters() {
  const { 
    filters, 
    updateFilters, 
    toggleCategory, 
    setPriceRange, 
    setCustomPrice 
  } = useFilters();
  
  const [categories, setCategories] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  // Buscar categorias do banco de dados
  useEffect(() => {
    async function fetchCategories() {
      const supabase = createClient();
      const { data: categoriesData } = await supabase
        .from('categories')
        .select('name')
        .order('name');
      
      setCategories(categoriesData?.map(cat => cat.name) || []);
      setIsLoading(false);
    }
    
    fetchCategories();
  }, []);
  
  // Tags de faixas de preço
  const priceTags = [
    'Até R$ 500',
    'R$ 500 - R$ 1.000',
    'R$ 1.000 - R$ 2.500',
    'R$ 2.500 - R$ 5.000',
    'R$ 5.000 - R$ 10.000',
    'Acima de R$ 10.000'
  ];

  const handleMinPriceChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value ? Number(e.target.value) : undefined;
    setCustomPrice(value, filters.maxPrice);
  };

  const handleMaxPriceChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value ? Number(e.target.value) : undefined;
    setCustomPrice(filters.minPrice, value);
  };

  const handleLocationChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFilters({ location: e.target.value, page: 1 });
  };

  const handleCityChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFilters({ city: e.target.value, page: 1 });
  };

  const handleStateChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFilters({ state: e.target.value, page: 1 });
  };

  const handleDateFilterChange = (dateFilter: string) => {
    const newFilter = filters.dateFilter === dateFilter ? '' : dateFilter;
    updateFilters({ dateFilter: newFilter, page: 1 });
  };

  if (isLoading) {
    return (
      <aside className={styles.container}>
        <h2 className={styles.title}>FILTROS</h2>
        <div className="space-y-4">
          {Array.from({ length: 4 }).map((_, i) => (
            <div key={i} className="animate-pulse">
              <div className="h-6 bg-gray-200 rounded w-3/4 mb-2"></div>
              <div className="h-16 bg-gray-200 rounded"></div>
            </div>
          ))}
        </div>
      </aside>
    );
  }

  return (
    <aside className={styles.container}>
      <h2 className={styles.title}>FILTROS</h2>

      {/* Preço */}
      <FilterSection title="Preço do produto" id="filters-price">
        <p className={styles.label}>Escolha um intervalo:</p>

        <div className={styles.priceRange}>
          <input 
            placeholder="Preço Min" 
            type="number"
            value={filters.minPrice || ''}
            onChange={handleMinPriceChange}
          />
          <button type="button" className={styles.arrow}>
            <ArrowRight size={16} />
          </button>
          <input 
            placeholder="Preço Max" 
            type="number"
            value={filters.maxPrice || ''}
            onChange={handleMaxPriceChange}
          />
        </div>

        <p className={styles.label}>Ou uma faixa específica:</p>

        <div className={styles.tags}>
          {priceTags.map((tag, i) => (
            <button 
              key={i} 
              type="button"
              className={filters.priceRange === tag ? styles.tagActive : ''}
              onClick={() => setPriceRange(tag)}
            >
              {tag}
            </button>
          ))}
        </div>
      </FilterSection>

      {/* Localização */}
      <FilterSection title="Localização do produto" id="filters-location">
        <p className={styles.label}>Escolha um estado:</p>
        <input
          className={styles.fullInput}
          placeholder="Goiás, São Paulo ..."
          value={filters.state || ''}
          onChange={handleStateChange}
        />

        <p className={styles.label}>Ou uma cidade específica:</p>
        <input
          className={styles.fullInput}
          placeholder="Goiânia, Trindade ..."
          value={filters.city || ''}
          onChange={handleCityChange}
        />
      </FilterSection>

      {/* Data */}
      <FilterSection title="Data do anúncio" id="filters-date" className={styles.hideOnSmall}>
        <div className={styles.radioGroup}>
          {['Última Semana', 'Último Mês', 'Último Trimestre'].map(item => (
            <label 
              key={item} 
              className={`${styles.radio} ${
                filters.dateFilter === item ? styles.radioActive : ''
              }`}
              onClick={() => handleDateFilterChange(item)}
            >
              <span>{item}</span>
              <Circle 
                size={18} 
                className={filters.dateFilter === item ? styles.circleActive : ''}
              />
            </label>
          ))}
        </div>
      </FilterSection>

      {/* Categoria */}
      <FilterSection title="Categoria do produto" id="filters-category" className={styles.hideOnSmall}>
        <div className={styles.tags}>
          {categories.map(cat => (
            <button 
              key={cat} 
              type="button"
              className={filters.categories && filters.categories.includes(cat) ? styles.tagActive : ''}
              onClick={() => toggleCategory(cat)}
            >
              {cat}
            </button>
          ))}
        </div>
      </FilterSection>
    </aside>
  );
}
</file>

<file path="components/layout/cabecalho/cabecalho.module.css">
.pill {
  background: #0f0f0f;
  border: 1px solid rgba(255, 255, 255, 0.03);
  border-radius: 120px;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

/* Desktop Navigation - visible above 1200px */
.desktopNav {
  display: none;
}

@media (min-width: 1200px) {
  .desktopNav {
    display: flex;
  }
}

/* Desktop Actions - visible above 1200px */  
.desktopActions {
  display: none;
}

@media (min-width: 1200px) {
  .desktopActions {
    display: flex;
  }
}

/* Mobile Actions - visible below 1200px */
.mobileActions {
  display: flex !important;
}

@media (min-width: 1200px) {
  .mobileActions {
    display: none !important;
  }
}

/* Mobile Menu Overlay - visible below 1200px */
.mobileMenuOverlay {
  display: block;
  z-index: 999;
}

@media (min-width: 1200px) {
  .mobileMenuOverlay {
    display: none;
  }
}

.navText {
  font-size: clamp(16px, 2.5vw, 21px);
  line-height: 0.9047619048em;
  transition: .4s;
}

.navText:hover {
  color: #ECF230
}

.entrarText {
  font-size: clamp(14px, 2.2vw, 21px);
  line-height: 0.7142857143em;
}

.ctaButton {
  font-size: clamp(14px, 2.2vw, 21px);
  line-height: 0.9047619048em;
  padding: clamp(10px, 1.5vw, 15px) clamp(12px, 2vw, 19px);
  border-radius: 20px;
  background: #ecf230;
  color: #312e2e;
}

.mobileMenu {
  background: #0f0f0f;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 24px;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  z-index: 999;
}

.mobileNavText {
  font-size: 20px;
  line-height: 1.3;
  font-weight: 500;
}

.mobileNavText:hover {
  color: #ECF230;
  transform: translateY(-1px);
  transition: all 0.2s ease;
}

.mobileCtaButton {
  font-size: 16px;
  line-height: 1.2;
  padding: 16px 24px;
  border-radius: 16px;
  background: #ecf230;
  color: #312e2e;
  font-weight: 600;
  transition: all 0.2s ease;
}

.mobileCtaButton:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(236, 242, 48, 0.3);
}

/* Hamburger Button Styles */
.hamburgerButton {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  border: none;
  cursor: pointer;
  padding: 4px;
  z-index: 50;
}

.hamburgerButton:hover {
  background: rgba(255, 255, 255, 0.2);
}

.hamburgerLine {
  width: 20px;
  height: 2px;
  background-color: white;
  transition: all 0.3s ease;
  margin: 1px 0;
  display: block;
}

@media (max-width: 480px) {
  .navText {
    font-size: 14px;
  }
  
  .entrarText {
    font-size: 12px;
  }
  
  .ctaButton {
    font-size: 12px;
    padding: 8px 12px;
  }
}
</file>

<file path="components/layout/cabecalho/index.tsx">
"use client";

import Link from "next/link";
import Image from "next/image";
import { createClient } from "@/lib/supabase/client";
import { BotaoSair } from "@/components/ui/botao-sair";
import { cn } from "@/lib/utils";
import styles from "./cabecalho.module.css";
import { useState, useEffect } from "react";
import type { User } from "@supabase/supabase-js";

type CabecalhoProps = {
  floating?: boolean;
};

export default function Cabecalho({ floating }: CabecalhoProps) {
  const [user, setUser] = useState<User | null>(null);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  
  useEffect(() => {
    const getUser = async () => {
      const supabase = createClient();
      const { data: { user } } = await supabase.auth.getUser();
      setUser(user);
    };
    getUser();
  }, []);

  return (
    <>
      <header className={cn("w-full px-4 py-4", floating && "absolute inset-x-0 top-0 z-50")}>
        <div className="mx-auto w-full max-w-[1744px]">
          <div
            className={cn(
              "flex w-full items-center justify-between gap-[10px] px-6 py-3 md:px-[40px] md:py-[18px]",
              styles.pill
            )}
          >
            {/* Logo */}
            <Link href="/" aria-label="Página inicial">
              <Image
                src="/logo.svg"
                alt="DROPTECH"
                width={256}
                height={37}
                priority
                className="h-[24px] w-auto sm:h-[28px] md:h-[36px]"
              />
            </Link>

            {/* Desktop Navigation */}
            <nav className={cn("items-center gap-[22px]", styles.desktopNav)}>
              <Link
                href="/"
                className={cn(
                  "text-white font-medium hover:opacity-80 transition-opacity",
                  styles.navText
                )}
              >
                Home
              </Link>
              <Link
                href="/explorar"
                className={cn(
                  "text-white font-medium hover:opacity-80 transition-opacity",
                  styles.navText
                )}
              >
                Explorar
              </Link>
              <Link
                href="/#missao"
                className={cn(
                  "text-white font-medium hover:opacity-80 transition-opacity",
                  styles.navText
                )}
              >
                Sobre
              </Link>
              <Link
                href="/#ofertas-do-dia"
                className={cn(
                  "text-white font-medium hover:opacity-80 transition-opacity",
                  styles.navText
                )}
              >
                Ofertas do Dia
              </Link>
            </nav>

            {/* Desktop Actions */}
            <div className={cn("items-center gap-[18px] md:gap-[31px]", styles.desktopActions)}>
              {user ? (
                <>
                  <Link
                    href="/dashboard"
                    className={cn(
                      "text-white font-medium hover:opacity-80 transition-opacity",
                      styles.entrarText
                    )}
                  >
                    Minha conta
                  </Link>
                  <BotaoSair className={cn("hover:brightness-95 transition", styles.ctaButton)} />
                </>
              ) : (
                <>
                  <Link
                    href="/auth/login"
                    className={cn(
                      "text-white font-medium hover:opacity-80 transition-opacity",
                      styles.entrarText
                    )}
                  >
                    Entrar
                  </Link>
                  <Link
                    href="/auth/cadastro"
                    className={cn(
                      "inline-flex items-center justify-center hover:brightness-95 transition",
                      styles.ctaButton
                    )}
                  >
                    Cadastrar
                  </Link>
                </>
              )}
            </div>

            {/* Mobile Actions */}
            <div className={cn("items-center gap-3", styles.mobileActions)}>
              {/* Hamburger Menu Button */}
              <button
                onClick={() => {
                  setIsMenuOpen(!isMenuOpen);
                }}
                className={cn("focus:outline-none", styles.hamburgerButton)}
                aria-label="Menu"
              >
                <span className={cn(
                  styles.hamburgerLine,
                  isMenuOpen && "rotate-45 translate-y-1.5"
                )} />
                <span className={cn(
                  styles.hamburgerLine,
                  isMenuOpen && "opacity-0"
                )} />
                <span className={cn(
                  styles.hamburgerLine,
                  isMenuOpen && "-rotate-45 -translate-y-1.5"
                )} />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Mobile Menu Overlay */}
      {isMenuOpen && (
        <div className={cn("fixed inset-0 bg-black/90 transition-opacity duration-300", styles.mobileMenuOverlay)} onClick={() => setIsMenuOpen(false)} style={{zIndex: 999}}>
          <div 
            className={cn(
              "fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[90vw] max-w-md h-auto max-h-[80vh] transition-all duration-300 ease-out",
              styles.mobileMenu,
              isMenuOpen ? "opacity-100 scale-100" : "opacity-0 scale-95"
            )}
            onClick={(e) => e.stopPropagation()}
          >
            <div className="flex flex-col p-8">
              {/* Close Button */}
              <button
                onClick={() => setIsMenuOpen(false)}
                className="self-end mb-6 p-2 rounded-full hover:bg-white/10 transition-colors"
                aria-label="Fechar menu"
              >
                <span className="text-white text-2xl">&times;</span>
              </button>
              
              <nav className="flex flex-col space-y-8 text-center">
                <Link
                  href="/"
                  className={cn(
                    "text-white font-medium hover:opacity-80 transition-opacity",
                    styles.mobileNavText
                  )}
                  onClick={() => setIsMenuOpen(false)}
                >
                  Home
                </Link>
                <Link
                  href="/explorar"
                  className={cn(
                    "text-white font-medium hover:opacity-80 transition-opacity",
                    styles.mobileNavText
                  )}
                  onClick={() => setIsMenuOpen(false)}
                >
                  Explorar
                </Link>
                <Link
                  href="/#missao"
                  className={cn(
                    "text-white font-medium hover:opacity-80 transition-opacity",
                    styles.mobileNavText
                  )}
                  onClick={() => setIsMenuOpen(false)}
                >
                  Sobre
                </Link>
                <Link
                  href="/#ofertas-do-dia"
                  className={cn(
                    "text-white font-medium hover:opacity-80 transition-opacity",
                    styles.mobileNavText
                  )}
                  onClick={() => setIsMenuOpen(false)}
                >
                  Ofertas do Dia
                </Link>
              </nav>
              
              <div className="mt-10 space-y-4">
                {user ? (
                  <>
                    <Link
                      href="/dashboard"
                      className={cn(
                        "block w-full text-center py-4 px-6 rounded-xl bg-white/10 text-white font-medium hover:bg-white/20 transition-colors"
                      )}
                      onClick={() => setIsMenuOpen(false)}
                    >
                      Minha conta
                    </Link>
                    <div className="block w-full">
                      <BotaoSair className={cn("w-full py-4", styles.mobileCtaButton)} />
                    </div>
                  </>
                ) : (
                  <>
                    <Link
                      href="/auth/login"
                      className={cn(
                        "block w-full text-center py-4 px-6 rounded-xl border border-white/20 text-white font-medium hover:bg-white/10 transition-colors"
                      )}
                      onClick={() => setIsMenuOpen(false)}
                    >
                      Entrar
                    </Link>
                    <Link
                      href="/auth/cadastro"
                      className={cn(
                        "block w-full text-center py-4 hover:brightness-95 transition",
                        styles.mobileCtaButton
                      )}
                      onClick={() => setIsMenuOpen(false)}
                    >
                      Cadastrar
                    </Link>
                  </>
                )}
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
</file>

<file path="components/product/ProductContact.tsx">
'use client';

import { MessageCircle } from 'lucide-react';
import Image from 'next/image';
import styles from './product.module.css';
import type { Tables } from '@/src/types/supabase';
import { sendMessage } from '@/app/(main)/anuncio/[id]/actions';
import { useState, useTransition } from 'react';

interface ProductContactProps {
  product: Tables<'products'> & {
    seller?: {
      phone?: string;
    };
  };
}

export default function ProductContact({ product }: ProductContactProps) {
  const [formData, setFormData] = useState({
    fullName: '',
    email: '',
    phone: '',
    message: ''
  });
  const [isSubmitted, setIsSubmitted] = useState(false);
  const [isPending, startTransition] = useTransition();
  const [error, setError] = useState<string | null>(null);

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(price);
  };

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    
    startTransition(async () => {
      try {
        setError(null);
        const data = new FormData();
        data.append('productId', product.id);
        data.append('fullName', formData.fullName);
        data.append('email', formData.email);
        data.append('phone', formData.phone);
        data.append('message', formData.message);
        
        await sendMessage(data);
        setIsSubmitted(true);
        setFormData({
          fullName: '',
          email: '',
          phone: '',
          message: ''
        });
      } catch {
        setError('Erro ao enviar mensagem. Tente novamente.');
      }
    });
  };

  const handleWhatsAppClick = () => {
    const phone = product.contact_phone;
    if (phone) {
      const cleanPhone = phone.replace(/\D/g, '');
      const message = `Olá! Vi seu anúncio "${product.title}" na DropTech e gostaria de mais informações.`;
      const whatsappUrl = `https://wa.me/55${cleanPhone}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }
  };

  return (
    <aside className={styles.contactCard}>
      <div className={styles.contactCardHeader}>
        <div className={styles.productTitlePrice}>
          <div className={styles.price}>
            <strong>{formatPrice(product.price)}</strong>
          </div>

          {product.contact_phone && (
            <button onClick={handleWhatsAppClick} className={styles.whatsappButton}>
              <Image src="/figma/wpp.png" alt="WhatsApp" width={48} height={48} />
            </button>
          )}
        </div>

        {isSubmitted ? (
          <div className={styles.successMessage}>
            <h3>Mensagem enviada com sucesso!</h3>
            <p>O vendedor receberá sua mensagem e entrará em contato em breve.</p>
          </div>
        ) : (
          <form onSubmit={handleSubmit} className={styles.contactForm}>
            {error && (
              <div className={styles.errorMessage}>
                {error}
              </div>
            )}
            
            <div className={styles.formGroup}>
              <label htmlFor="contact-name" className={styles.formLabel}>Nome completo</label>
              <input 
                id="contact-name"
                name="fullName"
                className={styles.formInput}
                placeholder="Digite seu nome completo"
                type="text"
                value={formData.fullName}
                onChange={handleInputChange}
                required
              />
            </div>
            
            <div className={styles.formGroup}>
              <label htmlFor="contact-email" className={styles.formLabel}>E-mail</label>
              <input 
                id="contact-email"
                name="email"
                className={styles.formInput}
                placeholder="Digite seu melhor e-mail"
                type="email"
                value={formData.email}
                onChange={handleInputChange}
                required
              />
            </div>
            
            <div className={styles.formGroup}>
              <label htmlFor="contact-phone" className={styles.formLabel}>Telefone</label>
              <input 
                id="contact-phone"
                name="phone"
                className={styles.formInput}
                placeholder="Digite seu telefone com DDD"
                type="tel"
                value={formData.phone}
                onChange={handleInputChange}
                required
              />
            </div>
            
            <div className={styles.formGroup}>
              <label htmlFor="contact-message" className={styles.formLabel}>Mensagem</label>
              <textarea 
                id="contact-message"
                name="message"
                className={styles.formTextarea}
                placeholder={`Tenho interesse no produto "${product.title}". Poderia me enviar mais detalhes?`}
                rows={4}
                value={formData.message}
                onChange={handleInputChange}
                required
              />
            </div>

            <button 
              type="submit" 
              className={styles.submitButton}
              disabled={isPending}
            >
              <MessageCircle size={20} />
              {isPending ? 'Enviando...' : 'Enviar Mensagem'}
            </button>
          </form>
        )}
      </div>
    </aside>
  );
}
</file>

<file path="components/product/ProductGallery.tsx">
'use client';

import { ChevronLeft, ChevronRight} from 'lucide-react';
import Image from 'next/image';
import { useState, useEffect } from 'react';
import styles from './product.module.css';
import type { Tables } from '@/src/types/supabase';

interface ProductGalleryProps {
  product: Tables<'products'>;
}

export default function ProductGallery({ product }: ProductGalleryProps) {
  const images = product.images_urls && product.images_urls.length > 0 
    ? product.images_urls.map((url, index) => ({ 
        src: url, 
        alt: `${product.title} - Imagem ${index + 1}` 
      }))
    : [{ 
        src: '/figma/card-bg-1.png', 
        alt: product.title 
      }];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [lightboxImage, setLightboxImage] = useState<number | null>(null);
  const [imagesPerView, setImagesPerView] = useState(3);
  const maxIndex = Math.max(0, images.length - imagesPerView);

  useEffect(() => {
    const updateImagesPerView = () => {
      const width = window.innerWidth;
      if (width < 400) {
        setImagesPerView(Math.min(1, images.length));
      } else if (width < 650) {
        setImagesPerView(Math.min(2, images.length));
      } else {
        setImagesPerView(Math.min(3, images.length));
      }
    };

    updateImagesPerView();
    window.addEventListener('resize', updateImagesPerView);
    return () => window.removeEventListener('resize', updateImagesPerView);
  }, [images.length]);

  const handlePrevious = () => {
    setCurrentIndex(prev => Math.max(0, prev - 1));
  };

  const handleNext = () => {
    setCurrentIndex(prev => Math.min(maxIndex, prev + 1));
  };

  const openLightbox = (index: number) => {
    setLightboxImage(index);
  };

  const closeLightbox = () => {
    setLightboxImage(null);
  };

  const nextImage = () => {
    if (lightboxImage !== null) {
      setLightboxImage((lightboxImage + 1) % images.length);
    }
  };

  const prevImage = () => {
    if (lightboxImage !== null) {
      setLightboxImage((lightboxImage - 1 + images.length) % images.length);
    }
  };

  return (
    <div className={styles.gallery}>
      <button 
        className={styles.galleryArrowLeft}
        onClick={handlePrevious}
        disabled={currentIndex === 0}
      >
        <ChevronLeft />
      </button>

      <div className={styles.galleryContainer}>
        <div 
          className={styles.galleryTrack}
          style={{ 
            transform: `translateX(-${currentIndex * (100 / imagesPerView)}%)`,
            width: `${(images.length / imagesPerView) * 100}%`
          }}
        >
          {images.map((image, index) => (
            <div key={index} className={styles.gallerySlide}>
              <Image 
                src={image.src} 
                alt={image.alt} 
                width={300} 
                height={200}
                className={styles.galleryImage}
                onClick={() => openLightbox(index)}
              />
            </div>
          ))}
        </div>
      </div>

      <button 
        className={styles.galleryArrowRight}
        onClick={handleNext}
        disabled={currentIndex === maxIndex}
      >
        <ChevronRight />
      </button>

      {lightboxImage !== null && (
        <div className={styles.lightbox} onClick={closeLightbox}>
          <div className={styles.lightboxContent} onClick={(e) => e.stopPropagation()}>

            <button className={styles.lightboxPrev} onClick={prevImage}>
              <ChevronLeft />
            </button>
            
            <Image 
              src={images[lightboxImage].src}
              alt={images[lightboxImage].alt}
              width={800}
              height={600}
              className={styles.lightboxImage}
            />
            
            <button className={styles.lightboxNext} onClick={nextImage}>
              <ChevronRight />
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="components/product/ProductPage.tsx">
import styles from './product.module.css';
import ProductGallery from './ProductGallery';
import ProductInfo from './ProductInfo';
import ProductSeller from './ProductSeller';
import ProductContact from './ProductContact';
import { getProductDetails } from '@/app/(main)/anuncio/[id]/actions';
import { notFound } from 'next/navigation';

interface ProductPageProps {
  productId: string;
}

export default async function ProductPage({ productId }: ProductPageProps) {
  const result = await getProductDetails(productId);
  
  if (!result?.product) {
    notFound();
  }
  
  const { product, isFavorite, currentUserId, userRole } = result;

  return (
    <div className={styles.page}>
      <ProductGallery product={product} />

      <div className={`${styles.content}`}>
        <div className={styles.left}>
          <ProductInfo product={product} isFavorite={isFavorite} currentUserId={currentUserId} userRole={userRole} />
          <ProductSeller product={product} />
        </div>

        <ProductContact product={product} />
      </div>
    </div>
  );
}
</file>

<file path="components/product/ProductSeller.tsx">
import { Layers, BadgeCheck, User } from 'lucide-react';
import Image from 'next/image';
import styles from './product.module.css';
import type { Tables } from '@/src/types/supabase';

interface ProductSellerProps {
  product: Tables<'products'> & {
    seller?: {
      avatar_url?: string;
      full_name?: string;
    };
    sellerStats?: {
      totalProducts: number;
    };
  };
}

export default function ProductSeller({ product }: ProductSellerProps) {
  const seller = product.seller;
  const sellerStats = product.sellerStats;

  return (
    <section className={styles.sellerCard}>
      <h3>INFORMAÇÕES DO VENDEDOR</h3>

      <div className={styles.sellerContent}>
        <div className={styles.sellerInfo}>
          {seller?.avatar_url ? (
            <Image
              src={seller.avatar_url}
              alt="Vendedor"
              width={50}
              height={50}
              className={styles.sellerAvatar}
            />
          ) : (
            <div className={styles.sellerStats}>
              <button>
                <User />
              </button>
            </div>
          )}
          <span>{seller?.full_name || 'Vendedor'}</span>
        </div>

        <div className={styles.sellerStats}>
          <button>
            <Layers />
          </button>
          <span>+{sellerStats?.totalProducts || 0} anúncios</span>
        </div>

        <div className={styles.sellerReputation}>
          <button>
            <BadgeCheck />
          </button>
          <span>
            {sellerStats && sellerStats.totalProducts > 5
              ? 'Boa Reputação'
              : 'Novo Vendedor'
            }
          </span>
        </div>
      </div>

    </section>
  );
}
</file>

<file path="components/sections/em-alta/index.tsx">
import { createClient } from "@/lib/supabase/server";
import styles from "./secao-em-alta.module.css";
import { cn } from "@/lib/utils";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio/index";

export async function SecaoEmAlta() {
  const supabase = await createClient();

  const { data: products } = await supabase
    .from("products")
    .select(`
      *,
      tags:products_tags(
        tag:tags(
          name
        )
      )
    `)
    .eq("status", "aprovado")
    .order("created_at", { ascending: false })
    .limit(20);

  // Transformar os dados para o formato esperado
  const transformedProducts = (products ?? []).map(product => ({
    ...product,
    tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
  }));

  const items = transformedProducts as ProductRow[];
  
  // Se não houver produtos suficientes, duplique para efeito visual
  const displayItems = items.length < 10 ? [...items, ...items, ...items] : items;

  return (
    <section
      
      className={cn("w-full scroll-mt-[262px]", styles.section)}
    >
      <div id="ofertas-do-dia" className="mx-auto flex w-full flex-col items-center gap-[80px] px-4 py-[50px] pb-[60px] md:px-16 lg:px-[199px]">
        {/* Header */}
        <div   className="flex w-full max-w-[1040px] flex-col items-center justify-center gap-6 text-center">
          <div className={styles.kicker}>Em alta agora</div>
          <h2 className={cn("text-white font-medium", styles.title)}>
            Produtos que movimentaram a DropTech essa semana
          </h2>
          <p className={cn("text-white font-normal", styles.subtitle)}>
            O que está chamando atenção agora no marketplace.
          </p>
        </div>

      </div>

      <div className={styles.tickerWrap}>
        <div className={styles.tickerTrack}>
          <div className={styles.tickerGroup}>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>

          <div className={styles.tickerGroup} aria-hidden>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}-dup`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="components/sections/hardware/index.tsx">
import { createClient } from "@/lib/supabase/server";
import { cn } from "@/lib/utils";
import { CardAnuncio, type ProductRow } from "@/components/cards/anuncio";
import styles from "./secao-hardware.module.css";

export async function SecaoHardware() {
  const supabase = await createClient();

  const { data: products } = await supabase
    .from("products")
    .select(`
      *,
      tags:products_tags(
        tag:tags(
          name
        )
      )
    `)
    .eq("status", "aprovado")
    .ilike("category", "%hardware%")
    .order("created_at", { ascending: false })
    .limit(20);

  // Transformar os dados para o formato esperado
  const transformedProducts = (products ?? []).map(product => ({
    ...product,
    tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
  }));

  let items = transformedProducts as ProductRow[];
  
  // Se não houver produtos de hardware, buscar produtos gerais
  if (items.length === 0) {
    const { data: generalProducts } = await supabase
      .from("products")
      .select(`
        *,
        tags:products_tags(
          tag:tags(
            name
          )
        )
      `)
      .eq("status", "aprovado")
      .order("created_at", { ascending: false })
      .limit(20);

    const transformedGeneral = (generalProducts ?? []).map(product => ({
      ...product,
      tags: product.tags?.map((t: { tag: { name: string } }) => t.tag).filter(Boolean) || []
    }));

    items = transformedGeneral as ProductRow[];
  }
  
  // Se não houver produtos suficientes, duplique para efeito visual
  const displayItems = items.length < 10 ? [...items, ...items, ...items] : items;

  return (
    <section className={cn("w-full", styles.section)}>
      <div className="mx-auto flex w-full flex-col items-center gap-[80px] px-4 py-[50px] pb-[60px] md:px-16 lg:px-[199px]">
        <div className="flex w-full max-w-[1369px] flex-col items-center justify-center gap-6 text-center">
          <div className={styles.kicker}>Hardware</div>

          <h2 className={cn("text-white font-medium", styles.title)}>
            Peças para montar, melhorar ou turbinar seu setup
          </h2>

          <p className={cn("text-white font-normal", styles.subtitle)}>
            Processadores, memórias, SSDs e tudo que você precisa para dar upgrade no seu PC.
          </p>
        </div>
      </div>

      <div className={styles.tickerWrap}>
        <div className={styles.tickerTrack}>

          <div className={styles.tickerGroup}>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>

          <div className={styles.tickerGroup} aria-hidden>
            {displayItems.map((product, index) => (
              <div key={`${product.id}-${index}-dup`} className={styles.tickerItem}>
                <CardAnuncio
                  product={product}
                />
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="components/sections/hardware/secao-hardware.module.css">
.section {
  background-color: #0f0f0f;
  background-image:
    linear-gradient(180deg, rgba(15, 15, 15, 1) 0%, rgba(15, 15, 15, 0) 68%),
    linear-gradient(180deg, rgba(15, 15, 15, 0) 0%, rgba(15, 15, 15, 1) 100%),
    radial-gradient(circle at 70% 10%, rgba(0, 0, 0, 0) 0%, rgba(0, 255, 178, 0.55) 100%);
}

.kicker {
  background: rgba(236, 242, 48, 0.06);
  border: 1px solid rgba(236, 242, 48, 0.08);
  border-radius: 41px;
  padding: 8px 54px;
  font-size: 22px;
  line-height: 1.5em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.61);
}

.title {
  max-width: 882px;
  font-size: 56px;
  line-height: 1.0714285714em;
  text-wrap: balance;
}

.subtitle {
  font-size: 30px;
  line-height: 1.1em;
  text-wrap: balance;
}

.tickerWrap {
  width: 100vw;
  position: relative;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  overflow: hidden;
  padding: 0 16px 150px 16px;
}

.tickerTrack {
  display: flex;
  align-items: center;
  width: max-content;
  animation: droptech-marquee var(--marquee-duration, 80s) linear infinite;
  will-change: transform;
  gap: 40px;
}

.tickerGroup {
  display: flex;
  align-items: center;
  gap: 40px;
}

.tickerItem {
  flex: 0 0 auto;
  width: min(478px, 92vw);
}

@keyframes droptech-marquee {
  0% {
    transform: translate3d(0, 0, 0);
  }

  100% {
    transform: translate3d(-50%, 0, 0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .tickerTrack {
    animation: none;
  }
}

@media (max-width: 1524px) {
  .kicker {
    font-size: 20px;
    padding: 6px 40px;
  }

  .title { font-size: 40px; }
  .subtitle { font-size: 22px; }

  .tickerWrap { padding-bottom: 100px; }

  .tickerTrack { gap: 26px; }
  .tickerGroup { gap: 26px; }

  .tickerItem { width: min(360px, 92vw); }
}

@media (max-width: 1224px) {
  .kicker {
    font-size: 18px;
    padding: 6px 40px;
  }

  .title { font-size: 32px; }
  .subtitle { font-size: 20px; }

  .tickerItem { width: min(320px, 92vw); }
}

@media (max-width: 768px) {
  .kicker {
    font-size: 16px;
    padding: 6px 28px;
    margin-left: auto;
    margin-right: auto;
  }

  .title { font-size: 28px; text-align: center; }
  .subtitle { font-size: 20px; text-align: center; }

  .tickerWrap { padding-bottom: 80px; }

}

@media (max-width: 480px) {
  .kicker {
    font-size: 14px;
    padding: 6px 18px;
  }

  .title { font-size: 20px; }
  .subtitle { font-size: 16px; }

}
</file>

<file path="components/sections/hero/index.tsx">
import Link from "next/link";
import { cn } from "@/lib/utils";
import styles from "./secao-hero.module.css";

export function SecaoHero() {
  return (
    <section className={cn("w-full", styles.hero)}>
      <div className={cn("mx-auto flex w-full max-w-[1800px] gap-[10px]", styles.heroContainer)}>

        {/* Left column */}
        <div className="flex flex-1 flex-col justify-between pt-20">
          <h1
            className={cn(
              "text-white font-medium tracking-tight",
              styles.title
            )}
          >
            O marketplace<br />
            onde <span className={styles.highlight}>tecnologia</span>
          </h1>

          <div className={cn("flex w-full flex-col gap-[26px] self-start", styles.subtitleContainer)}>
            <p
              className={cn(
                "text-white/90 font-normal max-w-[720px]",
                styles.subtitle
              )}
            >
              Anuncie, descubra e venda com segurança diversos produtos tech em
              um único lugar.
            </p>

            <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-6">
              <Link
                href="/explorar"
                className={cn(
                  "inline-flex items-center justify-center hover:brightness-95 transition",
                  styles.ctaPrimary
                )}
              >
                Explorar Ofertas
              </Link>

              <Link
                href="/auth/cadastro"
                className={cn(
                  "inline-flex items-center justify-center hover:brightness-110 transition",
                  styles.ctaSecondary
                )}
              >
                Se Cadastrar
              </Link>
            </div>
          </div>
        </div>

        {/* Right column */}
        <div className={cn("flex flex-1 items-center justify-end pt-20", styles.right)}>
          <h2 className={cn("text-white font-medium tracking-tight", styles.secondaryTitle)}>
            vira oportunidade <br />
            de <span className={styles.highlight}>negócio</span>
          </h2>
        </div>
        
      </div>
    </section>
  );
}
</file>

<file path="components/sections/hero/secao-hero.module.css">
.hero {
  min-height: 100vh;
  background-color: #0f0f0f;
  background-image:
    radial-gradient(circle at -7% -20%, rgba(168, 154, 4, 0.15) 0%, rgba(15, 15, 15, 0) 65%),
    url("/figma/hero-bg.webp");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.heroContainer {
  min-height: 100vh;
  padding: clamp(80px, 12vh, 230px) clamp(16px, 4vw, 60px) clamp(40px, 8vh, 86px) clamp(16px, 4vw, 60px);
}

/* Altura responsiva por breakpoints */
@media (max-width: 1199px) {
  .hero {
    min-height: 92vh;
  }
  
  .heroContainer {
    min-height: 92vh;
  }

  .right {
    padding-top: 0 !important;
  }
}

@media (max-width: 768px) {
  .hero, .heroContainer {
    min-height: 90vh;
  }
}

@media (max-width: 480px) {

  .right {
    padding-top: 5rem !important;
  }
  
  .heroContainer {
    padding: 0 40px;
  }
}

.highlight {
  color: #00FFB2;
  text-transform: uppercase;
  font-family: var(--font-k2d), var(--font-poppins), sans-serif;
}

.title {
  font-size: clamp(32px, 8vw, 81px);
  line-height: 1.1358024691em;
}

.subtitle {
  font-size: clamp(16px, 3.5vw, 30px);
  line-height: 1.4666666667em;
  text-wrap: balance;
}

.ctaPrimary {
  padding: clamp(12px, 1.5vw, 15px) clamp(16px, 2vw, 19px);
  border-radius: 20px;
  background: #ecf230;
  color: #312e2e;
  font-size: clamp(14px, 2.2vw, 21px);
  line-height: 0.9047619048em;
}

.ctaSecondary {
  padding: clamp(12px, 1.5vw, 15px) clamp(16px, 2vw, 19px);
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  color: rgba(255, 255, 255, 0.6);
  font-size: clamp(14px, 2.2vw, 21px);
  line-height: 0.9047619048em;
}

.secondaryTitle {
  font-size: clamp(28px, 7vw, 81px);
  line-height: 1.1358024691em;
  text-align: center;
}

.subtitleContainer {
  opacity: 1;
}

/* Media query para telas menores que 1200px */
@media (max-width: 1499px) {
  .secondaryTitle, .title {
    font-size: clamp(20px, 5vw, 44px);
    text-align: left;
  }
  .subtitle {
    font-size: clamp(14px, 3vw, 20px);
  }
}

@media (max-width: 1399px) {
  .title {
    font-size: clamp(24px, 6vw, 48px);
  }
  
  .subtitle {
    font-size: clamp(14px, 3vw, 22px);
  }
  
  .ctaPrimary,
  .ctaSecondary {
    font-size: clamp(12px, 2vw, 18px);
    padding: clamp(10px, 1.2vw, 14px) clamp(14px, 1.8vw, 18px);
  }
  
  .secondaryTitle {
    font-size: clamp(20px, 5vw, 36px);
    text-align: left;
  }
}

@media (max-width: 900px) {
  .title {
    font-size: 28px;
  }
}

@media (max-width: 620px) {
  .title {
    font-size: 24px;
  }
}

@media (max-width: 480px) {
  .title {
    font-size: 26px;
    top: 140px;
    position: absolute;
  }

  .subtitleContainer {
    position: absolute;
    bottom: 30px;
    width: 75%;
  }
  
  .subtitle {
    font-size: 12px;
  }
  
  .ctaPrimary,
  .ctaSecondary {
    padding: 8px 12px;
    font-size: 12px;
    border-radius: 16px;
  }
  
  .secondaryTitle {
    font-size: 26px;
    top: 250px;
    position: absolute;
  }
}
</file>

<file path="components/sections/missao/secao-missao.module.css">
.section {
    padding: 0 80px;
    height: 900px;
    position: relative;
    overflow: hidden;
    background:
        url("/figma/o.png") left center / auto 100% no-repeat,
        radial-gradient(900px 650px at 18% 22%, rgba(255, 255, 255, 0.55), rgba(255, 255, 255, 0) 60%),
        radial-gradient(1200px 900px at 80% 40%, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0) 70%),
        linear-gradient(180deg, #ecf230 0%, #d7e81d 100%);
}

.inner {
    position: relative;
    padding: 70px 0;
}

.grid {
    display: grid;
    grid-template-columns: 1.05fr 1fr;
    gap: 40px;
    align-items: center;
}

.left {
    position: relative;
    min-height: 520px;
}

.productMock {
    position: absolute;
    left: -100px;
    top: 0;
    width: 900px;
    height: 900px;
    aspect-ratio: 1 / 1;
    border-radius: 28px;
    background-size: contain;
    background-repeat: no-repeat;
    background-image:
        url("/figma/pc.png");
}

.right {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: end;
    flex-direction: column;
    gap: 14px;
    max-width: 680px;
    padding-top: 60px;
}

.kicker {
    width: 100%;
    max-width: 520px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.35);
    border: 1px solid rgba(255, 255, 255, 0.35);
    color: rgba(15, 15, 15, 0.75);
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
}

.title {
    font-size: 56px;
    line-height: 1.05em;
    font-weight: 600;
    color: #0f0f0f;
    text-align: end;
    text-wrap: balance;
}

.subtitle {
    text-align: end;
    font-size: 18px;
    line-height: 1.5em;
    color: rgba(15, 15, 15, 0.8);
    max-width: 560px;
    text-wrap: balance;
}

.cta {
    margin-top: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 42px;
    width: 170px;
    border-radius: 14px;
    background: #00FFB2;
    color: #00704F;
    font-weight: 500;
    font-size: 14px;
    transition: filter 150ms ease;
}

.cta:hover {
    filter: brightness(0.95);
}

.floatingCards {
    position: relative;
    margin-top: 22px;
    height: 240px;
    width: 100%;
}

.card {
    position: absolute;
    width: 240px;
    border-radius: 18px;
    background: rgba(255, 255, 255, 0.92);
    box-shadow: 0 18px 44px rgba(0, 0, 0, 0.18);
    padding: 14px 14px 16px;
}

.cardTop {
    display: flex;
    align-items: center;
    gap: 10px;
}

.avatar {
    width: 34px;
    height: 34px;
    border-radius: 999px;
    background: rgba(15, 15, 15, 0.08);
    color: rgba(15, 15, 15, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 12px;
}

.cardMeta {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.cardName {
    font-size: 12px;
    font-weight: 600;
    color: rgba(15, 15, 15, 0.8);
}

.stars {
    display: flex;
    gap: 2px;
    color: #00d6c8;
}

.cardText {
    margin-top: 10px;
    font-size: 12px;
    line-height: 1.35em;
    color: rgba(15, 15, 15, 0.74);
}

.cardA {
    right: 0px;
    bottom: 0;
    transform: rotate(-7deg);
}

.cardB {
    right: 160px;
    top: -32px;
    transform: rotate(8deg);
}

.cardC {
    right: 260px;
    bottom: -8px;
    transform: rotate(-10deg);
}


/* Responsive rules matching por-que sizes */
@media (max-width: 1420px) {

    .right {
        max-width: 1024px;
    }

    .kicker {
        font-size: 18px;
        display: flex;
        justify-content: end;
        padding: 6px 40px;
    }

    .title {
        font-size: 48px;
    }

    .subtitle {
        font-size: 24px;
    }

    .section {
        height: auto;
        padding: 0 48px;
    }

    .inner {
        padding: 48px 0;
    }
}

@media (max-width: 1224px) {

    .right {
        max-width: 1024px;
    }

    .grid {
        grid-template-columns: 1fr;
    }

    .left {
        display: none;
    }

    .kicker {
        font-size: 18px;
        display: flex;
        justify-content: end;
        padding: 6px 40px;
    }

    .title {
        font-size: 48px;
    }

    .subtitle {
        font-size: 24px;
    }

    .section {
        height: auto;
        padding: 0 48px;
    }

    .inner {
        padding: 48px 0;
    }
}

@media (max-width: 768px) {

    .kicker {
        font-size: 16px;
        padding: 6px 28px;
    }

    .title {
        font-size: 36px;
    }

    .subtitle {
        font-size: 20px;
    }

    .floatingCards {
        height: 300px;
    }

    .cardA {
        left: 100px;
        top: 0;
        bottom: auto;
    }

    .cardB {
        left: auto;
        right: 0;
        top: 0;
    }

    .cardC {
        left: auto;
        right: 100px;
        top: 110px;
        bottom: auto;
    }

    .section {
        padding: 0 24px;
    }

    .right {
        padding-top: 30px;
    }
}

@media (max-width: 480px) {
    .kicker {
        font-size: 14px;
        padding: 6px 18px;
    }

    .title {
        font-size: 24px;
    }

    .subtitle {
        font-size: 16px;
    }

    .floatingCards {
        height: 260px;
    }

    .card {
        width: 200px;
        padding: 12px;
    }

    .section {
        padding: 0 12px;
    }

    .inner {
        padding: 24px 0;
    }

    .cardA {
        left: 0;
        top: 0;
        bottom: auto;
    }

    .cardB {
        left: auto;
        right: 0;
        top: 0;
    }

    .cardC {
        left: auto;
        right: 60px;
        top: 80px;
        bottom: auto;
    }
}
</file>

<file path="package.json">
{
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint ."
  },
  "dependencies": {
    "@radix-ui/react-checkbox": "^1.3.1",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.14",
    "@radix-ui/react-label": "^2.1.6",
    "@radix-ui/react-progress": "^1.1.8",
    "@radix-ui/react-separator": "^1.1.8",
    "@radix-ui/react-slot": "^1.2.2",
    "@radix-ui/react-tabs": "^1.1.13",
    "@supabase/ssr": "latest",
    "@supabase/supabase-js": "latest",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "framer-motion": "^12.26.2",
    "lucide-react": "^0.511.0",
    "next": "latest",
    "next-themes": "^0.4.6",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "supabase": "^2.72.7",
    "tailwind-merge": "^3.3.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.20",
    "eslint": "^9",
    "eslint-config-next": "15.3.1",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "tailwindcss-animate": "^1.0.7",
    "typescript": "^5"
  }
}
</file>

<file path="src/types/supabase.ts">
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "14.1"
  }
  public: {
    Tables: {
      categories: {
        Row: {
          created_at: string | null
          id: string
          name: string
          slug: string
        }
        Insert: {
          created_at?: string | null
          id?: string
          name: string
          slug: string
        }
        Update: {
          created_at?: string | null
          id?: string
          name?: string
          slug?: string
        }
        Relationships: []
      }
      favorites: {
        Row: {
          created_at: string | null
          id: string
          product_id: string
          user_id: string
        }
        Insert: {
          created_at?: string | null
          id?: string
          product_id: string
          user_id: string
        }
        Update: {
          created_at?: string | null
          id?: string
          product_id?: string
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "favorites_product_id_fkey"
            columns: ["product_id"]
            isOneToOne: false
            referencedRelation: "products"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "favorites_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      messages: {
        Row: {
          created_at: string | null
          email: string
          full_name: string
          id: string
          message_content: string
          phone: string
          product_id: string | null
          read: boolean | null
          vendor_id: string
        }
        Insert: {
          created_at?: string | null
          email: string
          full_name: string
          id?: string
          message_content: string
          phone: string
          product_id?: string | null
          read?: boolean | null
          vendor_id: string
        }
        Update: {
          created_at?: string | null
          email?: string
          full_name?: string
          id?: string
          message_content?: string
          phone?: string
          product_id?: string | null
          read?: boolean | null
          vendor_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "messages_product_id_fkey"
            columns: ["product_id"]
            isOneToOne: false
            referencedRelation: "products"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "messages_vendor_id_fkey"
            columns: ["vendor_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      newsletter: {
        Row: {
          created_at: string | null
          email: string
          id: string
        }
        Insert: {
          created_at?: string | null
          email: string
          id?: string
        }
        Update: {
          created_at?: string | null
          email?: string
          id?: string
        }
        Relationships: []
      }
      products: {
        Row: {
          address: string | null
          category: string | null
          city: string | null
          contact_phone: string | null
          created_at: string | null
          description: string | null
          id: string
          images_urls: string[] | null
          price: number
          seller_id: string
          state: string | null
          status: string | null
          title: string
        }
        Insert: {
          address?: string | null
          category?: string | null
          city?: string | null
          contact_phone?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          images_urls?: string[] | null
          price: number
          seller_id: string
          state?: string | null
          status?: string | null
          title: string
        }
        Update: {
          address?: string | null
          category?: string | null
          city?: string | null
          contact_phone?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          images_urls?: string[] | null
          price?: number
          seller_id?: string
          state?: string | null
          status?: string | null
          title?: string
        }
        Relationships: [
          {
            foreignKeyName: "products_seller_id_fkey"
            columns: ["seller_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      products_categories: {
        Row: {
          category_id: string
          product_id: string
        }
        Insert: {
          category_id: string
          product_id: string
        }
        Update: {
          category_id?: string
          product_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "products_categories_category_id_fkey"
            columns: ["category_id"]
            isOneToOne: false
            referencedRelation: "categories"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "products_categories_product_id_fkey"
            columns: ["product_id"]
            isOneToOne: false
            referencedRelation: "products"
            referencedColumns: ["id"]
          },
        ]
      }
      products_tags: {
        Row: {
          product_id: string
          tag_id: string
        }
        Insert: {
          product_id: string
          tag_id: string
        }
        Update: {
          product_id?: string
          tag_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "products_tags_product_id_fkey"
            columns: ["product_id"]
            isOneToOne: false
            referencedRelation: "products"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "products_tags_tag_id_fkey"
            columns: ["tag_id"]
            isOneToOne: false
            referencedRelation: "tags"
            referencedColumns: ["id"]
          },
        ]
      }
      profiles: {
        Row: {
          avatar_url: string | null
          full_name: string | null
          id: string
          phone: string | null
          role: string | null
          updated_at: string | null
        }
        Insert: {
          avatar_url?: string | null
          full_name?: string | null
          id: string
          phone?: string | null
          role?: string | null
          updated_at?: string | null
        }
        Update: {
          avatar_url?: string | null
          full_name?: string | null
          id?: string
          phone?: string | null
          role?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      tags: {
        Row: {
          created_at: string | null
          id: string
          name: string
        }
        Insert: {
          created_at?: string | null
          id?: string
          name: string
        }
        Update: {
          created_at?: string | null
          id?: string
          name?: string
        }
        Relationships: []
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  public: {
    Enums: {},
  },
} as const
</file>

<file path=".github/workflows/deploy.yml">
name: Deploy Marketplace

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            # 1. Entrar na pasta do projeto
            mkdir -p ~/Marketplace-Tech
            cd ~/Marketplace-Tech
            
            # 2. Sincronizar com o commit atual
            if [ ! -d ".git" ]; then
              echo "Repositório não encontrado localmente. Clonando..."
              find . -mindepth 1 -delete
              git clone https://github.com/WilmarFilho/Marketplace-Tech.git .
            else
              echo "Sincronizando repositório existente..."
              git fetch origin main
              git reset --hard origin/main
            fi

            # 3. Docker Compose (Sempre com hífen conforme solicitado)
            # Nota: Certifique-se de ter o Alias ou a versão V1 instalada na VPS
            docker-compose down
            docker-compose up -d --build

            # 4. Limpeza de imagens antigas para poupar espaço
            docker image prune -f
</file>

<file path="app/(main)/dashboard/meus-anuncios/page.tsx">
import { Suspense } from "react";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";
import MeusAnunciosContent from "@/components/dashboard/MeusAnunciosContent";

export default function MeusAnunciosPage() {
  return (
    <>
      <Cabecalho />

      <main className="pb-80">
        <Suspense fallback={
          <div className="mx-auto w-full max-w-[1800px] px-4 py-10 md:px-[44px]">
            <div className="flex justify-center items-center min-h-[400px]">
              <div className="text-white text-center">
                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"></div>
                <p>Carregando anúncios...</p>
              </div>
            </div>
          </div>
        }>
          <MeusAnunciosContent />
        </Suspense>
      </main>

      <Rodape />
    </>
  );
}
</file>

<file path="components/layout/rodape/rodape.module.css">
.footer {
    background-color: #0F0F0F;
    display: flex;
    flex-direction: column;
    padding: 80px 80px 20px 80px;
    gap: 40px;
    color: #FFFFFF;
}

.containerTop {
    display: flex;
    justify-content: space-between;
}

.strong {
    display: none;
}

.containerBottom {
    display: flex;
    border-top: 1px solid #ffffff2c;
    padding-top: 20px;
    gap: 12px;
}

.rightsSection {
    display: flex;
    gap: 12px;
    align-items: center;
}

.rightsSection img {
    width: 86px;
    height: 66px;
}

.rightsSection p {
    font-size: 16px;
}

.logo {
    width: 100%;
}

.logoSection {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.newsletterSection {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: end;
}

.newsletter h4 {
    font-family: var(--font-bebas-neue);
    font-size: 36px;
}

.newsletterForm {
    display: flex;
    gap: 8px;
    justify-content: end;
}

.newsletterForm input {
    border-radius: 200px;
    padding: 4px 12px;
    text-align: center;
    color: #0f0f0f9d;
}

.newsletterForm button {
    background-color: #E4E4E4;
    color: #0F0F0F;
    border-radius: 200px;
    padding: 8px 16px;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
}

.nav {
    display: flex;
    gap: 12px;
}

/* Responsive footer rules */
@media (max-width: 1324px) {
    .footer {
        padding: 48px 40px 20px 40px;
    }

    .strong {
        display: block;
    }

    .logoNkw {
        display: none;
    }

    .containerTop {
        flex-direction: column;
        align-items: center;
        gap: 24px;
    }

    .newsletterSection {
        align-items: center;
        width: 100%;
        gap: 32px;
    }

    .newsletter h4 {
        font-size: 28px;
    }

    .newsletterForm {
        justify-content: center;
    }

    .rightsSection {
        justify-content: center;
        text-align: center;
        text-wrap: balance;
    }

    .containerBottom {
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .footer {
        padding: 36px 24px 16px 24px;
    }

    .newsletter h4 {
        font-size: 24px;
    }

    .newsletterForm {
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

    .newsletterForm input {
        width: 100%;
        max-width: 420px;
        padding: 8px 12px;
        text-align: left;
    }

    .newsletterForm button {
        width: 100%;
        max-width: 240px;
    }

    .nav {
        justify-content: center;
        flex-wrap: wrap;
    }

    .rightsSection p {
        font-size: 14px;
        width: 62%;
    }

    .newsletterSection {
        gap: 32px;
    }
}

@media (max-width: 480px) {
    .footer {
        padding: 64px 12px 44px 12px;
        gap: 20px;
    }

    

    .newsletter h4 {
        font-size: 20px;
    }

    .logoSection {
        align-items: center;
        text-align: center;
    }

    .rightsSection {
        gap: 2px;
    }

    .newsletterForm input {
        font-size: 14px;
    }

    .newsletterForm button {
        font-size: 13px;
        padding: 8px 12px;
    }

    .containerBottom {
        gap: 8px;
        padding-top: 12px;
    }
}
</file>

<file path="components/sections/em-alta/secao-em-alta.module.css">
.section {
  background-color: #0f0f0f;
  background-image:
    linear-gradient(180deg, rgba(15, 15, 15, 1) 0%, rgba(15, 15, 15, 0) 68%),
    linear-gradient(180deg, rgba(15, 15, 15, 0) 0%, rgba(15, 15, 15, 1) 100%),
    radial-gradient(circle at 41% 12%, rgba(0, 0, 0, 0) 0%, rgba(0, 255, 178, 0.6) 100%);
}

.kicker {
  background: rgba(236, 242, 48, 0.06);
  border: 1px solid rgba(236, 242, 48, 0.08);
  border-radius: 41px;
  padding: 8px 54px;
  font-size: 22px;
  line-height: 1.5em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.61);
}

.title {
  font-size: 56px;
  line-height: 1.0714285714em;
  text-wrap: balance;
}

.subtitle {
  font-size: 30px;
  text-wrap: balance;
  line-height: 1.1em;
}

.tickerWrap {
  width: 100vw;
  position: relative;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  overflow: hidden;
  padding: 0 16px 60px 16px;
}

.tickerTrack {
  display: flex;
  align-items: center;
  width: max-content;
  animation: droptech-marquee var(--marquee-duration, 80s) linear infinite;
  will-change: transform;
  gap: 40px;
}

.tickerGroup {
  display: flex;
  align-items: center;
  gap: 40px;
}

.tickerItem {
  flex: 0 0 auto;
  width: min(478px, 92vw);
}


@keyframes droptech-marquee {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(-50%, 0, 0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .tickerTrack {
    animation: none;
  }
}

@media (max-width: 1524px) {
  .kicker {
    font-size: 20px;
    padding: 6px 40px;
  }

  .title { font-size: 40px; }
  .subtitle { font-size: 22px; }

  .tickerTrack { gap: 26px; }
  .tickerGroup { gap: 26px; }

  .tickerItem { width: min(360px, 92vw); }
}


@media (max-width: 1224px) {
  .kicker {
    font-size: 18px;
    padding: 6px 40px;
  }

  .title { font-size: 32px; }
  .subtitle { font-size: 20px; }

  .tickerItem { width: min(320px, 92vw); }
}

@media (max-width: 768px) {
  .kicker {
    font-size: 16px;
    padding: 6px 28px;
  }

  .title { font-size: 28px; }
  .subtitle { font-size: 18px; }

  .tickerWrap {
    padding-bottom: 20px;
  }
}

@media (max-width: 480px) {
  .kicker {
    font-size: 12px;
    padding: 4px 14px;
  }
  
  .title { font-size: 20px; }
  .subtitle { font-size: 14px; }

}
</file>

<file path="app/(main)/anuncio/[id]/actions.ts">
"use server";

import { createClient } from "@/lib/supabase/server";
import { revalidatePath } from "next/cache";

export async function toggleFavorite(productId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) throw new Error("Unauthorized");

  // Check if already favorited
  const { data: existingFavorite } = await supabase
    .from("favorites")
    .select("id")
    .eq("user_id", user.id)
    .eq("product_id", productId)
    .maybeSingle();

  if (existingFavorite) {
    // Remove favorite
    await supabase
      .from("favorites")
      .delete()
      .eq("id", existingFavorite.id);
  } else {
    // Add favorite
    await supabase
      .from("favorites")
      .insert({
        user_id: user.id,
        product_id: productId,
      });
  }

  revalidatePath(`/anuncio/${productId}`);
  revalidatePath("/dashboard/favoritos");
}

export async function getProductDetails(id: string) {
  const supabase = await createClient();
  const { data: product, error } = await supabase
    .from("products")
    .select(`
      *,
      seller:profiles!seller_id (
        id,
        full_name,
        avatar_url,
        phone
      ),
      product_tags:products_tags (
        tag:tags (
          id,
          name
        )
      )
    `)
    .eq("id", id)
    .single();

  if (error) return null;

  const { data: { user } } = await supabase.auth.getUser();
  let isFavorite = false;
  let userRole = null;

  if (user) {
    const { data: favorite } = await supabase
      .from("favorites")
      .select("id")
      .eq("user_id", user.id)
      .eq("product_id", id)
      .maybeSingle();
    isFavorite = !!favorite;
    
    // Buscar role do usuário
    const { data: profile } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", user.id)
      .maybeSingle();
    userRole = profile?.role;
  }

  // Buscar estatísticas do vendedor
  const { count: totalProducts } = await supabase
    .from("products")
    .select("*", { count: "exact", head: true })
    .eq("seller_id", product.seller_id)
    .eq("status", "aprovado");

  return { 
    product: {
      ...product,
      sellerStats: {
        totalProducts: totalProducts ?? 0
      }
    }, 
    isFavorite, 
    currentUserId: user?.id,
    userRole
  };
}

export async function sendMessage(formData: FormData) {
  const supabase = await createClient();
  
  const productId = formData.get("productId") as string;
  const fullName = formData.get("fullName") as string;
  const email = formData.get("email") as string;
  const phone = formData.get("phone") as string;
  const messageContent = formData.get("message") as string;
  
  // Buscar o vendedor do produto
  const { data: product } = await supabase
    .from("products")
    .select("seller_id")
    .eq("id", productId)
    .single();
  
  if (!product) {
    throw new Error("Produto não encontrado");
  }
  
  // Inserir a mensagem
  const { error } = await supabase
    .from("messages")
    .insert({
      product_id: productId,
      vendor_id: product.seller_id,
      full_name: fullName,
      email: email,
      phone: phone,
      message_content: messageContent,
      read: false
    });
  
  if (error) {
    throw new Error("Erro ao enviar mensagem");
  }
  
  return { success: true };
}

export async function deleteProduct(productId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) throw new Error("Unauthorized");

  // Buscar o produto e verificar permissões
  const { data: product } = await supabase
    .from("products")
    .select("seller_id")
    .eq("id", productId)
    .single();

  if (!product) throw new Error("Produto não encontrado");

  // Verificar se é o dono ou admin
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single();

  const isOwner = product.seller_id === user.id;
  const isAdmin = profile?.role === "admin";

  if (!isOwner && !isAdmin) {
    throw new Error("Você não tem permissão para deletar este anúncio");
  }

  // Deletar o produto
  const { error } = await supabase
    .from("products")
    .delete()
    .eq("id", productId);

  if (error) throw new Error("Erro ao deletar o anúncio");

  revalidatePath("/dashboard/meus-anuncios");
  revalidatePath("/admin/moderacao");
}
</file>

<file path="components/layout/rodape/index.tsx">
'use client';

import Image from "next/image";
import Link from "next/link";
import styles from "./rodape.module.css";
import { useNewsletter } from "@/lib/hooks/useNewsletter";

function Rodape() {
    const { email, setEmail, isLoading, message, isSuccess, subscribe } = useNewsletter();

    return (
        <footer className={styles.footer}>

            <div className={styles.containerTop}>
                <div className={styles.logoSection}>
                    {/* Logo */}
                    <Link href="/" aria-label="Página inicial" >
                        <Image
                            src="/logo.svg"
                            alt="DROPTECH"
                            width={256}
                            height={37}
                            priority
                            className={styles.logo}
                        />
                    </Link >
                    <div className={styles.rightsSection}>
                        <p>2025. Todos os direitos reservados. Desenvolvido por <Link href="https://www.nkwclub.com" target="_blank" aria-label="Página inicial" ><strong className={styles.strong} >NKW TECNOLOGIA</strong></Link> </p>
                        <Link href="https://www.nkwclub.com" target="_blank" aria-label="Página inicial" >
                            <Image
                                src="/logo-nkw.svg"
                                alt="logo-nkw"
                                width={256}
                                height={37}
                                priority
                                className={styles.logoNkw}
                            />
                        </Link >
                    </div>
                </div>

                <div className={styles.newsletterSection}>
                    <div className={styles.newsletter}>
                        <h4>Se inscreva na nossa newsletter</h4>
                        <form className={styles.newsletterForm} onSubmit={subscribe}>
                            <input 
                                type="email" 
                                placeholder="Digite seu email" 
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                disabled={isLoading}
                                required
                            />
                            <button 
                                type="submit" 
                                disabled={isLoading || !email}
                                style={{
                                    opacity: isLoading || !email ? 0.6 : 1,
                                    cursor: isLoading || !email ? 'not-allowed' : 'pointer'
                                }}
                            >
                                {isLoading ? 'Cadastrando...' : 'Cadastrar'}
                            </button>
                        </form>
                        {message && (
                            <div style={{
                                marginTop: '8px',
                                fontSize: '14px',
                                color: isSuccess ? '#10b981' : '#ef4444',
                                textAlign: 'center'
                            }}>
                                {message}
                            </div>
                        )}
                    </div>
                    {/* Navigation */}
                    <nav className={styles.nav}>
                        <Link
                            href="/"
                            className={styles.navText}
                        >
                            Home
                        </Link>
                        <Link
                            href="/explorar"
                            className={styles.navText}
                        >
                            Explorar
                        </Link>
                        <Link
                            href="/#missao"
                            className={styles.navText}
                        >
                            Sobre
                        </Link>
                        <Link
                            href="/#ofertas-do-dia"
                            className={styles.navText}
                        >
                            Ofertas do Dia
                        </Link>
                    </nav>
                </div>
            </div>

            <div className={styles.containerBottom}>
                <Link href="https://instagram.com/nkw_tech" target="_blank" aria-label="Página inicial" >
                    <Image
                        src="/figma/Instagram.svg"
                        alt="DROPTECH"
                        width={256}
                        height={37}
                        priority
                        className="h-[28px] w-auto md:h-[36px]"
                    />
                </Link >
                <Link href="https://x.com/nkwtech" target="_blank" aria-label="Página inicial" >
                    <Image
                        src="/figma/x.svg"
                        alt="DROPTECH"
                        width={256}
                        height={37}
                        priority
                        className="h-[28px] w-auto md:h-[36px]"
                    />
                </Link >
                <Link href="https://www.youtube.com/@NKWTECNOLOGIA" target="_blank" aria-label="Página inicial" >
                    <Image
                        src="/figma/Youtube.svg"
                        alt="DROPTECH"
                        width={256}
                        height={37}
                        priority
                        className="h-[28px] w-auto md:h-[36px]"
                    />
                </Link >
            </div>

        </footer >

    );
}

export default Rodape;
</file>

<file path="components/product/ProductInfo.tsx">
'use client';

import {
  Heart,
  Calendar,
  MapPin,
  Trash2,
  Edit3
} from 'lucide-react';
import styles from './product.module.css';
import type { Tables } from '@/src/types/supabase';
import { toggleFavorite, deleteProduct } from '@/app/(main)/anuncio/[id]/actions';
import { useState, useTransition } from 'react';
import { useRouter } from 'next/navigation';

interface ProductInfoProps {
  product: Tables<'products'> & {
    seller?: {
      id: string;
      name?: string;
      email?: string;
    };
    sellerStats?: {
      totalProducts: number;
    };
    product_tags?: {
      tag: {
        id: string;
        name: string;
      };
    }[];
  };
  isFavorite: boolean;
  currentUserId?: string;
  userRole?: string;
}

export default function ProductInfo({ product, isFavorite, currentUserId, userRole }: ProductInfoProps) {
  const [isCurrentlyFavorite, setIsCurrentlyFavorite] = useState(isFavorite);
  const [isPending, startTransition] = useTransition();
  const [isDeleting, setIsDeleting] = useState(false);
  const router = useRouter();
  
  const handleToggleFavorite = () => {
    if (!currentUserId) return;
    
    startTransition(async () => {
      setIsCurrentlyFavorite(!isCurrentlyFavorite);
      try {
        await toggleFavorite(product.id);
      } catch {
        // Reverter o estado em caso de erro
        setIsCurrentlyFavorite(isCurrentlyFavorite);
      }
    });
  };

  const handleDeleteProduct = async () => {
    if (!currentUserId) return;
    
    const isOwner = product.seller_id === currentUserId;
    const isAdmin = userRole === 'admin';
    
    if (!isOwner && !isAdmin) {
      alert('Você não tem permissão para deletar este anúncio');
      return;
    }
    
    const confirmDelete = confirm('Tem certeza que deseja deletar este anúncio? Esta ação não pode ser desfeita.');
    
    if (confirmDelete) {
      setIsDeleting(true);
      try {
        await deleteProduct(product.id);
        router.push('/dashboard/meus-anuncios');
      } catch (error) {
        console.error('Erro ao deletar anúncio:', error);
        alert('Erro ao deletar o anúncio. Tente novamente.');
        setIsDeleting(false);
      }
    }
  };

  const handleEditProduct = () => {
    if (!currentUserId || product.seller_id !== currentUserId) return;
    
    // Redirecionar para a tela de edição com os dados do produto
    const editUrl = `/dashboard/anunciar?edit=${product.id}`;
    router.push(editUrl);
  };

  const formatDate = (dateString: string | null) => {
    if (!dateString) return 'Data não disponível';
    return new Date(dateString).toLocaleDateString('pt-BR');
  };

  const formatLocation = () => {
    const parts = [];
    if (product.city) parts.push(product.city);
    if (product.state) parts.push(product.state);
    return parts.length > 0 ? parts.join(' - ') : 'Localização não informada';
  };

  return (
    <section className={styles.productCard}>
      <header className={styles.productHeader}>
        <div className={styles.productTitle}>
          <h1>{product.title}</h1>

          <div className={styles.tags}>
            {product.category && <span className={styles.category}>{product.category}</span>}
            {product.product_tags?.map((productTag) => (
              <span key={productTag.tag.id} className={styles.tag}>
                {productTag.tag.name}
              </span>
            ))}
          </div>
        </div>

        {currentUserId && (
          <div className={styles.actionButtons}>
            {/* Botão de favoritar - apenas se NÃO for o dono do anúncio */}
            {product.seller_id !== currentUserId && (
              <button 
                className={styles.favorite}
                onClick={handleToggleFavorite}
                disabled={isPending}
                style={{
                  color: isCurrentlyFavorite ? '#ef4444' : '#6b7280'
                }}
              >
                <Heart fill={isCurrentlyFavorite ? 'currentColor' : 'none'} />
              </button>
            )}
            
            {/* Botões para o dono do anúncio */}
            {product.seller_id === currentUserId && (
              <>
                <button
                  className={styles.editButton}
                  onClick={handleEditProduct}
                  title="Editar anúncio"
                >
                  <Edit3 size={20} />
                </button>
                <button
                  className={styles.deleteButton}
                  onClick={handleDeleteProduct}
                  disabled={isDeleting}
                  title="Deletar anúncio"
                >
                  <Trash2 size={20} />
                </button>
              </>
            )}
            
            {/* Botão de deletar para admin (se não for o dono) */}
            {(userRole === 'admin' && product.seller_id !== currentUserId) && (
              <button
                className={styles.deleteButton}
                onClick={handleDeleteProduct}
                disabled={isDeleting}
                title="Deletar anúncio"
              >
                <Trash2 size={20} />
              </button>
            )}
          </div>
        )}
      </header>

      <div className={styles.description}>
        <h3>DESCRIÇÃO DO PRODUTO</h3>
        <p>
          {product.description || 'Descrição não disponível.'}
        </p>
      </div>

      <footer className={styles.meta}>
        <span>
          <Calendar size={16} /> Publicado no dia {formatDate(product.created_at)}
        </span>
        <span>
          <MapPin size={16} /> {formatLocation()}
        </span>
      </footer>
    </section>
  );
}
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: 'standalone',
  experimental: {
    serverActions: {
      bodySizeLimit: '50mb', // Aumenta o limite para 50MB para permitir upload de múltiplas imagens
    },
  },
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'avatars.githubusercontent.com',
      },
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'unsplash.com',
      },
      {
        protocol: 'https',
        hostname: '*.supabase.co',
      },
      {
        protocol: 'https',
        hostname: '*.amazonaws.com',
      },
      {
        protocol: 'https',
        hostname: 'cdn.pixabay.com',
      },
      {
        protocol: 'https',
        hostname: 'i.imgur.com',
      },
      {
        protocol: 'https',
        hostname: 'via.placeholder.com',
      },
    ],
  },
};

export default nextConfig;
</file>

<file path="app/(main)/anuncio/[id]/page.tsx">
import { Suspense } from "react";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";
import { SecaoSemelhantes } from "@/components/sections/semelhantes";
import ProductPage from "@/components/product/ProductPage";
import { getProductDetails } from "./actions";

export const dynamic = "force-dynamic";

export default async function AnuncioPage({ params }: { params: Promise<{ id: string }> }) {

  const { id } = await params;

  // Buscar dados básicos do produto para a seção semelhantes
  const result = await getProductDetails(id);
  const product = result?.product;

  return (
    <>
      <Cabecalho />
      <main>
        
        <div className="container mx-auto py-8 px-4">
          <Suspense fallback={<div className="text-center py-20">Carregando detalhes do produto...</div>}>
            <ProductPage productId={id} />
          </Suspense>
        </div>

        <Suspense fallback={<div className="text-center py-8">Carregando produtos semelhantes...</div>}>
          <SecaoSemelhantes 
            currentProductId={id}
            category={product?.category || undefined}
          />
        </Suspense>
      </main>
      <Rodape />
    </>
  );
}
</file>

<file path="app/(main)/dashboard/favoritos/page.tsx">
import { Suspense } from "react";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";
import FavoritesContent from "@/components/dashboard/FavoritesContent";

export default function FavoritosPage() {
  return (
    <>
      <Cabecalho />

      <main className="pb-80">
        <Suspense fallback={
          <div className="w-full px-4">
            <div className="mx-auto w-full max-w-[1744px] px-6 py-10 md:px-[40px]">
              <div className="flex justify-center items-center min-h-[400px]">
                <div className="text-white text-center">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"></div>
                  <p>Carregando favoritos...</p>
                </div>
              </div>
            </div>
          </div>
        }>
          <FavoritesContent />
        </Suspense>
      </main>

      <Rodape />
    </>
  );
}
</file>

<file path="app/(main)/page.tsx">
import { SecaoHero } from "@/components/sections/hero";
import Cabecalho from "@/components/layout/cabecalho";
import { SecaoEmAlta } from "@/components/sections/em-alta";
import { SecaoPorQue } from "@/components/sections/por-que";
import { SecaoHardware } from "@/components/sections/hardware";
import { SecaoMissao } from "@/components/sections/missao";
import Rodape from "@/components/layout/rodape";

export default function Home() {
  return (
    <div className=" flex flex-col bg-background font-sans">

      <main className="flex-1 flex flex-col">

        <div className="relative">
          <Cabecalho floating />
          <SecaoHero />
        </div>

        <SecaoEmAlta />

        <SecaoPorQue />

        <SecaoHardware />

        <SecaoMissao />

      </main>

      <Rodape />

    </div>
  );
}
</file>

<file path="app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  scroll-behavior: smooth;
}

html,
body {
  overflow-x: clip;
}

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
}

@layer base {
  :root {
    --background: 0 0% 5.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    --radius: 0.5rem;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Custom breakpoint: enable 3-column grid only on screens >= 1360px */
@media (min-width: 1360px) {
  .cols-3-1360 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

/* Explicit grid for explorar content: 1col default, 2col @800px, 3col @1360px */
.explore-grid {
  display: grid;
  grid-template-columns: 1fr;
}

@media (max-width: 479px) {
  .explore-grid {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
}

@media (min-width: 800px) {
  .explore-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (min-width: 1360px) {
  .explore-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

/* Utility to show/hide elements under a 700px breakpoint */
.show-below-700 { display: none; }
.hide-below-700 { display: inherit; }

@media (max-width: 700px) {
  .show-below-700 { display: block; }
  .hide-below-700 { display: none; }
}

/* Dashboard grid: 1 column by default, 2 columns @670px, 3 columns @1024px */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem; /* match gap-6 */
}

@media (min-width: 670px) {
  .dashboard-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (min-width: 1024px) {
  .dashboard-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

/* Make profile card span full row on 2-column layout and smaller; reset at >=1024px */
.profile-card-span {
  grid-column: 1 / -1;
}

@media (min-width: 1024px) {
  .profile-card-span {
    grid-column: auto;
  }
}
</file>

<file path="components/product/product.module.css">
.page {
  width: 100%;
  color: #fff;
}

.gallery {
  position: relative;
  width: 100vw;
  height: 520px;
  overflow: hidden;
  margin-left: calc(-50vw + 50%);
}

.galleryContainer {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.galleryTrack {
  display: flex;
  height: 100%;
  transition: transform 0.3s ease-in-out;
}

.gallerySlide {
  flex: 0 0 33.333%;
  height: 100%;
  padding: 0 8px;
}

.galleryImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.galleryImage:hover {
  transform: scale(1.01);
}

/* Responsividade */
@media (max-width: 768px) {
  .gallery {
    height: 400px;
  }
}

@media (max-width: 649px) {
  .gallery {
    height: 350px;
  }

  .gallerySlide {
    flex: 0 0 50%;
  }
}

@media (max-width: 480px) {
  .gallery {
    height: 300px;
  }
}

@media (max-width: 399px) {
  .gallery {
    height: 280px;
  }

  .gallerySlide {
    flex: 0 0 100%;
  }

  .galleryArrowLeft {
    left: 12px;
    width: 40px;
    height: 40px;
  }

  .galleryArrowRight {
    right: 12px;
    width: 40px;
    height: 40px;
  }
}

@media (max-width: 649px) {
  .gallery {
    height: 350px;
  }

  .gallerySlide {
    flex: 0 0 50%;
  }
}

@media (max-width: 480px) {
  .gallery {
    height: 300px;
  }
}

@media (max-width: 399px) {
  .gallery {
    height: 280px;
  }

  .gallerySlide {
    flex: 0 0 100%;
  }

  .galleryArrowLeft {
    left: 12px;
    width: 40px;
    height: 40px;
  }

  .galleryArrowRight {
    right: 12px;
    width: 40px;
    height: 40px;
  }
}

/* Lightbox Styles */
.lightbox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

.lightboxContent {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lightboxImage {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 8px;
}

.lightboxClose {
  position: absolute;
  top: -50px;
  right: -10px;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #000;
  transition: all 0.2s ease;
  z-index: 1001;
}

.lightboxClose:hover {
  background: #fff;
  transform: scale(1.1);
}

.lightboxPrev,
.lightboxNext {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #000;
  transition: all 0.2s ease;
  z-index: 1001;
}

.lightboxPrev {
  left: -70px;
}

.lightboxNext {
  right: -70px;
}

.lightboxPrev:hover,
.lightboxNext:hover {
  background: #fff;
  transform: translateY(-50%) scale(1.1);
}

/* Responsividade do Lightbox */
@media (max-width: 700px) {
  .lightboxPrev {
    left: 10px;
  }

  .lightboxNext {
    right: 10px;
  }

  .lightboxPrev,
  .lightboxNext {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.95);
  }
}

@media (max-width: 480px) {
  .lightboxPrev {
    left: 8px;
  }

  .lightboxNext {
    right: 8px;
  }

  .lightboxPrev,
  .lightboxNext {
    width: 40px;
    height: 40px;
  }
}

@media (max-width: 320px) {
  .lightboxPrev {
    left: 6px;
  }

  .lightboxNext {
    right: 6px;
  }

  .lightboxPrev,
  .lightboxNext {
    width: 36px;
    height: 36px;
  }
}

.gallery img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.galleryArrowLeft,
.galleryArrowRight {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.7);
  border-radius: 50%;
  border: none;
  width: 48px;
  height: 48px;
  color: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.galleryArrowLeft {
  left: 24px;
}

.galleryArrowRight {
  right: 24px;
}

.galleryArrowLeft:hover,
.galleryArrowRight:hover {
  background: rgba(0, 0, 0, 0.9);
  transform: translateY(-50%) scale(1.1);
}

.galleryArrowLeft:disabled,
.galleryArrowRight:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  background: rgba(0, 0, 0, 0.3);
}

.galleryArrowLeft:disabled:hover,
.galleryArrowRight:disabled:hover {
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.3);
}

.content {
  display: grid;
  grid-template-columns: 1fr 500px;
  gap: 24px;
  margin-top: -80px;
  position: relative;
  z-index: 990;
}

.productCard,
.sellerCard {
  background: #d9f100;
  border-radius: 16px;
  padding: 24px;
  color: #000;
  margin-bottom: 24px;
  overflow: hidden;
  word-wrap: break-word;
}

.productCard {
  display: flex;
  flex-direction: column;
  gap: 62px;
}

.contactCard {
  color: #FFF;
  height: 480px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.contactForm {
  display: flex;
  flex-direction: column;
  gap: 20px;
  flex-grow: 1;
}

.formGroup {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.formLabel {
  font-weight: 600;
  font-size: 14px;
  color: #333;
  margin-bottom: 4px;
}

.formInput,
.formTextarea {
  padding: 12px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s ease;
  background: #fff;
}

.formInput:focus,
.formTextarea:focus {
  outline: none;
  border-color: #00d084;
  box-shadow: 0 0 0 3px rgba(0, 208, 132, 0.1);
}

.formInput::placeholder,
.formTextarea::placeholder {
  color: #94a3b8;
}

.formTextarea {
  resize: vertical;
  min-height: 100px;
  font-family: inherit;
}

.productTitlePrice {
  display: flex;
  justify-content: space-between;
}

.contactCardHeader {
  background-color: #FFF;
  color: #000;
  padding: 24px;
  gap: 32px;
  display: flex;
  flex-direction: column;
  border-radius: 12px;
}

.tags span {
  background: rgba(0, 0, 0, 0.1);
  padding: 6px 14px;
  border-radius: 999px;
  margin-right: 8px;
  font-size: 12px;
}

.tag {
  background: #00f2a9 !important;
  color: #000 !important;
}

.price strong {
  font-size: 32px;
  color: #00d084;
}

.price span {
  text-decoration: line-through;
  margin-left: 8px;
}

.send {
  background: #00f2a9;
  border-radius: 12px;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  height: 48px;
  border: none;
  font-weight: 700;
}

.productHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.productTitle {
  display: flex;
  flex-direction: column;
  gap: 8px;
  text-wrap: balance;
}

.productTitle h1 {
  font-family: var(--font-k2d);
  font-size: 42px;
  margin-bottom: 4px;
}

.meta,
.meta span {
  display: flex;
  justify-content: space-between;
}

.meta span {
  gap: 8px;
  display: flex;
  align-items: center;
  font-family: var(--font-poppins);
  font-size: 25px;
  color: rgba(0, 0, 0, 0.813);
}

.meta svg {
  width: 28px;
  height: 28px;
}

.description h3 {
  font-size: 34px;
  font-family: var(--font-k2d);
}

.description p {
  font-size: 22px;
  font-family: var(--font-poppins);
  font-weight: 200;
  color: rgba(0, 0, 0, 0.7);
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  line-height: 1.5;
}

.category {
  background-color: #fff !important;
}

.sellerCard h3 {
  font-size: 42px;
  font-family: var(--font-k2d);
}

.sellerContent {
  display: flex;
  justify-content: center;
  gap: 120px;
}

.sellerInfo,
.sellerStats,
.sellerReputation {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: 16px;
}

.sellerStats button,
.sellerReputation button {
  background: #FFF;
  border-radius: 1000px;
  height: 90px;
  width: 90px;
  border: none;
  display: flex;
  justify-content: center;
  align-items: center;
}

.sellerStats span,
.sellerReputation span {
  font-size: 28px;
  font-family: var(--font-poppins);
}

.sellerInfo span {
  font-size: 24px;
  font-family: var(--font-poppins);
  text-transform: uppercase;
}

.sellerInfo img {
  width: 90px;
  height: 90px;
}

.sellerCard {
  gap: 52px;
  display: flex;
  flex-direction: column;
}

.favorite svg {
  width: 40px;
  height: 40px;
}

.favorite {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.favorite:hover {
  background-color: rgba(239, 68, 68, 0.1);
}

.actionButtons {
  display: flex;
  gap: 8px;
  align-items: center;
}

.deleteButton {
  background: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  border-radius: 50%;
  color: #ef4444;
  transition: all 0.2s ease;
}

.deleteButton:hover {
  background-color: rgba(0, 0, 0, 0.8);
  color: white;
  transform: scale(1.05);
}

.deleteButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.editButton {
  background: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  border-radius: 50%;
  color: #3b82f6;
  transition: all 0.2s ease;
  margin-right: 8px;
}

.editButton:hover {
  background-color: rgba(0, 0, 0, 0.8);
  color: white;
  transform: scale(1.05);
}

/* Novos estilos para funcionalidade real */
.sellerAvatar {
  width: 90px !important;
  height: 90px !important;
  border-radius: 50%;
  object-fit: cover;
}

.whatsappButton {
  background: none;
  border: none;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.whatsappButton:hover {
  transform: scale(1.05);
}

.submitButton {
  width: 100%;
  background: #3b82f6;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background-color 0.2s ease;
  margin-top: 20px;
}

.submitButton:hover:not(:disabled) {
  background: #2563eb;
}

.submitButton:disabled {
  background: #9ca3af;
  cursor: not-allowed;
}

.successMessage {
  background: #10b981;
  color: white;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
}

.successMessage h3 {
  margin: 0 0 8px 0;
  font-size: 18px;
  font-weight: 600;
}

.successMessage p {
  margin: 0;
  font-size: 14px;
  opacity: 0.9;
}

.errorMessage {
  background: #ef4444;
  color: white;
  padding: 12px;
  border-radius: 6px;
  text-align: center;
  margin-bottom: 16px;
  font-size: 14px;
}

/* Responsividade - Layout e Typography */
@media (max-width: 1299px) {

  .page {
    height: 1900px;
  }

  .content {
    grid-template-columns: 1fr;
    gap: 32px;
    margin-top: -60px;
    padding: 0 20px;
  }

  .productTitle h1 {
    font-size: 36px;
  }

  .meta span {
    font-size: 22px;
  }

  .description h3 {
    font-size: 28px;
  }

  .description p {
    font-size: 20px;
  }

  .price strong {
    font-size: 28px;
  }

  .sellerCard h3 {
    font-size: 36px;
  }

  .sellerStats span,
  .sellerReputation span {
    font-size: 24px;
  }

  .sellerInfo span {
    font-size: 22px;
  }
}

@media (max-width: 1024px) {

  .page {
    height: 1850px;
  }

  .productTitle h1 {
    font-size: 32px;
  }

  .meta span {
    font-size: 20px;
  }

  .description h3 {
    font-size: 26px;
  }

  .description p {
    font-size: 18px;
  }

  .price strong {
    font-size: 26px;
  }

  .sellerCard h3 {
    font-size: 32px;
  }

  .sellerContent {
    gap: 80px;
  }

  .sellerStats span,
  .sellerReputation span {
    font-size: 22px;
  }

  .sellerInfo span {
    font-size: 20px;
  }
}

@media (max-width: 768px) {

  .productHeader {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  .productTitle {
    width: 100%;
  }

  .actionButtons {
    width: 100%;
  }

  .page {
    height: 2200px;
  }

  .content {
    padding: 0 16px;
    gap: 24px;
    margin-top: -40px;
    display: flex;
    flex-direction: column;
  }

  .productTitle h1 {
    font-size: 22px;
  }

  .meta span {
    font-size: 18px;
  }

  .meta svg {
    width: 24px;
    height: 24px;
  }

  .description h3 {
    font-size: 22px;
  }

  .description p {
    font-size: 16px;
  }

  .price strong {
    font-size: 24px;
  }

  .sellerCard h3 {
    font-size: 28px;
  }

  .sellerContent {
    gap: 40px;
    flex-direction: column;
  }

  .sellerStats button,
  .sellerReputation button {
    height: 70px;
    width: 70px;
  }

  .sellerStats span,
  .sellerReputation span {
    font-size: 20px;
  }

  .sellerInfo span {
    font-size: 18px;
  }

  .sellerInfo img {
    width: 70px;
    height: 70px;
  }

  .productCard,
  .sellerCard {
    padding: 20px;
  }
}

@media (max-width: 480px) {

  .page{
    height: 2000px;
  }

  .productCard {
    gap: 40px;
  }

  .content {
    padding: 0 12px;
    gap: 20px;
    margin-top: -30px;
  }

  .productTitle h1 {
    font-size: 20px;
  }

  .meta span {
    font-size: 12px;
  }

  .meta svg {
    width: 20px;
    height: 20px;
  }

  .description h3 {
    font-size: 18px;
  }

  .description p {
    font-size: 14px;
  }

  .price strong {
    font-size: 20px;
  }

  .sellerCard h3 {
    font-size: 20px;
  }

  .sellerContent {
    gap: 24px;
  }

  .sellerStats button,
  .sellerReputation button {
    height: 60px;
    width: 60px;
  }

  .sellerStats span,
  .sellerReputation span {
    font-size: 18px;
  }

  .sellerInfo span {
    font-size: 16px;
  }

  .sellerInfo img {
    width: 60px;
    height: 60px;
  }

  .productCard,
  .sellerCard {
    padding: 16px;
  }

  .favorite svg {
    width: 24px;
    height: 24px;
  }

  .deleteButton {
    padding: 12px;
  }

  .editButton {
    padding: 12px;
  }
}
</file>

<file path="app/(main)/admin/moderacao/page.tsx">
import { getModerationPageData } from "./actions";
import { ModerationContent } from "./ModerationContent";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";

type ProductStatus = 'pendente' | 'aprovado' | 'reprovado' | 'vendido' | 'all';

interface ModeracaoPageProps {
  searchParams: Promise<{ status?: ProductStatus }>;
}

export default async function ModeracaoPage({ searchParams }: ModeracaoPageProps) {
  const params = await searchParams;
  const status = (params.status as ProductStatus) || 'pendente';
  
  const { products } = await getModerationPageData(status);
  

  return (
    <>
      <Cabecalho />
      <div className="min-h-screen" style={{ backgroundColor: '#0f0f0f' }}>
        <div className="w-full px-4">
          <div className="mx-auto w-full max-w-[1744px] px-6 py-10 pb-60 md:px-[40px]">
            <div className="mb-8">
              <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold mb-3 bg-gradient-to-r bg-clip-text text-white">
                Moderação de Anúncios
              </h1>
              <p className="text-gray-300 text-base md:text-lg">
                Gerencie e modere os anúncios da plataforma
              </p>
            </div>

            <ModerationContent products={products || []} currentStatus={status} />
          </div>
        </div>
      </div>
      <Rodape />
    </>
  );
}
</file>

<file path="app/(main)/dashboard/anunciar/page.tsx">
import { createClient } from "@/lib/supabase/server";
import { redirect } from "next/navigation";
import { MultiStepAdForm } from "@/components/forms/MultiStepAdForm";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";

export default async function AnunciarPage({ 
  searchParams 
}: {
  searchParams: Promise<{ edit?: string }>
}) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    redirect("/auth/login");
  }

  const params = await searchParams;
  const editId = params.edit;
  let existingProduct = null;

  // Se estamos em modo de edição, carregar os dados do produto
  if (editId) {
    const { data: product, error } = await supabase
      .from('products')
      .select(`
        *,
        products_tags (
          tag:tags (
            id,
            name
          )
        ),
        products_categories (
          category:categories (
            id,
            name
          )
        )
      `)
      .eq('id', editId)
      .eq('seller_id', user.id) // Garantir que só pode editar seus próprios produtos
      .single();

    if (!error && product) {
      existingProduct = product;
    }
  }

  const isEditing = !!existingProduct;

  return (
    <>
      <Cabecalho />

      <main className="pb-32">
        <div className="container mx-auto pt-20 px-4 max-w-4xl min-h-screen max-[1100px]:px-14 max-[768px]:px-10 max-[480px]:px-6">
          <div className="mb-8 text-center max-[768px]:mb-6">
            <h1 className="text-3xl font-bold max-[1024px]:text-2xl max-[768px]:text-xl max-[480px]:text-lg">
              {isEditing ? 'Editar Anúncio' : 'Criar Novo Anúncio'}
            </h1>
            <p className="text-muted-foreground mt-2 max-[768px]:text-sm max-[480px]:text-xs max-[480px]:mt-1">
              {isEditing ? 'Atualize as informações do seu anúncio' : 'Preencha as informações em etapas para criar seu anúncio'}
            </p>
          </div>
          
          <div className="pb-20 max-[768px]:pb-16 max-[480px]:pb-12">
            <MultiStepAdForm existingProduct={existingProduct} isEditing={isEditing} />
          </div>
        </div>
      </main>

      <Rodape />
    </>
  );
}
</file>

<file path="app/(main)/dashboard/page.tsx">
import { redirect } from "next/navigation";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import Link from "next/link";
import { getDashboardData } from "./actions";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";
import { ProfileCard } from "@/components/dashboard/ProfileCard";

export default async function DashboardPage() {
  const { user, profile } = await getDashboardData();

  if (!user) {
    redirect("/auth/login");
  }

  const isSeller = profile?.role === 'vendedor' || profile?.role === 'admin';

  return (
    <>
      <Cabecalho />
      <div className="w-full px-2 sm:px-4">
        <div className="mx-auto w-full max-w-[1744px] py-10 pb-60">
          <div className="dashboard-grid px-2 sm:px-6 md:px-[40px]">
          {/* Profile Card */}
          <div className="profile-card-span">
            <ProfileCard 
              user={user}
              profile={profile}
              isSeller={isSeller}
            />
          </div>

          {/* Favorites */}
          <Card className="hover:bg-muted/50 transition-colors flex flex-col justify-between">
              <CardHeader>
                  <CardTitle>Favoritos</CardTitle>
                  <CardDescription>Veja os produtos que você salvou</CardDescription>
              </CardHeader>
              <CardContent>
                  <Button asChild className="w-full" variant="secondary">
                      <Link href="/dashboard/favoritos">Ver Favoritos</Link>
                  </Button>
              </CardContent>
          </Card>

          {/* Seller Actions */}
          {isSeller && (
            <>
              <Card className="hover:bg-muted/50 transition-colors border-primary/20 flex flex-col justify-between">
                  <CardHeader>
                      <CardTitle>Anunciar</CardTitle>
                      <CardDescription>Crie um novo anúncio de venda</CardDescription>
                  </CardHeader>
                  <CardContent>
                      <Button asChild className="w-full" variant="default">
                          <Link href="/dashboard/anunciar">Criar Anúncio</Link>
                      </Button>
                  </CardContent>
              </Card>

              <Card className="hover:bg-muted/50 transition-colors flex flex-col justify-between">
                  <CardHeader>
                      <CardTitle>Meus Anúncios</CardTitle>
                      <CardDescription>Gerencie seus produtos à venda</CardDescription>
                  </CardHeader>
                  <CardContent>
                      <Button asChild className="w-full" variant="outline">
                          <Link href="/dashboard/meus-anuncios">Ver Meus Anúncios</Link>
                      </Button>
                  </CardContent>
              </Card>
            </>
          )}

          {/* Admin Actions */}
          {profile?.role === 'admin' && (
            <Card className="hover:bg-muted/50 transition-colors border-red-200 dark:border-red-900 flex flex-col justify-between">
                <CardHeader>
                    <CardTitle>Moderação</CardTitle>
                    <CardDescription>Gerenciar anúncios e usuários</CardDescription>
                </CardHeader>
                <CardContent>
                    <Button asChild className="w-full" variant="destructive">
                        <Link href="/admin/moderacao">Acessar Painel</Link>
                    </Button>
                </CardContent>
            </Card>
          )}
        </div>
      </div>
      </div>
      <Rodape />
    </>
  );
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { Bebas_Neue, K2D, Poppins } from "next/font/google";
import "./globals.css";

const defaultUrl = process.env.SITE_URL
  ? `https://${process.env.SITE_URL}`
  : "http://localhost:3000";

export const metadata: Metadata = {
  metadataBase: new URL(defaultUrl),
  title: "DROPTECH - Marketplace de Tecnologia",
  description: "Onde você encontra e anuncia produtos tecnológicos usados.",
  icons: {
    icon: "/favicon.svg",
  },
};

const poppins = Poppins({
  subsets: ["latin"],
  weight: ["400", "500", "600", "700"],
  variable: "--font-poppins",
  display: "swap",
});

const k2d = K2D({
  subsets: ["latin"],
  weight: ["400", "500", "600", "700"],
  variable: "--font-k2d",
  display: "swap",
});

const bebasNeue = Bebas_Neue({
  subsets: ["latin"],
  weight: "400",
  variable: "--font-bebas-neue",
  display: "swap",
});

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="pt-BR" suppressHydrationWarning>
      <body
        suppressHydrationWarning
        className={`${poppins.className} ${poppins.variable} ${k2d.variable} ${bebasNeue.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
</file>

<file path="components/cards/anuncio/index.tsx">
'use client';

import Link from "next/link";
import { Heart, House, X } from "lucide-react";
import { cn } from "@/lib/utils";
import styles from "./card-anuncio.module.css";
import type { Tables } from "@/src/types/supabase";
import { useState, useEffect } from "react";
import { createClient } from "@/lib/supabase/client";
import { useRouter } from "next/navigation";
import type { User } from "@supabase/supabase-js";

export type ProductRow = Tables<"products"> & {
  tags?: Array<{ name: string; }>;
  isFavorited?: boolean;
};

type CardAnuncioProps = {
  product: ProductRow;
  showFavoriteButton?: boolean;
};

export function CardAnuncio({ product, showFavoriteButton = false }: CardAnuncioProps) {
  const [isFavorited, setIsFavorited] = useState(product.isFavorited || false);
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [user, setUser] = useState<User | null>(null);
  const router = useRouter();
  const supabase = createClient();

  useEffect(() => {
    // Verificar se o usuário está logado
    const checkUser = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      setUser(user);
      
      // Se o usuário está logado, verificar se o produto está nos favoritos
      if (user) {
        const { data } = await supabase
          .from('favorites')
          .select('id')
          .eq('user_id', user.id)
          .eq('product_id', product.id)
          .maybeSingle();
        
        setIsFavorited(!!data);
      }
    };
    
    checkUser();
  }, [product.id, supabase]);

  const handleFavoriteClick = async (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    if (!user) {
      setShowLoginModal(true);
      return;
    }

    setIsLoading(true);
    
    try {
      if (isFavorited) {
        // Remover dos favoritos
        await supabase
          .from('favorites')
          .delete()
          .eq('user_id', user.id)
          .eq('product_id', product.id);
        
        setIsFavorited(false);
      } else {
        // Adicionar aos favoritos
        await supabase
          .from('favorites')
          .insert({
            user_id: user.id,
            product_id: product.id
          });
        
        setIsFavorited(true);
      }
    } catch (error) {
      console.error('Erro ao favoritar produto:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleLoginRedirect = () => {
    setShowLoginModal(false);
    router.push('/auth/login');
  };

  const imageSrc = product.images_urls?.[0];

  // Formatar tags (no máximo 2)
  const getTags = () => {
    if (!product.tags || product.tags.length === 0) {
      return ["#Produtos", "#Seminovo"];
    }
    
    const availableTags = product.tags.map(tag => `#${tag.name}`);
    
    // Se tem apenas 1 tag, adiciona uma tag genérica
    if (availableTags.length === 1) {
      return [availableTags[0], "#Seminovo"];
    }
    
    // Se tem 2 ou mais tags, pega as 2 primeiras
    return availableTags.slice(0, 2);
  };

  // Formatar localização
  const formatLocation = () => {
    const parts = [];
    if (product.city) parts.push(product.city);
    if (product.state) parts.push(product.state);
    
    if (parts.length === 0) return "Localização indisponível";
    if (parts.length === 1) return parts[0];
    return parts.join(" - ");
  };

  const [tag1, tag2] = getTags();
  
  const backgroundStyle = imageSrc
    ? {
        backgroundImage: `url(${imageSrc})`,
        display: "block",
      }
    : undefined;

  return (
    <>
      <Link
        href={`/anuncio/${product.id}`}
        style={backgroundStyle}
        className={cn(
          "group relative w-full overflow-hidden rounded-[20px] bg-cover bg-center p-[10px]",
          styles.cardRoot
        )}
      >
        {!imageSrc && <div className="absolute inset-0 bg-gradient-to-br from-gray-400 to-gray-600" />}

        <div className="absolute inset-0 bg-black/10" />

        <div className="relative flex h-full flex-col justify-between">
          {/* Top row */}
          <div className="flex w-full items-center justify-between">
            <div className="flex items-center gap-[7px]">
              <span className={styles.tag}>{tag1}</span>
              <span className={cn(styles.tag, styles.tagAlt)}>{tag2}</span>
            </div>

            <button
              onClick={handleFavoriteClick}
              disabled={isLoading}
              className={cn(
                "flex items-center justify-center bg-black/35 transition-all duration-200",
                styles.heart,
                {
                  "bg-red-500/80": isFavorited,
                  "hover:bg-red-500/60": !isFavorited,
                  "opacity-70": isLoading,
                  "hidden": !showFavoriteButton
                }
              )}
            >
              <Heart 
                className={cn(
                  "h-[18px] w-[18px] text-white transition-all duration-200",
                  {
                    "fill-white": isFavorited
                  }
                )}
              />
            </button>
          </div>

          {/* Bottom content */}
          <div className="w-full overflow-hidden rounded-[17px] bg-white">
            <div className="flex items-start justify-between gap-3 px-[22px] pb-3 pt-4">
              <div className="flex flex-col gap-2 w-full">
                <div className={cn("font-medium truncate max-w-full", styles.cardTitle)}>{product.title}</div>
                <div className="flex items-center gap-[6px]">
                  <House className="h-4 w-4 text-black" />
                  <span className={cn("font-medium", styles.locationText)}>{formatLocation()}</span>
                </div>
              </div>
            </div>

            <div className="border-t border-black/10 px-[22px] pb-4 pt-3">
              <div className={cn("font-medium", styles.price)}>
                {new Intl.NumberFormat("pt-BR", {
                  style: "currency",
                  currency: "BRL",
                }).format(product.price)}
              </div>
            </div>
          </div>
        </div>
      </Link>

      {/* Modal de Login */}
      {showLoginModal && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg p-6 w-full max-w-md mx-auto">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg font-semibold text-gray-900">Login Necessário</h3>
              <button
                onClick={() => setShowLoginModal(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                <X className="h-5 w-5" />
              </button>
            </div>
            
            <p className="text-gray-600 mb-6 text-balance">
              Você precisa estar logado para favoritar anúncios. Faça login para salvar seus produtos favoritos.
            </p>
            
            <div className="flex gap-3">
              <button
                onClick={handleLoginRedirect}
                className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
              >
                Fazer Login
              </button>
              <button
                onClick={() => setShowLoginModal(false)}
                className="flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors"
              >
                Cancelar
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
</file>

<file path="app/(main)/explorar/page.tsx">
import { Suspense } from "react";
import Cabecalho from "@/components/layout/cabecalho";
import Rodape from "@/components/layout/rodape";
import ExplorarContent from "@/components/explorar/ExplorarContent";

export default function ExplorarPage() {
  return (
    <>
      <Cabecalho />

      <main>
        <Suspense fallback={
          <div className="w-full px-4">
            <div className="mx-auto w-full max-w-[1744px] px-6 py-10 md:px-[40px]">
              <div className="flex justify-center items-center min-h-[400px]">
              <div className="text-white text-center">
                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"></div>
                <p>Carregando produtos...</p>
              </div>
            </div>
            </div>
          </div>
        }>
          <ExplorarContent />
        </Suspense>
      </main>

      <Rodape />
    </>
  );
}
</file>

</files>
